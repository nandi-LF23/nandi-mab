(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6fca930c"],{"47e1":function(e,t,s){"use strict";s.r(t);var o,a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"content"},[s("base-header",{staticClass:"pb-6",attrs:{type:"company"}},[s("b-row",{staticClass:"py-4",attrs:{"align-v":"center"}},[s("b-col",[s("h6",{staticClass:"h2 text-white d-inline-block mb-0 mr-5"},[e._v("Entity Management")]),s("div",{directives:[{name:"show",rawName:"v-show",value:e.loading,expression:"loading"}],staticClass:"mab_spinner light right"})])],1)],1),s("b-container",{staticClass:"mt--6",attrs:{fluid:""}},[s("b-modal",{attrs:{size:"md",centered:"","no-close-on-esc":"","no-close-on-backdrop":""},scopedSlots:e._u([{key:"modal-header",fn:function(t){t.close;return[s("h6",{staticClass:"modal-title",attrs:{slot:"header",id:"modal-title-default"},slot:"header"},[e._v("Create New Entity")])]}},{key:"default",fn:function(t){t.hide;return[s("el-steps",{attrs:{active:e.formStepIndex,"finish-status":"success","align-center":""}},[s("el-step",{attrs:{title:"Basic Info"}}),s("el-step",{attrs:{title:"Physical Address"}}),s("el-step",{attrs:{title:"Billing Address"}}),s("el-step",{attrs:{title:"Modules"}}),s("el-step",{attrs:{title:"Confirmation"}})],1),s("validation-observer",{ref:"addstep_basic",attrs:{slim:""}},[s("form",{directives:[{name:"show",rawName:"v-show",value:"basic"==e.formStep,expression:"formStep == 'basic'"}],attrs:{role:"addstep_basic"},on:{submit:function(e){return e.preventDefault(),function(){return!1}.apply(null,arguments)}}},[s("b-row",[s("b-col",{attrs:{md:""}},[s("h3",[e._v("Basic Info")]),s("base-input",{attrs:{label:"Entity Name",name:"entity name",rules:"required",placeholder:"Entity Name",vid:"company_name"},model:{value:e.model.company_name,callback:function(t){e.$set(e.model,"company_name",t)},expression:"model.company_name"}}),s("base-input",{attrs:{label:"Entity Logo",name:"entity logo"}},[s("ImageCropUpload",{attrs:{stencilProps:{scalable:!0,movable:!0},resize:{height:32,width:"auto"}},on:{clear:e.clearLogo,done:e.setLogo}})],1),s("base-input",{attrs:{label:"Contact Name",name:"contact name",placeholder:"Contact Name",vid:"contact_name",rules:"required"},model:{value:e.model.contact_name,callback:function(t){e.$set(e.model,"contact_name",t)},expression:"model.contact_name"}}),s("base-input",{attrs:{label:"Contact Email",name:"contact email",placeholder:"Contact Email",vid:"contact_email"},model:{value:e.model.contact_email,callback:function(t){e.$set(e.model,"contact_email",t)},expression:"model.contact_email"}}),s("base-input",{attrs:{label:"Contact Phone",name:"contact phone",placeholder:"Contact Phone",vid:"contact_phone"},model:{value:e.model.contact_phone,callback:function(t){e.$set(e.model,"contact_phone",t)},expression:"model.contact_phone"}})],1)],1)],1)]),s("validation-observer",{ref:"addstep_paddr",attrs:{slim:""}},[s("form",{directives:[{name:"show",rawName:"v-show",value:"paddr"==e.formStep,expression:"formStep == 'paddr'"}],attrs:{role:"addstep_paddr"},on:{submit:function(e){return e.preventDefault(),function(){return!1}.apply(null,arguments)}}},[s("b-row",[s("b-col",{attrs:{md:""}},[s("h3",[e._v("Physical Address")]),s("base-input",{attrs:{name:"physical address line 1",placeholder:"Physical Address Line 1",vid:"physical_address.line_1"},model:{value:e.model.physical_address.line_1,callback:function(t){e.$set(e.model.physical_address,"line_1",t)},expression:"model.physical_address.line_1"}}),s("base-input",{attrs:{name:"physical address line 2",placeholder:"Physical Address Line 2",vid:"physical_address.line_2"},model:{value:e.model.physical_address.line_2,callback:function(t){e.$set(e.model.physical_address,"line_2",t)},expression:"model.physical_address.line_2"}}),s("base-input",{attrs:{name:"physical city",placeholder:"Physical Town/City",vid:"physical_address.city"},model:{value:e.model.physical_address.city,callback:function(t){e.$set(e.model.physical_address,"city",t)},expression:"model.physical_address.city"}}),s("base-input",{attrs:{name:"physical postal code",placeholder:"Physical Postal Code",vid:"physical_address.postalcode"},model:{value:e.model.physical_address.postalcode,callback:function(t){e.$set(e.model.physical_address,"postalcode",t)},expression:"model.physical_address.postalcode"}}),s("base-input",{attrs:{name:"physical country",placeholder:"Physical Country",vid:"physical_address.country"}},[s("el-select",{attrs:{filterable:"",placeholder:"Country"},model:{value:e.model.physical_address.country,callback:function(t){e.$set(e.model.physical_address,"country",t)},expression:"model.physical_address.country"}},e._l(e.countries,(function(e){return s("el-option",{key:e.code,attrs:{label:e.name,value:e.code}})})),1)],1)],1)],1)],1)]),s("validation-observer",{ref:"addstep_baddr",attrs:{slim:""}},[s("form",{directives:[{name:"show",rawName:"v-show",value:"baddr"==e.formStep,expression:"formStep == 'baddr'"}],attrs:{role:"addstep_baddr"},on:{submit:function(e){return e.preventDefault(),function(){return!1}.apply(null,arguments)}}},[s("b-row",[s("b-col",{attrs:{md:""}},[s("h3",[e._v("Billing Address")]),s("base-input",[s("b-form-checkbox",{attrs:{name:"p_as_b",value:"yes","unchecked-value":"no"},model:{value:e.model.p_as_b,callback:function(t){e.$set(e.model,"p_as_b",t)},expression:"model.p_as_b"}},[e._v("\n                    Same as Physical?\n                  ")])],1),s("base-input",{attrs:{name:"billing address line 1",placeholder:"Billing Address Line 1",vid:"billing_address.line_1",disabled:"yes"==e.model.p_as_b},model:{value:"yes"==e.model.p_as_b?e.model.physical_address.line_1:e.model.billing_address.line_1,callback:function(t){e.$set("yes"==e.model.p_as_b?e.model.physical_address.line_1:e.model.billing_address,"line_1",t)},expression:"model.p_as_b == 'yes' ? model.physical_address.line_1     : model.billing_address.line_1"}}),s("base-input",{attrs:{name:"billing address line 2",placeholder:"Billing Address Line 2",vid:"billing_address.line_2",disabled:"yes"==e.model.p_as_b},model:{value:"yes"==e.model.p_as_b?e.model.physical_address.line_2:e.model.billing_address.line_2,callback:function(t){e.$set("yes"==e.model.p_as_b?e.model.physical_address.line_2:e.model.billing_address,"line_2",t)},expression:"model.p_as_b == 'yes' ? model.physical_address.line_2     : model.billing_address.line_2"}}),s("base-input",{attrs:{name:"billing city",placeholder:"Billing Town/City",vid:"billing_address.city",disabled:"yes"==e.model.p_as_b},model:{value:"yes"==e.model.p_as_b?e.model.physical_address.city:e.model.billing_address.city,callback:function(t){e.$set("yes"==e.model.p_as_b?e.model.physical_address.city:e.model.billing_address,"city",t)},expression:"model.p_as_b == 'yes' ? model.physical_address.city       : model.billing_address.city"}}),s("base-input",{attrs:{name:"billing postal code",placeholder:"Billing Postal Code",vid:"billing_address.postalcode",disabled:"yes"==e.model.p_as_b},model:{value:"yes"==e.model.p_as_b?e.model.physical_address.postalcode:e.model.billing_address.postalcode,callback:function(t){e.$set("yes"==e.model.p_as_b?e.model.physical_address.postalcode:e.model.billing_address,"postalcode",t)},expression:"model.p_as_b == 'yes' ? model.physical_address.postalcode : model.billing_address.postalcode"}}),s("base-input",{attrs:{name:"billing country",placeholder:"Billing Country",vid:"billing_address.country"}},[s("el-select",{attrs:{disabled:"yes"==e.model.p_as_b,filterable:"",placeholder:"Country"},model:{value:"yes"==e.model.p_as_b?e.model.physical_address.country:e.model.billing_address.country,callback:function(t){e.$set("yes"==e.model.p_as_b?e.model.physical_address.country:e.model.billing_address,"country",t)},expression:"model.p_as_b == 'yes' ? model.physical_address.country : model.billing_address.country"}},e._l(e.countries,(function(e){return s("el-option",{key:e.code,attrs:{label:e.name,value:e.code}})})),1)],1)],1)],1)],1)]),s("validation-observer",{ref:"addstep_modules",attrs:{slim:""}},[s("form",{directives:[{name:"show",rawName:"v-show",value:"modules"==e.formStep,expression:"formStep == 'modules'"}],attrs:{role:"addstep_modules"},on:{submit:function(e){return e.preventDefault(),function(){return!1}.apply(null,arguments)}}},[s("b-row",[s("b-col",{attrs:{md:""}},[s("h3",[e._v("Modules")]),s("base-input",{attrs:{name:"modules",vid:"modules",rules:"required"}},[s("b-form-checkbox",{attrs:{size:"lg","unchecked-value":"",value:"Soil Moisture"},model:{value:e.model.modules,callback:function(t){e.$set(e.model,"modules",t)},expression:"model.modules"}},[e._v("Soil Moisture")]),e.isAdmin()?s("b-form-checkbox",{attrs:{size:"lg","unchecked-value":"",value:"Nutrients"},model:{value:e.model.modules,callback:function(t){e.$set(e.model,"modules",t)},expression:"model.modules"}},[e._v("Nutrients")]):e._e(),s("b-form-checkbox",{attrs:{size:"lg","unchecked-value":"",value:"Well Controls"},model:{value:e.model.modules,callback:function(t){e.$set(e.model,"modules",t)},expression:"model.modules"}},[e._v("Well Controls")]),s("b-form-checkbox",{attrs:{size:"lg","unchecked-value":"",value:"Meters"},model:{value:e.model.modules,callback:function(t){e.$set(e.model,"modules",t)},expression:"model.modules"}},[e._v("Meters")])],1)],1)],1)],1)]),s("b-row",{directives:[{name:"show",rawName:"v-show",value:"confirm"==e.formStep,expression:"formStep == 'confirm'"}]},[s("b-col",[s("h3",[e._v("Confirmation")]),s("b-row",[s("b-col",[s("b-table-simple",{attrs:{responsive:"",small:""}},[s("b-tr",[s("b-td",[s("strong",[e._v("Entity Name")])]),s("b-td",[s("strong",[e._v("Logo?")])])],1),s("b-tr",[s("b-td",[e._v(e._s(e.model.company_name))]),s("b-td",[e._v(e._s(e.model.company_logo?"Yes":"No"))])],1)],1)],1)],1),s("b-row",[s("b-col",[s("b-table-simple",{attrs:{responsive:"",small:""}},[s("b-tr",[s("b-td",[s("strong",[e._v("Contact Name")])]),s("b-td",[s("strong",[e._v("Contact Email")])]),s("b-td",[s("strong",[e._v("Contact Phone")])])],1),s("b-tr",[s("b-td",[e._v(e._s(e.model.contact_name))]),s("b-td",[e._v(e._s(e.model.contact_email))]),s("b-td",[e._v(e._s(e.model.contact_phone))])],1)],1)],1)],1),s("b-row",[s("b-col",[s("b-table-simple",{attrs:{responsive:"",small:""}},[s("b-tr",[s("b-td",[s("strong",[e._v("Address Details")])]),s("b-td",[s("strong",[e._v("Physical")])]),s("b-td",[s("strong",[e._v("Billing")])])],1),s("b-tr",[s("b-td",[e._v("Line 1")]),s("b-td",[e._v(e._s(e.model.physical_address.line_1))]),s("b-td",[e._v(e._s("yes"==e.model.p_as_b?e.model.physical_address.line_1:e.model.billing_address.line_1))])],1),s("b-tr",[s("b-td",[e._v("Line 2")]),s("b-td",[e._v(e._s(e.model.physical_address.line_2))]),s("b-td",[e._v(e._s("yes"==e.model.p_as_b?e.model.physical_address.line_2:e.model.billing_address.line_2))])],1),s("b-tr",[s("b-td",[e._v("City/Town")]),s("b-td",[e._v(e._s(e.model.physical_address.city))]),s("b-td",[e._v(e._s("yes"==e.model.p_as_b?e.model.physical_address.city:e.model.billing_address.city))])],1),s("b-tr",[s("b-td",[e._v("Postal Code")]),s("b-td",[e._v(e._s(e.model.physical_address.postalcode))]),s("b-td",[e._v(e._s("yes"==e.model.p_as_b?e.model.physical_address.postalcode:e.model.billing_address.postalcode))])],1),s("b-tr",[s("b-td",[e._v("Country")]),s("b-td",[e._v(e._s(e.model.physical_address.country))]),s("b-td",[e._v(e._s("yes"==e.model.p_as_b?e.model.physical_address.country:e.model.billing_address.country))])],1)],1)],1)],1),s("b-row",[s("b-col",{attrs:{md:""}},[s("b-table-simple",{attrs:{responsive:"",small:""}},[s("b-tr",[s("b-td",[s("strong",[e._v("Modules")])])],1),s("b-tr",[s("b-td",[s("span",{staticClass:"wswrap"},[e._v(e._s(e.model.modules.join(", ")))])])],1)],1)],1)],1),s("b-row",[e.model.add_roles.length?s("b-col",{attrs:{md:""}},[s("b-table-simple",{attrs:{responsive:"",small:""}},[s("b-tr",[s("b-td",[s("strong",[e._v("Roles")])])],1),s("b-tr",[s("b-td",[s("span",{staticClass:"wswrap"},[e._v(e._s(e.model.add_roles.join(", ")))])])],1)],1)],1):e._e(),e.model.add_groups.length?s("b-col",{attrs:{md:""}},[s("b-table-simple",{attrs:{responsive:"",small:""}},[s("b-tr",[s("b-td",[s("strong",[e._v("Groups")])])],1),s("b-tr",[s("b-td",[e.subsystems?s("span",{staticClass:"wswrap"},[e._v(e._s(e.model.add_groups.map((function(t){return t.group_name+" ("+e.subsystems[t.subsystem_id].subsystem_name+")"})).join(", ")))]):e._e()])],1)],1)],1):e._e()],1)],1)],1)]}},{key:"modal-footer",fn:function(t){t.ok,t.cancel,t.hide;return[s("base-button",{staticClass:"mr-auto",attrs:{type:"outline-primary"},on:{click:function(t){return e.closeCreateCompanyModal()}}},[e._v("Cancel")]),s("base-button",{directives:[{name:"show",rawName:"v-show",value:"basic"!=e.formStep,expression:"formStep != 'basic'"}],staticClass:"ml-auto",attrs:{type:"outline-primary"},on:{click:function(t){return e.prevStep()}}},[e._v("Previous")]),s("base-button",{attrs:{type:"primary"},on:{click:function(t){"confirm"==e.formStep?e.createCompany():e.nextStep()}}},[e._v(" "+e._s("confirm"==e.formStep?"Create":"Next"))])]}}]),model:{value:e.showCompanyCreationModal,callback:function(t){e.showCompanyCreationModal=t},expression:"showCompanyCreationModal"}}),s("b-modal",{attrs:{size:"md",centered:"","no-close-on-esc":"","no-close-on-backdrop":""},scopedSlots:e._u([{key:"modal-header",fn:function(t){t.close;return[s("h6",{staticClass:"modal-title",attrs:{slot:"header",id:"modal-title-default"},slot:"header"},[e._v("Remove Entity: "+e._s(e.delete_company_name))])]}},{key:"default",fn:function(t){t.hide;return[s("validation-observer",{directives:[{name:"slots",rawName:"v-slots",value:{validate:e.validate,reset:e.reset},expression:"{ validate, reset }"}],ref:"remcc",attrs:{slim:""}},[s("form",{staticClass:"cc_move_form",attrs:{role:"form"},on:{submit:function(e){return e.preventDefault(),function(){return!1}.apply(null,arguments)}}},[s("b-row",[s("b-col",{attrs:{md:""}},[s("h2",[e._v(e._s(e.move_model.move_company?"Relocation Configuration":"Please confirm Entity Removal")+" ")])])],1),s("b-row",[s("b-col",{attrs:{md:""}},[s("b-form-checkbox",{attrs:{size:"lg",name:"move_company",value:!0,"unchecked-value":!1},model:{value:e.move_model.move_company,callback:function(t){e.$set(e.move_model,"move_company",t)},expression:"move_model.move_company"}},[e._v("\n                  Relocate Entity Objects ?\n                ")])],1)],1),e.move_model.move_company?[s("b-row",[s("b-col",{attrs:{md:""}},[s("base-input",{attrs:{label:"Destination Entity",rules:"required",vid:"destination_entity",name:"destination entity"}},[s("el-select",{attrs:{filterable:"","value-key":"id",placeholder:"Choose Entity"},on:{change:function(t){return e.getNewCompanyMoveMeta(e.move_model.new_company_id)}},model:{value:e.move_model.new_company_id,callback:function(t){e.$set(e.move_model,"new_company_id",t)},expression:"move_model.new_company_id"}},[e._l(e.move_model.target_companies,(function(e,t){return[s("el-option",{key:t,attrs:{label:e.company_name,value:e.id}})]}))],2)],1)],1)],1),e.move_model.new_company_id?s("b-row",[s("b-col",{attrs:{md:""}},[s("base-input",{attrs:{label:"Choose Objects",rules:"required",vid:"move_types",name:"chosen objects"}},[s("b-form-group",[s("b-form-checkbox-group",{attrs:{size:"lg",options:e.move_model.movable_objects},on:{change:e.reset},model:{value:e.move_model.move_types,callback:function(t){e.$set(e.move_model,"move_types",t)},expression:"move_model.move_types"}})],1)],1)],1)],1):e._e(),e.move_model.new_company_id&&-1!==e.move_model.move_types.indexOf("nodes")?s("b-row",[s("b-col",{attrs:{md:""}},[s("h3",[e._v("Map Sensors")]),e.move_model.sensor_mappings.length>0&&e.move_model.new_sensors.length>0?s("b-table-simple",{attrs:{responsive:"",small:""}},[s("b-tr",[s("b-th",[s("strong",[e._v(e._s(e.delete_company_name))])]),s("b-th",[e._v("Device Type")]),s("b-th",{staticClass:"text-right"},[s("strong",[e._v(e._s(e.move_model.target_companies['"'+e.move_model.new_company_id.toString()+'"'].company_name))])])],1),e._l(e.move_model.sensor_mappings,(function(t,o){return[s("b-tr",{key:t.old_sensor_id},[e.move_model.counts[t.old_sensor_type]?[s("b-td",{staticClass:"valign"},[e._v("\n                            "+e._s(t.old_sensor_name)+"\n                          ")]),s("b-td",{staticClass:"valign"},[e._v("\n                            "+e._s(t.old_sensor_type)+"\n                          ")]),s("b-td",{staticClass:"valign"},[s("base-input",{attrs:{vid:"new_sensors_"+o,rules:"required",name:"new sensor choice"}},[s("el-select",{attrs:{"value-key":"id",size:"small",filterable:"",rules:"required",placeholder:"New Sensor"},model:{value:t.new_sensor_id,callback:function(s){e.$set(t,"new_sensor_id",s)},expression:"sensormap.new_sensor_id"}},e._l(e.move_model.new_sensors,(function(o){return t.old_sensor_type==o.device_type?s("el-option",{key:o.id,attrs:{label:o.device_make,value:o.id}}):e._e()})),1)],1)],1)]:[s("b-td",[e._v(e._s(t.old_sensor_name))]),s("b-td",[e._v(e._s(t.old_sensor_type))]),s("b-td",{staticClass:"text-right"},[e._v("(to be relocated as-is)")])]],2)]}))],2):s("p",[0==e.move_model.sensor_mappings.length?[e._v("\n                      No Active/Used Sensors to Map\n                    ")]:0==e.move_model.new_sensors.length?[s("strong",[e._v(e._s(e.move_model.target_companies['"'+e.move_model.new_company_id.toString()+'"'].company_name))]),e._v(" has no sensors defined."),s("br"),s("strong",[e._v(e._s(e.delete_company_name))]),e._v("'s sensors will be moved over.\n                    ")]:e._e()],2)],1)],1):e._e(),e.move_model.new_company_id&&-1!==e.move_model.move_types.indexOf("users")?s("b-row",[s("b-col",{attrs:{md:""}},[s("h3",[e._v("Map User Roles")]),e.move_model.role_mappings.length>0&&e.move_model.new_roles.length>0?s("b-table-simple",{attrs:{responsive:"",small:""}},[s("b-tr",[s("b-th",[e._v(e._s(e.delete_company_name))]),s("b-th"),s("b-th",{staticClass:"text-right"},[e._v(e._s(e.move_model.target_companies['"'+e.move_model.new_company_id.toString()+'"'].company_name))])],1),e._l(e.move_model.role_mappings,(function(t,o){return[s("b-tr",{key:t.old_role_id},[s("b-td",{staticClass:"valign"},[e._v("\n                          "+e._s(t.old_role_name)+"\n                        ")]),s("b-td",{staticClass:"valign text-center"},[s("b-icon",{attrs:{icon:"arrow-right-circle",animation:"cyclon"}})],1),s("b-td",{staticClass:"valign"},[s("base-input",{attrs:{vid:"new_roles_"+o,rules:"required",name:"new role choice"}},[s("el-select",{attrs:{"value-key":"id",size:"mini",filterable:"",rules:"required",placeholder:"New Role"},model:{value:t.new_role_id,callback:function(s){e.$set(t,"new_role_id",s)},expression:"rolemap.new_role_id"}},e._l(e.move_model.new_roles,(function(e){return s("el-option",{key:e.id,attrs:{label:e.role_name,value:e.id}})})),1)],1)],1)],1)]}))],2):s("p",[0==e.move_model.role_mappings.length?[e._v("\n                      No Active/Used Roles to Map\n                    ")]:0==e.move_model.new_roles.length?[s("strong",[e._v(e._s(e.move_model.target_companies['"'+e.move_model.new_company_id.toString()+'"'].company_name))]),e._v(" has no roles defined."),s("br"),s("strong",[e._v(e._s(e.delete_company_name))]),e._v("'s roles will be relocated as-is.\n                    ")]:e._e()],2)],1)],1):e._e()]:e._e()],2)])]}},{key:"modal-footer",fn:function(t){t.ok,t.cancel,t.hide;return[s("base-button",{staticClass:"mr-auto",attrs:{type:"outline-primary"},on:{click:function(t){return e.closeCompanyRemovalModal()}}},[e._v("Cancel")]),s("base-button",{attrs:{type:"primary"},on:{click:function(t){e.move_model.move_company?e.moveCompanyThenDelete():e.deleteCompany()}}},[e._v("\n          "+e._s(e.move_model.move_company?"Relocate then Remove":"Remove")+"\n          ")])]}}]),model:{value:e.showCompanyRemovalModal,callback:function(t){e.showCompanyRemovalModal=t},expression:"showCompanyRemovalModal"}}),s("card",{staticClass:"no-border-card",attrs:{"body-classes":"px-0 pb-1","footer-classes":"pb-2"}},[s("template",{slot:"header"},[s("base-button",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover.top",modifiers:{hover:!0,top:!0}}],staticClass:"btn",attrs:{disabled:!e.userCan("Add","Entities")||e.loading,size:"sm",type:"primary",title:"An Entity may contain various resources (Such as users, roles, nodes, sensors, etc) and is the top-level container object in MAB.",icon:""},nativeOn:{click:function(t){return e.showCreateCompanyModal()}}},[e._v("\n          Create Entity\n        ")]),s("base-button",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover.top",modifiers:{hover:!0,top:!0}}],staticClass:"btn",attrs:{disabled:e.loading||!e.isDistributor()&&!e.isAdmin(),size:"sm",type:"primary",title:"Entity Related Reporting",icon:""},nativeOn:{click:function(t){return e.goToDevicePlacementReporting()}}},[e._v("\n          Reporting\n        ")])],1),s("b-row",{staticClass:"nomargin"},[s("b-col",{attrs:{md:""}},[s("b-form-select",{on:{change:e.loadCompanies},model:{value:e.perPage,callback:function(t){e.perPage=t},expression:"perPage"}},[s("b-form-select-option",{attrs:{value:5}},[e._v("5")]),s("b-form-select-option",{attrs:{value:10,selected:""}},[e._v("10")]),s("b-form-select-option",{attrs:{value:25}},[e._v("25")]),s("b-form-select-option",{attrs:{value:50}},[e._v("50")])],1)],1),s("b-col",{attrs:{md:""}}),s("b-col",{attrs:{md:""}},[s("base-input",{attrs:{"prepend-icon":"fas fa-search"}},[s("b-input",{attrs:{debounce:1e3,placeholder:"Search..."},on:{update:e.loadCompanies},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}})],1)],1)],1),s("b-row",{staticClass:"nomargin"},[s("b-col",{attrs:{md:""}},[s("b-table",{attrs:{striped:"",bordered:"",outlined:"",small:"",stacked:"lg",responsive:"","show-empty":"","primary-key":"id","no-local-sorting":"",fields:e.tableColumns,items:e.tableData,busy:e.bInitialQuery},on:{"sort-changed":e.sortingChanged,"update:busy":function(t){e.bInitialQuery=t}},scopedSlots:e._u([{key:"cell()",fn:function(t){return[e._v("\n              "+e._s(t.value)+"\n            ")]}},e.isAdmin()||e.isDistributor()?{key:"cell(parent_entity)",fn:function(t){return[t.value?s("span",[e._v(e._s(t.value))]):s("b-icon",{attrs:{variant:"success",icon:"asterisk",title:"Top Level Entity","aria-hidden":"true"}})]}}:null,e.isAdmin()?{key:"cell(is_distributor)",fn:function(e){return[e.value?s("b-icon",{attrs:{variant:"success",icon:"check-circle","aria-hidden":"true"}}):s("b-icon",{attrs:{variant:"success",icon:"circle","aria-hidden":"true"}})]}}:null,e.canAction?{key:"cell(actions)",fn:function(t){return[s("div",{staticClass:"d-flex justify-content-center"},[s("b-button",{staticClass:"btn",attrs:{disabled:!e.userCan("Edit","Entities",t.item.id,"C"),size:"sm",variant:"outline-primary",icon:""},on:{click:function(s){return e.handleEdit(t.index,t.item)}}},[e._v("\n                Configure\n                ")]),s("b-button",{staticClass:"btn",attrs:{disabled:!e.userCan("Delete","Entities",t.item.id,"C"),size:"sm",variant:"outline-primary",icon:""},on:{click:function(s){return e.openCompanyRemovalModal(t.index,t.item)}}},[e._v("\n                Remove\n                ")])],1)]}}:null,{key:"table-busy",fn:function(){return[s("div",{staticClass:"text-center"},[s("div",{staticClass:"mab_spinner"})])]},proxy:!0},{key:"emptyfiltered",fn:function(){return[s("div",{staticClass:"text-center"},[e._v("\n                No matches found\n              ")])]},proxy:!0},{key:"empty",fn:function(){return[s("div",{staticClass:"text-center"},[e._v("\n                No entries found\n              ")])]},proxy:!0}],null,!0)})],1)],1),s("div",{staticClass:"align-right",attrs:{slot:"footer"},slot:"footer"},[s("b-row",[s("b-col",{attrs:{md:""}},[e._v("\n            Showing "+e._s(Math.min(1+e.perPage*(e.currentPage-1),e.totalRows))+" to "+e._s(Math.min(e.perPage*(e.currentPage-1)+e.perPage,e.totalRows))+" of "+e._s(e.totalRows)+" entries\n          ")]),s("b-col",{attrs:{md:""}},[s("b-pagination",{attrs:{"total-rows":e.totalRows,"per-page":e.perPage,align:"right"},on:{input:e.loadCompanies},model:{value:e.currentPage,callback:function(t){e.currentPage=t},expression:"currentPage"}})],1)],1)],1)],2)],1)],1)},n=[],i=s("bd86"),l=(s("6611"),s("450d"),s("e772")),r=s.n(l),d=(s("1f1a"),s("4e4b")),c=s.n(d),m=(s("9c49"),s("6640")),p=s.n(m),_=(s("7f7f"),s("d2ac"),s("95b0")),u=s.n(_),b=(s("3d20"),s("8fe0")),v=s("34e0"),h=s("8aad"),y={mixins:[b["a"]],components:(o={},Object(i["a"])(o,u.a.name,u.a),Object(i["a"])(o,p.a.name,p.a),Object(i["a"])(o,c.a.name,c.a),Object(i["a"])(o,r.a.name,r.a),Object(i["a"])(o,"ImageCropUpload",v["a"]),o),data:function(){return{loading:!1,bInitialQuery:!0,countries:h["a"],tableColumns:[{key:"company_name",label:"Entity",sortable:!0,tdClass:"valign"},{key:"user_count",label:"Users",tdClass:"valign"},{key:"role_count",label:"Roles",tdClass:"valign"},{key:"group_count",label:"Groups",tdClass:"valign"},{key:"node_count",label:"Nodes",tdClass:"valign"}],tableData:[],totalRows:1,currentPage:1,perPage:10,filterText:"",sortBy:this.isAdmin()||this.isDistributor()?"parent_entity":"company_name",sortDir:this.isAdmin()||this.isDistributor()?0:1,showCompanyCreationModal:!1,showCompanyRemovalModal:!1,delete_company_id:null,delete_company_name:"",model:{company_name:"",company_logo:"",p_as_b:"no",physical_address:{line_1:"",line_2:"",city:"",postalcode:"",country:"US"},billing_address:{line_1:"",line_2:"",city:"",postalcode:"",country:"US"},contact_name:"",contact_email:"",contact_phone:"",modules:[],add_groups:[],add_roles:[]},move_model:{move_company:!1,old_company_id:null,new_company_id:null,sensor_mappings:[],role_mappings:[],new_sensors:[],counts:[],new_roles:[],move_types:["nodes","users"],target_companies:[],movable_objects:[{text:"Nodes",value:"nodes"},{text:"Users",value:"users"}]},add_group:{group_name:"",subsystem_id:null},canAction:!1,formStep:"basic",formSteps:[],formStepIndex:0,formsValid:!1,totals:null}},methods:{loadCompanies:function(){var e=this;this.loading=!0,this.$axios.post(this.$store.state.baseUrl+"/api/companies",{cur_page:this.currentPage,per_page:this.perPage,initial:this.bInitialQuery,filter:this.filterText,sort_by:this.sortBy,sort_dir:this.sortDir?"desc":"asc"}).then((function(t){e.loading=!1,e.bInitialQuery&&(e.isAdmin()||e.isDistributor())&&e.tableColumns.unshift({key:"parent_entity",label:"Parent Entity",sortable:!0,tdClass:"valign",thClass:"valign"}),e.bInitialQuery&&e.isAdmin()&&e.tableColumns.push({key:"is_distributor",label:"Distributor",tdClass:"halign valign",thClass:"halign valign"}),e.bInitialQuery&&(e.userCan("Edit","Entities")||e.userCan("Delete","Entities"))&&(e.canAction=!0,e.tableColumns.push({key:"actions",label:"Actions",thClass:"halign"})),e.tableData=t.data.rows,e.totalRows=t.data.total,e.totals=t.data.totals,0==e.totalRows&&(e.currentPage=1),e.bInitialQuery&&(e.formSteps=["basic","paddr","baddr","modules"],e.formSteps.push("confirm"));for(var s=0;s<e.tableColumns.length;s++)"user_count"==e.tableColumns[s].key?e.tableColumns[s].label="Users ("+t.data.totals.user_count+")":"role_count"==e.tableColumns[s].key?e.tableColumns[s].label="Roles ("+t.data.totals.role_count+")":"group_count"==e.tableColumns[s].key?e.tableColumns[s].label="Groups ("+t.data.totals.group_count+")":"node_count"==e.tableColumns[s].key&&(e.tableColumns[s].label="Nodes ("+t.data.totals.node_count+")");e.bInitialQuery=!1}))},loadSubsystems:function(){var e=this;this.$axios.get(this.$store.state.baseUrl+"/api/subsystems").then((function(t){e.subsystems=t.data.subsystems}))},handleEdit:function(e,t){this.$router.push({name:"entities_manage_edit",params:{id:t.id}})},goToDevicePlacementReporting:function(){this.$router.push({name:"entities_report",params:{report:"device_usage"}})},openCompanyRemovalModal:function(e,t){this.delete_company_id=t.id,this.delete_company_name=t.company_name,this.getOldCompanyMoveMeta(t.id),this.showCompanyRemovalModal=!0},closeCompanyRemovalModal:function(){this.delete_company_id=null,this.delete_company_name=null,this.clearCompanyMoveModel(),this.showCompanyRemovalModal=!1},moveCompanyThenDelete:function(){var e=this;this.$refs.remcc.validate().then((function(t){t&&(e.loading=!0,e.$axios.post(e.$store.state.baseUrl+"/api/company_move",e.move_model).then((function(t){e.loading=!1,"company_moved"==t.data.message&&(e.$notify({title:"Status",message:"Entity Objects Relocated",type:"success",verticalAlign:"top",horizontalAlign:"right"}),e.deleteCompany())})))}))},createCompany:function(){var e=this;console.log(this.model),this.formsValid&&(this.loading=!0,this.$axios.post(this.$store.state.baseUrl+"/api/company_add",this.model).then((function(t){e.loading=!1,"company_added"==t.data.message?(e.loadCompanies(),e.clearModel(),e.closeCreateCompanyModal(),e.$notify({title:"Success",message:"New entity created",type:"success",verticalAlign:"top",horizontalAlign:"right"})):"entity_exists"==t.data.message&&e.$notify({title:"Failure",message:"Entity already exists",type:"success",verticalAlign:"top",horizontalAlign:"right"})})).catch((function(t){e.loading=!1,t.response.data.errors&&e.$refs.form.setErrors(t.response.data.errors)})))},deleteCompany:function(){var e=this;this.loading=!0,this.$axios.post(this.$store.state.baseUrl+"/api/company_destroy",{id:this.delete_company_id}).then((function(t){e.loading=!1,"company_removed"==t.data.message?(e.loadCompanies(),e.$notify({title:"Status",message:"Entity Removed",type:"success",verticalAlign:"top",horizontalAlign:"right"})):"company_in_use"==t.data.message?e.$notify({title:"Failed",message:"Cannot remove entity: "+t.data.object_count+" "+t.data.object_type+" still using it.",type:"danger",verticalAlign:"top",horizontalAlign:"right"}):"company_missing"==t.data.message&&e.$notify({title:"Failed",message:"Cannot remove entity: Entity doesn't exist",type:"danger",verticalAlign:"top",horizontalAlign:"right"}),e.closeCompanyRemovalModal()}))},getOldCompanyMoveMeta:function(e){var t=this;this.loading=!0,this.$axios.get(this.$store.state.baseUrl+"/api/company_move_om/"+e).then((function(s){t.loading=!1,s.data&&(t.move_model.old_company_id=e,t.move_model.sensor_mappings=s.data.sensor_mappings,t.move_model.role_mappings=s.data.role_mappings,t.move_model.target_companies=s.data.target_companies)})).catch((function(e){t.loading=!1}))},getNewCompanyMoveMeta:function(e){var t=this;this.loading=!0,this.$axios.get(this.$store.state.baseUrl+"/api/company_move_nm/"+e).then((function(e){t.loading=!1,e.data&&(t.move_model.new_sensors=e.data.new_sensors,t.move_model.counts=e.data.counts,t.move_model.new_roles=e.data.new_roles)})).catch((function(e){t.loading=!1}))},clearCompanyMoveModel:function(){this.move_model.move_company=!1,this.move_model.old_company_id=null,this.move_model.new_company_id=null,this.move_model.sensor_mappings=[],this.move_model.role_mappings=[],this.move_model.new_sensors=[],this.move_model.new_roles=[],this.move_model.move_types=[],this.move_model.target_companies=[],this.move_model.movable_objects=[{text:"Nodes",value:"nodes"},{text:"Users",value:"users"}]},clearModel:function(){this.formStep="basic",this.formStepIndex=0,this.model.company_name="",this.model.company_logo="",this.model.p_as_b="no",this.model.physical_address.line_1="",this.model.physical_address.line_2="",this.model.physical_address.city="",this.model.physical_address.postalcode="",this.model.physical_address.country="US",this.model.billing_address.line_1="",this.model.billing_address.line_2="",this.model.billing_address.city="",this.model.billing_address.postalcode="",this.model.billing_address.country="US",this.model.contact_name="",this.model.contact_email="",this.model.contact_phone="",this.model.add_groups=[],this.model.add_roles=[],this.model.modules=[]},showCreateCompanyModal:function(){this.formStep="basic",this.formStepIndex=0,this.showCompanyCreationModal=!0},closeCreateCompanyModal:function(){this.clearModel(),this.showCompanyCreationModal=!1,this.formStep="basic",this.formStepIndex=0},addGroup:function(){this.add_group.group_name&&this.add_group.subsystem_id&&(this.model.add_groups.push(JSON.parse(JSON.stringify(this.add_group))),this.add_group.group_name="",this.add_group.subsystem_id=null)},removeGroup:function(e){this.model.add_groups.splice(e,1)},nextStep:function(){var e=this;this.$refs["addstep_"+this.formSteps[this.formStepIndex]].validate().then((function(t){t?(e.formsValid=!0,e.formStepIndex<e.formSteps.length-1&&(e.formStepIndex++,e.formStep=e.formSteps[e.formStepIndex])):e.formsValid=!1}))},prevStep:function(){this.formStepIndex>0&&(this.formStepIndex--,this.formStep=this.formSteps[this.formStepIndex]),this.$refs["addstep_"+this.formSteps[this.formStepIndex]].reset()},setLogo:function(e){console.log(e),this.model.company_logo=e},clearLogo:function(){this.model.company_logo=""},sortingChanged:function(e){this.sortBy=e.sortBy,this.sortDir=e.sortDesc,this.loadCompanies()}},watch:{filterText:function(e,t){this.currentPage=e!=t?1:this.currentPage}},mounted:function(){this.loadCompanies(),this.loadSubsystems()}},f=y,g=(s("4c9a"),s("2877")),C=Object(g["a"])(f,a,n,!1,null,null,null);t["default"]=C.exports},"4c9a":function(e,t,s){"use strict";s("d59b")},6640:function(e,t){e.exports=function(e){var t={};function s(o){if(t[o])return t[o].exports;var a=t[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,s),a.l=!0,a.exports}return s.m=e,s.c=t,s.d=function(e,t,o){s.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/dist/",s(s.s=327)}({0:function(e,t){e.exports=function(e,t,s,o,a,n){var i,l=e=e||{},r=typeof e.default;"object"!==r&&"function"!==r||(i=e,l=e.default);var d,c="function"===typeof l?l.options:l;if(t&&(c.render=t.render,c.staticRenderFns=t.staticRenderFns,c._compiled=!0),s&&(c.functional=!0),a&&(c._scopeId=a),n?(d=function(e){e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,e||"undefined"===typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),o&&o.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(n)},c._ssrRegister=d):o&&(d=o),d){var m=c.functional,p=m?c.render:c.beforeCreate;m?(c._injectStyles=d,c.render=function(e,t){return d.call(t),p(e,t)}):c.beforeCreate=p?[].concat(p,d):[d]}return{esModule:i,exports:l,options:c}}},327:function(e,t,s){"use strict";t.__esModule=!0;var o=s(328),a=n(o);function n(e){return e&&e.__esModule?e:{default:e}}a.default.install=function(e){e.component(a.default.name,a.default)},t.default=a.default},328:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=s(329),a=s.n(o),n=s(330),i=s(0),l=!1,r=null,d=null,c=null,m=i(a.a,n["a"],l,r,d,c);t["default"]=m.exports},329:function(e,t,s){"use strict";t.__esModule=!0,t.default={name:"ElStep",props:{title:String,icon:String,description:String,status:String},data:function(){return{index:-1,lineStyle:{},internalStatus:""}},beforeCreate:function(){this.$parent.steps.push(this)},beforeDestroy:function(){var e=this.$parent.steps,t=e.indexOf(this);t>=0&&e.splice(t,1)},computed:{currentStatus:function(){return this.status||this.internalStatus},prevStatus:function(){var e=this.$parent.steps[this.index-1];return e?e.currentStatus:"wait"},isCenter:function(){return this.$parent.alignCenter},isVertical:function(){return"vertical"===this.$parent.direction},isSimple:function(){return this.$parent.simple},isLast:function(){var e=this.$parent;return e.steps[e.steps.length-1]===this},stepsCount:function(){return this.$parent.steps.length},space:function(){var e=this.isSimple,t=this.$parent.space;return e?"":t},style:function(){var e={},t=this.$parent,s=t.steps.length,o="number"===typeof this.space?this.space+"px":this.space?this.space:100/(s-(this.isCenter?0:1))+"%";return e.flexBasis=o,this.isVertical||(this.isLast?e.maxWidth=100/this.stepsCount+"%":e.marginRight=-this.$parent.stepOffset+"px"),e}},methods:{updateStatus:function(e){var t=this.$parent.$children[this.index-1];e>this.index?this.internalStatus=this.$parent.finishStatus:e===this.index&&"error"!==this.prevStatus?this.internalStatus=this.$parent.processStatus:this.internalStatus="wait",t&&t.calcProgress(this.internalStatus)},calcProgress:function(e){var t=100,s={};s.transitionDelay=150*this.index+"ms",e===this.$parent.processStatus?(this.currentStatus,t=0):"wait"===e&&(t=0,s.transitionDelay=-150*this.index+"ms"),s.borderWidth=t?"1px":0,"vertical"===this.$parent.direction?s.height=t+"%":s.width=t+"%",this.lineStyle=s}},mounted:function(){var e=this,t=this.$watch("index",(function(s){e.$watch("$parent.active",e.updateStatus,{immediate:!0}),t()}))}}},330:function(e,t,s){"use strict";var o=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"el-step",class:[!e.isSimple&&"is-"+e.$parent.direction,e.isSimple&&"is-simple",e.isLast&&!e.space&&!e.isCenter&&"is-flex",e.isCenter&&!e.isVertical&&!e.isSimple&&"is-center"],style:e.style},[s("div",{staticClass:"el-step__head",class:"is-"+e.currentStatus},[s("div",{staticClass:"el-step__line",style:e.isLast?"":{marginRight:e.$parent.stepOffset+"px"}},[s("i",{staticClass:"el-step__line-inner",style:e.lineStyle})]),s("div",{staticClass:"el-step__icon",class:"is-"+(e.icon?"icon":"text")},["success"!==e.currentStatus&&"error"!==e.currentStatus?e._t("icon",[e.icon?s("i",{staticClass:"el-step__icon-inner",class:[e.icon]}):e._e(),e.icon||e.isSimple?e._e():s("div",{staticClass:"el-step__icon-inner"},[e._v(e._s(e.index+1))])]):s("i",{staticClass:"el-step__icon-inner is-status",class:["el-icon-"+("success"===e.currentStatus?"check":"close")]})],2)]),s("div",{staticClass:"el-step__main"},[s("div",{ref:"title",staticClass:"el-step__title",class:["is-"+e.currentStatus]},[e._t("title",[e._v(e._s(e.title))])],2),e.isSimple?s("div",{staticClass:"el-step__arrow"}):s("div",{staticClass:"el-step__description",class:["is-"+e.currentStatus]},[e._t("description",[e._v(e._s(e.description))])],2)])])},a=[],n={render:o,staticRenderFns:a};t["a"]=n}})},"95b0":function(e,t,s){e.exports=function(e){var t={};function s(o){if(t[o])return t[o].exports;var a=t[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,s),a.l=!0,a.exports}return s.m=e,s.c=t,s.d=function(e,t,o){s.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/dist/",s(s.s=323)}({0:function(e,t){e.exports=function(e,t,s,o,a,n){var i,l=e=e||{},r=typeof e.default;"object"!==r&&"function"!==r||(i=e,l=e.default);var d,c="function"===typeof l?l.options:l;if(t&&(c.render=t.render,c.staticRenderFns=t.staticRenderFns,c._compiled=!0),s&&(c.functional=!0),a&&(c._scopeId=a),n?(d=function(e){e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,e||"undefined"===typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),o&&o.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(n)},c._ssrRegister=d):o&&(d=o),d){var m=c.functional,p=m?c.render:c.beforeCreate;m?(c._injectStyles=d,c.render=function(e,t){return d.call(t),p(e,t)}):c.beforeCreate=p?[].concat(p,d):[d]}return{esModule:i,exports:l,options:c}}},323:function(e,t,s){"use strict";t.__esModule=!0;var o=s(324),a=n(o);function n(e){return e&&e.__esModule?e:{default:e}}a.default.install=function(e){e.component(a.default.name,a.default)},t.default=a.default},324:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=s(325),a=s.n(o),n=s(326),i=s(0),l=!1,r=null,d=null,c=null,m=i(a.a,n["a"],l,r,d,c);t["default"]=m.exports},325:function(e,t,s){"use strict";t.__esModule=!0;var o=s(8),a=n(o);function n(e){return e&&e.__esModule?e:{default:e}}t.default={name:"ElSteps",mixins:[a.default],props:{space:[Number,String],active:Number,direction:{type:String,default:"horizontal"},alignCenter:Boolean,simple:Boolean,finishStatus:{type:String,default:"finish"},processStatus:{type:String,default:"process"}},data:function(){return{steps:[],stepOffset:0}},methods:{getMigratingConfig:function(){return{props:{center:"center is removed."}}}},watch:{active:function(e,t){this.$emit("change",e,t)},steps:function(e){e.forEach((function(e,t){e.index=t}))}}}},326:function(e,t,s){"use strict";var o=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"el-steps",class:[!e.simple&&"el-steps--"+e.direction,e.simple&&"el-steps--simple"]},[e._t("default")],2)},a=[],n={render:o,staticRenderFns:a};t["a"]=n},8:function(e,t){e.exports=s("2bb5")}})},"9c49":function(e,t,s){},d2ac:function(e,t,s){},d59b:function(e,t,s){}}]);
//# sourceMappingURL=chunk-6fca930c.1747451e.js.map