(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7234f0d2"],{4344:function(e,t,s){"use strict";s.r(t);var a,i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"content"},[s("base-header",{staticClass:"pb-6",attrs:{type:"users"}},[s("b-row",{staticClass:"py-4",attrs:{"align-v":"center"}},[s("b-col",[s("h6",{staticClass:"h2 text-white d-inline-block mb-0 mr-5"},[e._v("User Management")]),s("div",{directives:[{name:"show",rawName:"v-show",value:e.loading,expression:"loading"}],staticClass:"mab_spinner light right"})])],1)],1),s("b-container",{staticClass:"mt--6",attrs:{fluid:""}},[s("b-modal",{attrs:{"body-class":"add_user_modal",centered:"","no-close-on-esc":"","no-close-on-backdrop":""},scopedSlots:e._u([{key:"modal-header",fn:function(t){t.close;return[s("h6",{staticClass:"modal-title",attrs:{slot:"header",id:"modal-title-default"},slot:"header"},[e._v("Add New User")])]}},{key:"default",fn:function(t){t.hide;return[s("validation-observer",{ref:"add_user_form",attrs:{slim:""}},[s("b-row",[s("b-col",{attrs:{md:""}},[s("base-input",{attrs:{placeholder:"Full Name",name:"name",rules:"required",vid:"name"},model:{value:e.model.name,callback:function(t){e.$set(e.model,"name",t)},expression:"model.name"}})],1),s("b-col",{attrs:{md:""}},[s("base-input",{attrs:{placeholder:"Email Address",name:"email",rules:"required",vid:"email"},on:{blur:e.runPrechecks},model:{value:e.model.email,callback:function(t){e.$set(e.model,"email",t)},expression:"model.email"}})],1)],1),s("b-row",[s("b-col",{attrs:{md:""}},[s("base-input",{attrs:{placeholder:"Mobile",name:"mobile",vid:"mobile"},model:{value:e.model.mobile,callback:function(t){e.$set(e.model,"mobile",t)},expression:"model.mobile"}})],1),s("b-col",{attrs:{md:""}},[s("base-input",{attrs:{placeholder:"Physical Address",autocomplete:"nope",name:"address",vid:"address"},model:{value:e.model.address,callback:function(t){e.$set(e.model,"address",t)},expression:"model.address"}})],1)],1),s("b-row",[s("b-col",{attrs:{md:""}},[s("base-input",{attrs:{name:"u.o.m",rules:"required",vid:"unit_of_measure"}},[s("el-select",{attrs:{filterable:"",placeholder:"Unit of Measure"},model:{value:e.model.unit_of_measure,callback:function(t){e.$set(e.model,"unit_of_measure",t)},expression:"model.unit_of_measure"}},[s("el-option",{attrs:{label:"Metric",value:1}}),s("el-option",{attrs:{label:"Imperial",value:2}})],1)],1)],1),s("b-col",{attrs:{md:""}},[s("base-input",{attrs:{name:"timezone",rules:"required",vid:"timezone",autocomplete:"nope"}},[e.timeZones.length?s("el-select",{attrs:{filterable:"",placeholder:"Timezone",autocomplete:"nope"},model:{value:e.model.timezone,callback:function(t){e.$set(e.model,"timezone",t)},expression:"model.timezone"}},e._l(e.timeZones,(function(e){return s("el-option",{key:e._key,attrs:{label:e._lab,value:e._key}})})),1):e._e()],1)],1)],1),s("b-row",[s("b-col",{attrs:{md:""}},[s("base-input",{attrs:{name:"password",autocomplete:"new-password",rules:"required|confirmed:password_confirmation",type:"password",placeholder:"Password",vid:"password"},model:{value:e.model.password,callback:function(t){e.$set(e.model,"password",t)},expression:"model.password"}})],1),s("b-col",{attrs:{md:""}},[s("base-input",{attrs:{name:"confirmation",autocomplete:"new-password",rules:"required",type:"password",placeholder:"Confirm Password",vid:"password_confirmation"},model:{value:e.model.password_confirmation,callback:function(t){e.$set(e.model,"password_confirmation",t)},expression:"model.password_confirmation"}})],1)],1),s("b-row",[s("b-col",{attrs:{md:""}},[s("base-input",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover.top",modifiers:{hover:!0,top:!0}}],attrs:{name:"cc",rules:"required",vid:"company",autocomplete:"off",title:"The user's owning entity."}},[s("el-select",{attrs:{filterable:"",placeholder:"Entity",disabled:Object.keys(e.companies).length<2,autocomplete:"off"},on:{change:e.companyChanged},model:{value:e.model.company_id,callback:function(t){e.$set(e.model,"company_id",t)},expression:"model.company_id"}},e._l(e.companies,(function(e){return s("el-option",{key:e.id,attrs:{label:e.company_name,value:e.id}})})),1)],1)],1),s("b-col",{attrs:{md:""}},[s("base-input",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover.top",modifiers:{hover:!0,top:!0}}],attrs:{name:"role",rules:"required",vid:"role",title:"A user's role determines their level of access to various modules.",disabled:!e.model.company_id||Object.keys(e.roles).length<2}},[e.roles&&e.model.company_id?s("el-select",{attrs:{filterable:"",placeholder:"Role",disabled:!e.model.company_id},model:{value:e.model.role_id,callback:function(t){e.$set(e.model,"role_id",t)},expression:"model.role_id"}},e._l(e.roles,(function(e){return s("el-option",{key:e.id,attrs:{label:e.role_name,value:e.id}})})),1):e._e()],1)],1)],1),s("b-row",[s("b-col",{attrs:{md:""}},[s("base-input",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover.top",modifiers:{hover:!0,top:!0}}],attrs:{name:"group",vid:"group",placeholder:"Group (Optional)",title:"Optionally add this user to a security group.",disabled:!e.model.company_id||!e.groups}},[s("el-select",{attrs:{filterable:"",placeholder:"Group (Optional)",disabled:!e.model.company_id||!e.groups},model:{value:e.model.group_id,callback:function(t){e.$set(e.model,"group_id",t)},expression:"model.group_id"}},[e._v("'+model.company_id.toString()+'\"'].company_name + ' User Groups'\">\n                    "),e._l(e.groups,(function(e){return s("el-option",{key:e.id,attrs:{label:e.group_name,value:e.id}})}))],2)],1)],1)],1),e.model.company_id&&(e.isAdmin()||e.isDistributor())?s("b-row",[s("b-col",{attrs:{md:""}},[s("base-input",{attrs:{name:"is_distributor",vid:"is_distributor"}},[s("b-form-checkbox",{attrs:{size:"lg","unchecked-value":"0",value:"1"},model:{value:e.model.is_distributor,callback:function(t){e.$set(e.model,"is_distributor",t)},expression:"model.is_distributor"}},[e._v("Distributor")])],1)],1)],1):e._e(),e.model.company_id&&(e.isAdmin()||e.isDistributor())&&"1"==e.model.is_distributor?s("b-row",[s("b-col",{attrs:{md:""}},[e.dist_list&&Object.keys(e.dist_list).length?[s("base-input",{attrs:{label:"Managed Entities",name:"managed_companies",vid:"managed_companies"}},[s("el-select",{attrs:{disabled:!e.model.is_distributor,"value-key":"id",multiple:"",filterable:"",placeholder:"Choose"},model:{value:e.model.managed_company_ids,callback:function(t){e.$set(e.model,"managed_company_ids",t)},expression:"model.managed_company_ids"}},e._l(e.dist_list,(function(e){return s("el-option",{key:e.id,attrs:{label:e.company_name,value:e.id}})})),1)],1)]:[s("b-alert",{attrs:{variant:"primary",show:""}},[s("strong",[e._v(e._s(e.companies['"'+e.model.company_id.toString()+'"'].company_name))]),e._v(" currently has no manageable subsidiary entities available to pre-assign to this distributor user.")])]],2)],1):e._e()],1)]}},{key:"modal-footer",fn:function(t){t.ok,t.cancel,t.hide;return[s("base-button",{staticClass:"ml-auto",attrs:{type:"outline-primary"},on:{click:function(t){return e.closeAddUserModal()}}},[e._v("Cancel")]),s("base-button",{attrs:{type:"primary"},on:{click:function(t){return e.addUser()}}},[e._v("Add")])]}}]),model:{value:e.showNewUserModal,callback:function(t){e.showNewUserModal=t},expression:"showNewUserModal"}}),s("card",{staticClass:"no-border-card",attrs:{"body-classes":"px-0 pb-1","footer-classes":"pb-2"}},[s("template",{slot:"header"},[s("base-button",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover.top",modifiers:{hover:!0,top:!0}}],staticClass:"btn",attrs:{disabled:!e.userCan("Add","Users")||e.loading,size:"sm",type:"primary",title:"Add a new user account to an existing entity and role.",icon:""},nativeOn:{click:function(t){return e.showAddUserModal()}}},[e._v("\n          Add User\n        ")])],1),s("b-row",{staticClass:"nomargin"},[s("b-col",{attrs:{md:""}},[s("b-form-select",{on:{change:e.loadUsers},model:{value:e.perPage,callback:function(t){e.perPage=t},expression:"perPage"}},[s("b-form-select-option",{attrs:{value:5}},[e._v("5")]),s("b-form-select-option",{attrs:{value:10}},[e._v("10")]),s("b-form-select-option",{attrs:{value:25,selected:""}},[e._v("25")]),s("b-form-select-option",{attrs:{value:50}},[e._v("50")])],1)],1),s("b-col",{attrs:{md:""}},[e.entities&&e.entities.length&&e.entities.length>1?s("el-select",{staticClass:"fullwidth",attrs:{clearable:"",filterable:"",placeholder:"Filter by Entity.."},on:{change:e.loadUsers},model:{value:e.filterEntity,callback:function(t){e.filterEntity=t},expression:"filterEntity"}},e._l(e.entities,(function(e){return s("el-option",{key:e.id,attrs:{value:e.id,label:e.company_name}})})),1):e._e()],1),s("b-col",{attrs:{md:""}},[s("base-input",{attrs:{"prepend-icon":"fas fa-search"}},[s("b-input",{attrs:{debounce:1e3,placeholder:"Search..."},on:{update:e.loadUsers},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}})],1)],1)],1),s("b-row",{staticClass:"nomargin"},[s("b-col",{attrs:{md:""}},[s("b-table",{attrs:{striped:"",bordered:"",outlined:"",small:"",stacked:"lg",responsive:"","show-empty":"","primary-key":"node_address","no-local-sorting":"",fields:e.tableColumns,items:e.tableData,busy:e.bInitialQuery},on:{"sort-changed":e.sortingChanged,"update:busy":function(t){e.bInitialQuery=t}},scopedSlots:e._u([{key:"cell(unit_of_measure)",fn:function(t){return[e._v("\n              "+e._s(1==t.item.unit_of_measure?"Metric":"Imperial")+"\n            ")]}},{key:"cell()",fn:function(t){return[e._v("\n              "+e._s(t.value)+"\n            ")]}},e.userCan("Lock","Users")?{key:"cell(is_active)",fn:function(e){return[s("b-icon",{attrs:{variant:"success","data.value":"",icon:e.value?"check-circle":"circle","aria-hidden":"true"}})]}}:null,e.isAdmin()?{key:"cell(is_admin)",fn:function(e){return[s("b-icon",{attrs:{variant:"success","data.value":"",icon:e.value?"check-circle":"circle","aria-hidden":"true"}})]}}:null,e.isAdmin()||e.isDistributor()?{key:"cell(is_distributor)",fn:function(e){return[s("b-icon",{attrs:{variant:"success","data.value":"",icon:e.value?"check-circle":"circle","aria-hidden":"true"}})]}}:null,e.canAction?{key:"cell(actions)",fn:function(t){return[s("div",{staticClass:"d-flex justify-content-center"},[s("b-button",{staticClass:"btn",attrs:{disabled:!e.userCan("View","Users",t.item.id,"O"),size:"sm",variant:"outline-primary",icon:""},on:{click:function(s){return e.handleShow(t.index,t.item)}}},[e._v("\n                Show\n                ")]),s("b-button",{staticClass:"btn",attrs:{disabled:!e.userCan("Edit","Users",t.item.id,"O"),size:"sm",variant:"outline-primary",icon:""},on:{click:function(s){return e.handleEdit(t.index,t.item)}}},[e._v("\n                Configure\n                ")]),s("b-button",{staticClass:"btn",attrs:{disabled:!e.userCan("Delete","Users",t.item.id,"O")||(!e.$store.state.user_obj||e.$store.state.user_obj.id==t.item.id),size:"sm",variant:"outline-primary",icon:""},on:{click:function(s){return e.handleDelete(t.index,t.item)}}},[e._v("\n                Remove\n                ")])],1)]}}:null,{key:"table-busy",fn:function(){return[s("div",{staticClass:"text-center"},[s("div",{staticClass:"mab_spinner"})])]},proxy:!0},{key:"emptyfiltered",fn:function(){return[s("div",{staticClass:"text-center"},[e._v("\n                No matches found\n              ")])]},proxy:!0},{key:"empty",fn:function(){return[s("div",{staticClass:"text-center"},[e._v("\n                No entries found\n              ")])]},proxy:!0}],null,!0)})],1)],1),s("div",{staticClass:"align-right",attrs:{slot:"footer"},slot:"footer"},[s("b-row",[s("b-col",{attrs:{md:""}},[e._v("\n            Showing "+e._s(Math.min(1+e.perPage*(e.currentPage-1),e.totalRows))+" to "+e._s(Math.min(e.perPage*(e.currentPage-1)+e.perPage,e.totalRows))+" of "+e._s(e.totalRows)+" entries\n          ")]),s("b-col",{attrs:{md:""}},[s("b-pagination",{attrs:{"total-rows":e.totalRows,"per-page":e.perPage,align:"right"},on:{input:e.loadUsers},model:{value:e.currentPage,callback:function(t){e.currentPage=t},expression:"currentPage"}})],1)],1)],1)],2)],1)],1)},o=[],n=(s("ac6a"),s("456d"),s("20d6"),s("6b54"),s("bd86")),r=(s("6611"),s("450d"),s("e772")),l=s.n(r),d=(s("7f7f"),s("1f1a"),s("4e4b")),c=s.n(d),u=s("3d20"),m=s.n(u),p=s("8fe0"),b={mixins:[p["a"]],components:(a={},Object(n["a"])(a,c.a.name,c.a),Object(n["a"])(a,l.a.name,l.a),a),data:function(){return{loading:!1,bInitialQuery:!0,tableColumns:[{key:"name",label:"Name",sortable:!0,tdClass:"valign"},{key:"email",label:"Email",sortable:!0,tdClass:"valign"},{key:"role_name",label:"Role",sortable:!0,tdClass:"valign"},{key:"unit_of_measure",label:"Unit of Measure",sortable:!0,tdClass:"valign"},{key:"timezone",label:"Timezone",sortable:!0,tdClass:"valign"},{key:"is_active",label:"Active",sortable:!0,thClass:"valign halign",tdClass:"valign halign"}],tableData:[],totalRows:1,currentPage:1,perPage:25,filterText:"",filterEntity:"",entities:[],sortBy:"name",sortDir:"asc",showNewUserModal:!1,timeZones:[],roles:[],companies:[],dist_list:[],subsystems:[],groups:[],model:{name:"",email:"",mobile:"",address:"",unit_of_measure:"",timezone:"",role:"",password:"",password_confirmation:"",is_distributor:0,role_id:null,company_id:this.$store.state.user_obj.company_id,group_id:null,managed_company_ids:[]},canAction:!1}},methods:{loadUsers:function(){var e=this;this.loading=!0,this.$axios.post(this.$store.state.baseUrl+"/api/users",{cur_page:this.currentPage,per_page:this.perPage,initial:this.bInitialQuery,filter:this.filterText,entity:this.filterEntity,sort_by:this.sortBy,sort_dir:this.sortDir?"desc":"asc"}).then((function(t){e.bInitialQuery&&e.companyChanged(),e.loading=!1,e.bInitialQuery=!1,(e.isAdmin()||e.userLimits("View","Users","C").length>1)&&e.tableColumns.unshift({key:"company_name",label:"Entity",sortable:!0,tdClass:"valign"}),e.isAdmin()&&e.tableColumns.push({key:"is_admin",label:"Admin",sortable:!0,thClass:"valign halign",tdClass:"valign halign"}),(e.isAdmin()||e.isDistributor())&&e.tableColumns.push({key:"is_distributor",label:"Distributor",sortable:!0,thClass:"valign halign",tdClass:"valign halign"}),(e.isAdmin()||e.userCan("Edit","Users")||e.userCan("Delete","Users"))&&(e.canAction=!0,e.tableColumns.push({key:"actions",label:"Actions",thClass:"halign"})),e.tableData=t.data.users,e.totalRows=t.data.total,e.entities=t.data.entities,0==e.totalRows&&(e.currentPage=1)}))},loadCompanies:function(){var e=this;this.$axios.post(this.$store.state.baseUrl+"/api/companies_list",{context:[{verb:"Add",module:"Users"}]}).then((function(t){e.companies=t.data.companies}))},loadDistributors:function(){var e=this;this.$axios.post(this.$store.state.baseUrl+"/api/companies_dist_list",{company_id:this.model.company_id}).then((function(t){t.data&&(e.dist_list=t.data.companies)}))},loadRoles:function(){var e=this;this.$axios.post(this.$store.state.baseUrl+"/api/roles_by_cc",{company_id:this.model.company_id?this.model.company_id:this.$store.state.user_obj.company_id}).then((function(t){e.roles=t.data.roles}))},loadGroups:function(){var e=this;this.$axios.post(this.$store.state.baseUrl+"/api/groups_list",{company_id:this.model.company_id?this.model.company_id:this.$store.state.user_obj.company_id,context:[{verb:"Add",module:"Users"}]}).then((function(t){e.groups=t.data.groups,e.subsystems=t.data.subsystems}))},companyChanged:function(){this.model.role_id=null,this.model.group_id=null,this.loadRoles(),this.loadGroups(),(this.isAdmin()||this.isDistributor())&&this.loadDistributors()},loadTimezones:function(){var e=this;this.$axios.get(this.$store.state.baseUrl+"/api/getTimezones").then((function(t){if(t.data){var s=JSON.parse(JSON.stringify(t.data.timezones)),a=JSON.parse(JSON.stringify(t.data.offsets));if(s&&s.length)for(var i=0;i<s.length;i++)e.timeZones.push({_key:i.toString(),_lab:s[i]+" ("+a[s[i]]+")"})}}))},handleShow:function(e,t){this.$router.push("/users_manage/show/"+t.email)},handleEdit:function(e,t){this.$router.push("/users_manage/edit/"+t.email)},handleDelete:function(e,t){var s=this;m.a.fire({title:"Are you sure?",text:"Please confirm user removal",type:"warning",showCancelButton:!0,confirmButtonText:"Remove",buttonsStyling:!1,customClass:{cancelButton:"btn btn-outline-primary",confirmButton:"btn btn-primary"}}).then((function(e){e.value&&s.deleteUser(t)}))},deleteUser:function(e){var t=this;this.loading=!0,this.$axios.post(this.$store.state.baseUrl+"/api/userdestroy",{id:e.id}).then((function(s){if(t.loading=!1,"user_removed"==s.data.message){var a=t.tableData.findIndex((function(t){return t.id===e.id}));a>=0&&t.tableData.splice(a,1),t.$notify({title:"Status",message:"User Deleted",type:"success",verticalAlign:"top",horizontalAlign:"right"})}}))},addUser:function(){var e=this;this.$refs.add_user_form.validate().then((function(t){t&&(e.loading=!0,e.$axios.post(e.$store.state.baseUrl+"/api/usernew",e.model).then((function(t){e.loading=!1,"user_added"==t.data.message&&(e.loadUsers(),e.closeAddUserModal(),e.$notify({title:"Success",message:"New user added",type:"success",verticalAlign:"top",horizontalAlign:"right"}))})).catch((function(t){e.loading=!1,t.response.data.errors&&e.$refs.add_user_form.setErrors(t.response.data.errors)})))}))},runPrechecks:function(e){var t=this;if(this.model.email&&""!=this.model.email){var s=e.target.value;this.$axios.get(this.$store.state.baseUrl+"/api/userexists/"+s).then((function(e){e.data&&e.data.user_exists&&(t.model.email="",t.$notify({title:"Error",message:"User ("+s+") already exists",type:"danger",verticalAlign:"top",horizontalAlign:"right"}))}))}},showAddUserModal:function(){(this.isAdmin()||this.isDistributor())&&this.loadDistributors(),this.showNewUserModal=!0},closeAddUserModal:function(){this.clearModel(),this.showNewUserModal=!1},clearModel:function(){for(var e=Object.keys(this.model),t=0;t<e.length;t++)this.model[e[t]]="";this.model.company_id=this.$store.state.user_obj.company_id},sortingChanged:function(e){this.sortBy=e.sortBy,this.sortDir=e.sortDesc,this.loadUsers()}},watch:{filterText:function(e,t){this.currentPage=e!=t?1:this.currentPage}},mounted:function(){this.loadTimezones(),this.loadUsers(),this.loadCompanies()}},h=b,f=(s("472a"),s("2877")),_=Object(f["a"])(h,i,o,!1,null,null,null);t["default"]=_.exports},"472a":function(e,t,s){"use strict";s("851a")},"851a":function(e,t,s){},"8fe0":function(e,t,s){"use strict";s("a481");t["a"]={methods:{calcLastReadingColor:function(e){var t="black";return"undefined"!==typeof e.date_diff&&"N/A"!=e.date_diff&&(e.date_diff.h<3&&(t="green"),e.date_diff.h>=3&&e.date_diff.h<6&&(t="orange"),e.date_diff.h>=6&&(t="red"),(e.date_diff.d>0||e.date_diff.days>0)&&(t="red"),(e.date_diff.y>0||e.date_diff.m>0||e.date_diff.d>0||e.date_diff.days>0)&&(t="red")),t},isAdmin:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this.$store.getters.isAdmin(e)},isDistributor:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this.$store.getters.isDistributor(e)},isRestricted:function(){return this.$store.getters.isRestricted()},userCan:function(e,t){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return this.$store.getters.userCan(e,t,s,a)},userLimits:function(e,t){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return this.$store.getters.userLimits(e,t,s)},convertNodeTypeToGraphRouteName:function(e){return"Soil Moisture"==e?"soil_moisture_graph":"Nutrients"==e?"nutrients_graph":"Wells"==e?"well_controls_graph":"Water Meter"==e?"meters_graph":""},convertNodeTypeToSubsystem:function(e){return"Soil Moisture"==e?"Soil Moisture":"Nutrients"==e?"Nutrients":"Wells"==e?"Well Controls":"Water Meter"==e?"Meters":""},convertToInches:function(e){return e=e.replace("mm",""),e=parseInt(parseInt(e)/25)+'"',e},convertToIndex:function(e){return e=e.replace("mm",""),e=parseInt(parseInt(e)/100),e},truncateString:function(e){return e.length<=24?e:e.substring(0,21)+"..."}}}}}]);
//# sourceMappingURL=chunk-7234f0d2.38fc22ff.js.map