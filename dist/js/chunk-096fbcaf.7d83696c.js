(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-096fbcaf"],{"8fe0":function(e,t,o){"use strict";o("a481");t["a"]={methods:{calcLastReadingColor:function(e){var t="black";return"undefined"!==typeof e.date_diff&&"N/A"!=e.date_diff&&(e.date_diff.h<3&&(t="green"),e.date_diff.h>=3&&e.date_diff.h<6&&(t="orange"),e.date_diff.h>=6&&(t="red"),(e.date_diff.d>0||e.date_diff.days>0)&&(t="red"),(e.date_diff.y>0||e.date_diff.m>0||e.date_diff.d>0||e.date_diff.days>0)&&(t="red")),t},isAdmin:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this.$store.getters.isAdmin(e)},isDistributor:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this.$store.getters.isDistributor(e)},isRestricted:function(){return this.$store.getters.isRestricted()},userCan:function(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return this.$store.getters.userCan(e,t,o,a)},userLimits:function(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return this.$store.getters.userLimits(e,t,o)},convertNodeTypeToGraphRouteName:function(e){return"Soil Moisture"==e?"soil_moisture_graph":"Nutrients"==e?"nutrients_graph":"Wells"==e?"well_controls_graph":"Water Meter"==e?"meters_graph":""},convertNodeTypeToSubsystem:function(e){return"Soil Moisture"==e?"Soil Moisture":"Nutrients"==e?"Nutrients":"Wells"==e?"Well Controls":"Water Meter"==e?"Meters":""},convertToInches:function(e){return e=e.replace("mm",""),e=parseInt(parseInt(e)/25)+'"',e},convertToIndex:function(e){return e=e.replace("mm",""),e=parseInt(parseInt(e)/100),e},truncateString:function(e){return e.length<=24?e:e.substring(0,21)+"..."}}}},e09a:function(e,t,o){"use strict";o.r(t);var a,i=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"content"},[o("base-header",{staticClass:"pb-6",attrs:{type:"users"}},[o("b-row",{staticClass:"py-4",attrs:{"align-v":"center"}},[o("b-col",[o("h6",{directives:[{name:"show",rawName:"v-show",value:e.model.name,expression:"model.name"}],staticClass:"h2 text-white d-inline-block mb-0 mr-5"},[e._v("\n          "+e._s((e.$store.state.user_obj.email==e.model.email?"Profile":"User")+" - "+e.model.name)+"\n        ")]),o("div",{directives:[{name:"show",rawName:"v-show",value:e.loading,expression:"loading"}],staticClass:"mab_spinner light right"})])],1)],1),o("div",{staticClass:"container-fluid mt--6"},[o("div",{staticClass:"row"},[o("div",{staticClass:"col-md-12"},[o("b-modal",{attrs:{centered:"","no-close-on-esc":"","no-close-on-backdrop":""},scopedSlots:e._u([{key:"modal-header",fn:function(t){t.close;return[o("h6",{staticClass:"modal-title",attrs:{slot:"header",id:"modal-title-default"},slot:"header"},[e._v("Change Password")])]}},{key:"default",fn:function(t){t.hide;return[o("validation-observer",{ref:"pwform",attrs:{slim:""}},[o("base-input",{staticClass:"mb-3",attrs:{name:"password",rules:"required|min:8|confirmed:confirmation",alternative:"",type:"password",placeholder:"Password",vid:"password","addon-left-icon":"ni ni-lock-circle-open"},model:{value:e.pw1,callback:function(t){e.pw1=t},expression:"pw1"}}),o("base-input",{attrs:{name:"confirmation",rules:"required|min:8",alternative:"",type:"password",placeholder:"Confirm Password",vid:"confirmation","addon-left-icon":"ni ni-lock-circle-open"},model:{value:e.pw2,callback:function(t){e.pw2=t},expression:"pw2"}})],1)]}},{key:"modal-footer",fn:function(t){t.ok,t.cancel,t.hide;return[o("base-button",{staticClass:"ml-auto",attrs:{type:"link"},on:{click:e.closePWChangeModal}},[e._v("Close")]),o("base-button",{attrs:{type:"primary"},on:{click:e.updatePW}},[e._v("Update")])]}}]),model:{value:e.showPWModal,callback:function(t){e.showPWModal=t},expression:"showPWModal"}}),o("b-modal",{attrs:{centered:"","no-close-on-esc":"","no-close-on-backdrop":""},scopedSlots:e._u([{key:"modal-header",fn:function(t){t.close;return[o("h6",{staticClass:"modal-title",attrs:{slot:"header",id:"modal-title-default"},slot:"header"},[e._v("Change User Entity")])]}},{key:"default",fn:function(t){t.hide;return[o("validation-observer",{ref:"entity_change_form",attrs:{slim:""}},[o("form",{attrs:{role:"form"},on:{submit:function(e){return e.preventDefault(),function(){return!1}.apply(null,arguments)}}},[o("b-row",[o("b-col",[o("b-toast",{attrs:{visible:!0,variant:"warning",title:"Important",static:"","no-auto-hide":""}},[e._v("\n                      Changing a user's entity will cause:\n                      "),o("ul",[o("li",[e._v("Removal of the user from any security groups")]),o("li",[e._v("Removal of the user from any integrations")])])])],1)],1),o("b-row",[o("b-col",[o("div",[o("base-input",{attrs:{label:"Entity",name:"company",rules:"required",vid:"company",placeholder:"Entity",autocomplete:"off"}},[o("el-select",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover.top",modifiers:{hover:!0,top:!0}}],attrs:{disabled:Object.values(e.companies).length<2,filterable:"",placeholder:"Entity",title:"Change the user's owning entity. Note: After changing the entity, you have to also choose a new role before the changes would take effect.",autocomplete:"off"},on:{change:e.companyChanged},model:{value:e.model.company_id,callback:function(t){e.$set(e.model,"company_id",t)},expression:"model.company_id"}},[Object.values(e.companies).length?[e._l(e.companies,(function(t){return[o("el-option",{key:t.id,attrs:{label:t.company_name,value:t.id}},[o("span",[e._v(e._s(t.company_name))])])]}))]:e._e()],2)],1)],1)])],1),o("b-row",[o("b-col",[o("div",[o("base-input",{attrs:{name:"role",rules:"required",label:"Role",vid:"role"}},[o("el-select",{attrs:{disabled:!e.model.company_id||Object.keys(e.roles).length<2,filterable:"",placeholder:"Role"},model:{value:e.model.role_id,callback:function(t){e.$set(e.model,"role_id",t)},expression:"model.role_id"}},e._l(e.roles,(function(e){return o("el-option",{key:e.id,attrs:{label:e.role_name,value:e.id}})})),1)],1)],1)])],1)],1)])]}},{key:"modal-footer",fn:function(t){t.ok,t.cancel,t.hide;return[o("b-button",{staticClass:"ml-auto",attrs:{variant:"outline-primary"},on:{click:e.closeUserEntityChangeModal}},[e._v("Cancel")]),o("b-button",{attrs:{variant:"primary"},on:{click:e.changeUserEntity}},[e._v("Change User Entity")])]}}]),model:{value:e.showUserEntityChangeModal,callback:function(t){e.showUserEntityChangeModal=t},expression:"showUserEntityChangeModal"}}),o("b-card",{scopedSlots:e._u([{key:"header",fn:function(){return[o("base-button",{staticClass:"btn",attrs:{disabled:!e.userCan("Reset Password","Users")&&e.model.email!=e.$store.state.user_obj.email,size:"sm",type:"primary",icon:""},nativeOn:{click:function(t){return e.showPWChangeModal()}}},[e._v("\n              Change Password\n            ")]),e.isAdmin()?o("base-button",{staticClass:"btn",attrs:{disabled:e.model.is_admin,size:"sm",type:"primary",icon:""},nativeOn:{click:function(t){return e.confirmPromotion()}}},[e._v("\n              Promote\n            ")]):e._e(),o("base-button",{staticClass:"btn",attrs:{disabled:!e.userCan("Lock","Users")||e.model.email==e.$store.state.user_obj.email||e.model.is_admin,size:"sm",type:"primary",icon:""},nativeOn:{click:function(t){return e.confirmUserLock()}}},[e._v("\n              "+e._s(e.model.is_active?"Lock":"Unlock")+"\n            ")])]},proxy:!0}])},[o("validation-observer",{ref:"form",attrs:{slim:""}},[o("b-row",[o("b-col",{attrs:{md:""}},[o("base-input",{attrs:{name:"name",rules:"required",label:"Full Name",placeholder:"Full Name",vid:"name"},on:{change:e.syncFields},model:{value:e.model.name,callback:function(t){e.$set(e.model,"name",t)},expression:"model.name"}})],1),o("b-col",{attrs:{md:""}},[o("base-input",{attrs:{name:"email",rules:"required|email",label:"Email Address",placeholder:"Email Address",vid:"email"},on:{change:e.syncFields},model:{value:e.model.email,callback:function(t){e.$set(e.model,"email",t)},expression:"model.email"}})],1)],1),o("b-row",[o("b-col",{attrs:{md:""}},[o("base-input",{attrs:{label:"Mobile",placeholder:"Mobile",vid:"mobile"},on:{change:e.syncFields},model:{value:e.model.mobile,callback:function(t){e.$set(e.model,"mobile",t)},expression:"model.mobile"}})],1),o("b-col",{attrs:{md:""}},[o("base-input",{attrs:{label:"Physical Address",placeholder:"Physical Address",vid:"address"},on:{change:e.syncFields},model:{value:e.model.address,callback:function(t){e.$set(e.model,"address",t)},expression:"model.address"}})],1)],1),o("b-row",[o("b-col",{attrs:{md:""}},[o("base-input",{attrs:{name:"u.o.m",rules:"required",label:"Unit of Measure",vid:"unit_of_measure"}},[o("el-select",{attrs:{filterable:"",placeholder:"Unit of Measure"},on:{change:e.syncFields},model:{value:e.model.unit_of_measure,callback:function(t){e.$set(e.model,"unit_of_measure",t)},expression:"model.unit_of_measure"}},[o("el-option",{attrs:{label:"Imperial",value:2}}),o("el-option",{attrs:{label:"Metric",value:1}})],1)],1)],1),o("b-col",{attrs:{md:""}},[o("base-input",{attrs:{label:"Time Zone",name:"timezone",rules:"required",vid:"timezone"}},[e.timeZones.length?o("el-select",{attrs:{filterable:"",placeholder:"Time Zone"},on:{change:e.syncFields},model:{value:e.model.timezone,callback:function(t){e.$set(e.model,"timezone",t)},expression:"model.timezone"}},e._l(e.timeZones,(function(e){return o("el-option",{key:e._key,attrs:{label:e._lab,value:e._key}})})),1):e._e()],1)],1)],1),o("b-row",[o("b-col",{attrs:{md:""}},[o("base-input",{attrs:{name:"role",rules:"required",label:"Role",vid:"role"}},[o("el-select",{attrs:{disabled:!e.model.company_id||Object.keys(e.roles).length<2,filterable:"",placeholder:"Role"},on:{change:e.syncFields},model:{value:e.model.role_id,callback:function(t){e.$set(e.model,"role_id",t)},expression:"model.role_id"}},e._l(e.roles,(function(e){return o("el-option",{key:e.id,attrs:{label:e.role_name,value:e.id}})})),1)],1)],1),o("b-col",{attrs:{md:""}},[o("base-input",{attrs:{label:"Entity"}},[o("b-input-group",[o("b-form-input",{attrs:{type:"text",placeholder:"Entity",readonly:""},model:{value:e.user_company_name,callback:function(t){e.user_company_name=t},expression:"user_company_name"}}),o("b-input-group-append",[o("b-button",{attrs:{disabled:!e.isAdmin(),variant:"outline-primary"},on:{click:e.openUserEntityChangeModal}},[e._v("Change Entity")])],1)],1)],1)],1)],1),e.model.company_id&&(e.isAdmin()||e.isDistributor())?o("b-row",[o("b-col",{attrs:{md:""}},[o("base-input",{attrs:{name:"is_distributor",vid:"is_distributor"}},[o("b-form-checkbox",{attrs:{size:"lg",disabled:!e.isAdmin()&&(e.$store.state.user_obj.company_id==e.model.company_id||e.$store.state.user_obj.id==e.model.id),"unchecked-value":"0",value:"1"},on:{change:e.syncFields},model:{value:e.model.is_distributor,callback:function(t){e.$set(e.model,"is_distributor",t)},expression:"model.is_distributor"}},[e._v("\n                    Distributor\n                  ")])],1)],1)],1):e._e()],1)],1),e.model.company_id&&(e.isAdmin()||e.isDistributor())&&"1"==e.model.is_distributor?o("b-card",{scopedSlots:e._u([{key:"header",fn:function(){return[o("h3",{staticClass:"mb-0"},[e._v("Distributor Details")])]},proxy:!0}],null,!1,2875147959)},[o("b-row",[o("b-col",{attrs:{md:""}},[e.dist_list&&Object.keys(e.dist_list).length?[o("base-input",{attrs:{label:"Managed Entities",name:"managed_companies",vid:"managed_companies"}},[o("el-select",{attrs:{disabled:!e.isAdmin()&&(e.$store.state.user_obj.company_id==e.model.company_id||e.$store.state.user_obj.id==e.model.id),"value-key":"id",multiple:"",filterable:"",placeholder:"Choose"},on:{change:e.syncFields},model:{value:e.model.managed_company_ids,callback:function(t){e.$set(e.model,"managed_company_ids",t)},expression:"model.managed_company_ids"}},[e.dist_list&&Object.keys(e.dist_list).length?e._l(e.dist_list,(function(e){return o("el-option",{key:e.id,attrs:{label:e.company_name,value:e.id}})})):e._e()],2)],1)]:[Object.keys(e.companies).length?o("b-alert",{attrs:{variant:"primary",show:""}},[o("strong",[e._v(e._s(e.companies['"'+e.model.company_id.toString()+'"'].company_name))]),e._v(" currently has no manageable subsidiary entities available to pre-assign to this distributor user.")]):e._e()]],2)],1)],1):e._e()],1)])])],1)},s=[],n=(o("6b54"),o("bd86")),l=(o("6611"),o("450d"),o("e772")),r=o.n(l),d=(o("7f7f"),o("1f1a"),o("4e4b")),c=o.n(d),m=o("714b"),u=o("8fe0"),p=o("3d20"),h=o.n(p),f={mixins:[u["a"]],components:(a={},Object(n["a"])(a,c.a.name,c.a),Object(n["a"])(a,r.a.name,r.a),Object(n["a"])(a,"Modal",m["a"]),a),data:function(){return{loading:!1,timeZones:[],roles:[],bInitialQuery:!0,companies:[],dist_list:[],showPWModal:!1,pw1:"",pw2:"",model:{id:null,name:"",email:"",mobile:"",address:"",unit_of_measure:"",timezone:"",role:"",is_admin:0,is_distributor:0,is_active:0,role_id:null,company_id:null,password:null,parent_id:null,managed_company_ids:[]},user_company_name:"",showUserEntityChangeModal:!1,prev_company_id:null,prev_role_id:null}},methods:{loadUser:function(){var e=this;this.loading=!0,this.$axios.get(this.$store.state.baseUrl+"/api/user/"+this.$route.params.email).then((function(t){e.loading=!1,"user_loaded"==t.data.message?(e.model=t.data.user,e.bInitialQuery=!1):"nonexistent"==t.data.message?e.$notify({title:"Error",message:"User not found (might have been removed)",type:"danger",verticalAlign:"top",horizontalAlign:"right"}):"missing_email"==t.data.message&&e.$notify({title:"Error",message:"Parameter Error: email",type:"danger",verticalAlign:"top",horizontalAlign:"right"}),e.loadCompanies(),e.loadDistributors()}))},loadCompanies:function(){var e=this;this.$axios.post(this.$store.state.baseUrl+"/api/companies_list",{context:[{verb:"Edit",module:"Users"}]}).then((function(t){e.companies=t.data.companies,e.user_company_name=e.companies['"'+e.model.company_id.toString()+'"'].company_name,e.loadRoles()}))},loadDistributors:function(){var e=this;this.$axios.post(this.$store.state.baseUrl+"/api/companies_dist_list",{company_id:this.model.company_id}).then((function(t){t.data&&(e.dist_list=t.data.companies)}))},loadRoles:function(){var e=this;this.loading=!0,this.$axios.post(this.$store.state.baseUrl+"/api/roles_by_cc",{company_id:this.model.company_id}).then((function(t){e.loading=!1,e.roles=t.data.roles}))},showPWChangeModal:function(){this.pw1="",this.pw2="",this.model.password=null,this.showPWModal=!0},closePWChangeModal:function(){this.pw1="",this.pw2="",this.model.password=null,this.showPWModal=!1},updatePW:function(){var e=this;this.$refs.pwform.validate().then((function(t){t?(e.loading=!0,e.model.password=e.pw1,e.model.password_confirmation=e.pw2,e.$axios.post(e.$store.state.baseUrl+"/api/updatePW",e.model).then((function(t){e.loading=!1,e.model.password=null,"pw_updated"==t.data.message&&(e.closePWChangeModal(),e.$notify({title:"Success",message:"Password changed",type:"success",verticalAlign:"top",horizontalAlign:"right"}))})).catch((function(t){e.loading=!1,t.response.data.errors&&e.$refs.pwform.setErrors(t.response.data.errors)}))):e.$notify({title:"Required",message:"Please fill in all fields",type:"warn",verticalAlign:"top",horizontalAlign:"right",duration:1e3,clean:!0})}))},promoteUser:function(){var e=this;this.$axios.post(this.$store.state.baseUrl+"/api/promote",{id:this.model.id}).then((function(t){"user_promoted"==t.data.message&&e.$notify({title:"Success",message:"User was promoted",type:"success",verticalAlign:"top",horizontalAlign:"right"})}))},syncFields:function(){var e=this;return this.$refs.form.validate().then((function(t){if(t)return e.loading=!0,e.model.password=null,e.$axios.post(e.$store.state.baseUrl+"/api/updatePW",e.model).then((function(t){if(e.loading=!1,e.model.password=null,"user_updated"==t.data.message)return t.data.user&&e.$store.dispatch("update_uom",t.data.user.unit_of_measure),e.$notify({title:"Saved",message:"Changes were saved",type:"success",verticalAlign:"top",horizontalAlign:"right"}),t})).catch((function(t){return e.loading=!1,t.response.data.errors&&e.$refs.form.setErrors(t.response.data.errors),t}));e.$notify({title:"Required",message:"Please fill in all fields",type:"danger",verticalAlign:"top",horizontalAlign:"right",duration:1e3,clean:!0})}))},changeUserEntity:function(){var e=this;this.$refs.entity_change_form.validate().then((function(t){if(!t)return e.$notify({title:"Required",message:"Please fill in all fields",type:"danger",verticalAlign:"top",horizontalAlign:"right",duration:1e3,clean:!0}),!1;e.syncFields().then((function(){e.$notify({title:"Success",message:"User entity changed.",type:"success",verticalAlign:"top",horizontalAlign:"right"}),e.showUserEntityChangeModal=!1})).catch((function(t){e.$notify({title:"Failure",message:"User entity change failed.",type:"warning",verticalAlign:"top",horizontalAlign:"right"}),e.showUserEntityChangeModal=!1}))}))},confirmPromotion:function(){var e=this;h.a.fire({title:"Promote User",text:"Please confirm user promotion",type:"warning",showCancelButton:!0,confirmButtonText:"Promote",buttonsStyling:!1,customClass:{cancelButton:"btn btn-outline-primary",confirmButton:"btn btn-primary"}}).then((function(t){t.value&&e.promoteUser()}))},confirmUserLock:function(){var e=this;h.a.fire({title:this.model.is_active?"Lock User":"Unlock User",text:"Please confirm "+(this.model.is_active?"locking":"unlocking")+" user account",type:"warning",showCancelButton:!0,confirmButtonText:this.model.is_active?"Lock":"Unlock",buttonsStyling:!1,customClass:{cancelButton:"btn btn-outline-primary",confirmButton:"btn btn-primary"}}).then((function(t){t.value&&e.toggleUserLock()}))},toggleUserLock:function(){var e=this,t=this.model.is_active?"lock":"unlock";this.$axios.post(this.$store.state.baseUrl+"/api/user_"+t,{id:this.model.id}).then((function(t){t.data&&("user_locked"==t.data.message?(e.model.is_active=0,e.$notify({title:"Success",message:"User account was locked",type:"success",verticalAlign:"top",horizontalAlign:"right"})):"user_unlocked"==t.data.message&&(e.model.is_active=1,e.$notify({title:"Success",message:"User account was unlocked",type:"success",verticalAlign:"top",horizontalAlign:"right"})))}))},loadTimezones:function(){var e=this;this.$axios.get(this.$store.state.baseUrl+"/api/getTimezones").then((function(t){if(t.data){var o=JSON.parse(JSON.stringify(t.data.timezones)),a=JSON.parse(JSON.stringify(t.data.offsets));if(o&&o.length)for(var i=0;i<o.length;i++)e.timeZones.push({_key:i.toString(),_lab:o[i]+" ("+a[o[i]]+")"})}}))},companyChanged:function(){this.model.role_id=null,this.loadRoles()},openUserEntityChangeModal:function(){this.showUserEntityChangeModal=!0,this.prev_company_id=this.model.company_id,this.prev_role_id=this.model.role_id},closeUserEntityChangeModal:function(){this.showUserEntityChangeModal=!1,this.model.company_id=this.prev_company_id,this.model.role_id=this.prev_role_id,this.loadRoles()},restrictedNotice:function(){h.a.fire({title:"Access was restricted",text:"You were redirected to your profile screen due to your account lacking the necessary permissions. Please notify your administrator.",showCancelButton:!1,confirmButtonText:"OK",buttonsStyling:!1,customClass:{cancelButton:"btn btn-outline-primary",confirmButton:"btn btn-primary"}})},loadAll:function(){this.loadTimezones(),this.loadUser(),mabRedirect&&mabRedirect.length&&(console.log(mabRedirect),this.restrictedNotice(),mabRedirect="")}},mounted:function(){this.loadAll()},watch:{$route:"loadAll"}},b=f,_=o("2877"),g=Object(_["a"])(b,i,s,!1,null,null,null);t["default"]=g.exports}}]);
//# sourceMappingURL=chunk-096fbcaf.7d83696c.js.map