(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-8f0ac8fc"],{"313f":function(e,t,o){"use strict";o("8a9b")},8002:function(e,t,o){"use strict";o.r(t);var n,r=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"content"},[o("base-header",{staticClass:"pb-6",attrs:{type:"nodeconfig"}},[o("b-row",{staticClass:"py-4",attrs:{"align-v":"center"}},[o("b-col",[o("h6",{staticClass:"h2 text-white d-inline-block mb-0 mr-5"},[e._v("Node Configuration - "+e._s(e.$route.params.node_address))]),o("div",{directives:[{name:"show",rawName:"v-show",value:e.loading,expression:"loading"}],staticClass:"mab_spinner light right"})])],1)],1),o("div",{staticClass:"container-fluid mt--6"},[o("b-modal",{attrs:{centered:""},scopedSlots:e._u([{key:"modal-header",fn:function(t){t.close;return[o("h6",{staticClass:"modal-title",attrs:{slot:"header",id:"modal-title-default"},slot:"header"},[e._v("Upload Zone File")])]}},{key:"default",fn:function(t){t.hide;return[o("validation-observer",{ref:"uploadform",attrs:{slim:""}},[o("form",{attrs:{role:"form",autocomplete:"off"},on:{submit:function(e){return e.preventDefault(),function(){return!1}.apply(null,arguments)}}},[o("b-row",[o("b-col",{attrs:{md:""}},[o("base-input",{attrs:{label:"Import Type",name:"import type",rules:"required",vid:"type"}},[o("el-select",{attrs:{filterable:"",placeholder:"Import Type"},model:{value:e.upload_model.type,callback:function(t){e.$set(e.upload_model,"type",t)},expression:"upload_model.type"}},[o("el-option",{attrs:{label:"Geographic File",value:"gis",selected:""}})],1)],1)],1),o("b-col",{attrs:{md:""}},[o("base-input",{attrs:{label:"Data Format",name:"data format",rules:"required",vid:"format"}},[o("el-select",{attrs:{filterable:"",placeholder:"Data Format"},model:{value:e.upload_model.format,callback:function(t){e.$set(e.upload_model,"format",t)},expression:"upload_model.format"}},[o("el-option",{attrs:{label:"Zone File (.zip)",value:"zip",selected:""}})],1)],1)],1)],1),o("b-row",[o("b-col",[o("validation-provider",{scopedSlots:e._u([{key:"default",fn:function(t){t.errors;var n=t.validate;return[o("base-input",{attrs:{label:"Zone File (.zip)",name:"file",rules:"required",vid:"filedata"}},[o("b-form-file",{attrs:{placeholder:"Select or drop file here..","drop-placeholder":"Drop file here..."},on:{change:n},model:{value:e.upload_model.filedata,callback:function(t){e.$set(e.upload_model,"filedata",t)},expression:"upload_model.filedata"}})],1)]}}],null,!0)})],1)],1),e.upload_model.log?o("b-row",[o("b-col",{attrs:{md:""}},[o("b-form-textarea",{ref:"importlog",staticClass:"importlog",attrs:{placeholder:"Log output..",readonly:"",plaintext:"",rows:"10","max-rows":"10"},model:{value:e.upload_model.log,callback:function(t){e.$set(e.upload_model,"log",t)},expression:"upload_model.log"}})],1)],1):e._e(),e.upload_model.progress?o("b-row",[o("b-col",{attrs:{md:""}},[o("b-progress",{attrs:{max:100,height:"2rem"}},[o("b-progress-bar",{attrs:{value:e.upload_model.progress,label:e.upload_model.progress+"%",variant:e.upload_model.variant,animated:!e.upload_model.complete}})],1)],1)],1):e._e()],1)])]}},{key:"modal-footer",fn:function(t){t.ok,t.cancel,t.hide;return[o("base-button",{staticClass:"ml-auto",attrs:{type:"outline-primary",disabled:e.upload_model.complete},on:{click:function(t){e.upload_model.busy?e.cancelUpload():e.closeUploadPerimeterModal()}}},[e._v("\n          Cancel\n        ")]),o("base-button",{attrs:{type:"primary",disabled:e.upload_model.busy&&!e.upload_model.complete},on:{click:function(t){e.upload_model.complete?e.closeUploadPerimeterModal():e.uploadPerimeterFiles()}}},[e._v("\n          "+e._s(e.upload_model.busy&&!e.upload_model.complete?"Busy":e.upload_model.complete?"Done":"Upload")+"\n        ")])]}}]),model:{value:e.showUploadPerimeterModal,callback:function(t){e.showUploadPerimeterModal=t},expression:"showUploadPerimeterModal"}}),o("b-modal",{attrs:{centered:""},scopedSlots:e._u([{key:"modal-header",fn:function(t){t.close;return[o("h6",{staticClass:"modal-title",attrs:{slot:"header",id:"modal-title-default"},slot:"header"},[e._v("Set Perimeter & Zones")])]}},{key:"default",fn:function(t){t.hide;return[o("b-row",[o("b-col",[o("base-input",{attrs:{label:" "}},[o("MapPolyDrawer",{attrs:{fullWidthBtn:!0,accessToken:e.$store.state.mapBoxAccessToken,modalTitle:"Draw Perimeter",buttonTitle:"Draw Perimeter",startPos:e.startPos,polyData:e.model.perimeter,additionalLayers:e.additional_layers},on:{savePolyData:e.savePerimeter,cancelPolyDraw:e.closeSetPerimeterModal}})],1)],1),o("b-col",[o("base-input",{attrs:{label:" "}},[o("b-button",{attrs:{variant:"outline-primary",block:!0},on:{click:e.openUploadPerimeterModal}},[e._v("Upload Zone File\n              ")])],1)],1)],1),o("b-row",[o("b-col",[o("base-input",{attrs:{label:" "}},[o("b-button",{attrs:{variant:"outline-primary",block:!0},on:{click:e.confirmPerimeterClearance}},[e._v("Clear Perimeter\n              ")])],1)],1),o("b-col",[o("base-input",{attrs:{label:" "}},[o("b-button",{attrs:{variant:"outline-primary",block:!0},on:{click:e.confirmFieldZonesClearance}},[e._v("Clear Zones\n              ")])],1)],1)],1)]}},{key:"modal-footer",fn:function(t){t.ok,t.cancel,t.hide;return[o("b-button",{staticClass:"ml-auto",attrs:{variant:"outline-primary"},on:{click:e.closeSetPerimeterModal}},[e._v("Cancel")])]}}]),model:{value:e.showSetPerimeterModal,callback:function(t){e.showSetPerimeterModal=t},expression:"showSetPerimeterModal"}}),o("b-modal",{attrs:{centered:"","no-close-on-esc":"","no-close-on-backdrop":""},scopedSlots:e._u([{key:"modal-header",fn:function(t){t.close;return[o("h6",{staticClass:"modal-title",attrs:{slot:"header",id:"modal-title-default"},slot:"header"},[e._v("Change Node Entity")])]}},{key:"default",fn:function(t){t.hide;return[o("validation-observer",{ref:"entity_change_form",attrs:{slim:""}},[o("form",{attrs:{role:"form"},on:{submit:function(e){return e.preventDefault(),function(){return!1}.apply(null,arguments)}}},[o("b-row",[o("b-col",[o("b-toast",{attrs:{visible:!0,variant:"warning",title:"Important",static:"","no-auto-hide":""}},[e._v("\n                  Changing a node's entity would cause:\n                  "),o("ul",[o("li",[e._v("Removal of the node from any security groups")]),o("li",[e._v("Removal of the node from any integrations")]),"Nutrients"==e.model.node_type?o("li",[e._v("The Node's Nutrient Template to revert to Default")]):e._e()])])],1)],1),o("b-row",[o("b-col",[o("div",[o("base-input",{attrs:{label:"Entity",name:"company",rules:"required",vid:"company",placeholder:"Entity",autocomplete:"off"}},[o("el-select",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover.top",modifiers:{hover:!0,top:!0}}],attrs:{disabled:!e.model.node_type||Object.values(e.companies).length<2,filterable:"",placeholder:"Entity",title:"Change the node's owning entity. Note: After changing the entity, you have to also choose a new device before the changes would take effect.",autocomplete:"off"},on:{change:e.companyChanged},model:{value:e.model.company_id,callback:function(t){e.$set(e.model,"company_id",t)},expression:"model.company_id"}},[e.model.node_type&&Object.values(e.companies).length?[e._l(e.companies,(function(t){return[e.userCan("Edit","Node Config",t.id,"C")||e.userCan("Edit",e.convertNodeTypeToSubsystem(e.model.node_type),t.id,"C")?o("el-option",{key:t.id,attrs:{label:t.company_name,value:t.id}},[o("span",[e._v(e._s(t.company_name))])]):e._e()]}))]:e._e()],2)],1)],1)])],1),o("b-row",[o("b-col",[o("div",[o("base-input",{attrs:{label:"Device Type",name:"device type",rules:"required",vid:"hardware_management_id"}},[o("el-select",{model:{value:e.model.hardware_management_id,callback:function(t){e.$set(e.model,"hardware_management_id",t)},expression:"model.hardware_management_id"}},e._l(e.device_types,(function(t){return o("el-option",{key:t.id,attrs:{label:t.device_make,value:t.id}},[o("span",{staticStyle:{float:"left"}},[e._v(e._s(t.device_make))]),o("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px","margin-right":"1em"}},[e._v(e._s(t.company_name))])])})),1)],1)],1)])],1)],1)])]}},{key:"modal-footer",fn:function(t){t.ok,t.cancel,t.hide;return[o("b-button",{staticClass:"ml-auto",attrs:{variant:"outline-primary"},on:{click:e.closeNodeEntityChangeModal}},[e._v("Cancel")]),o("b-button",{attrs:{variant:"primary"},on:{click:e.changeNodeEntity}},[e._v("Change Node Entity")])]}}]),model:{value:e.showNodeEntityChangeModal,callback:function(t){e.showNodeEntityChangeModal=t},expression:"showNodeEntityChangeModal"}}),o("b-modal",{attrs:{centered:"","no-close-on-esc":"","no-close-on-backdrop":""},scopedSlots:e._u([{key:"modal-header",fn:function(t){t.close;return[o("h6",{staticClass:"modal-title",attrs:{slot:"header",id:"modal-title-default"},slot:"header"},[e._v("Change Node Type")])]}},{key:"default",fn:function(t){t.hide;return[o("validation-observer",{ref:"change_node_type_form",attrs:{slim:""}},[o("form",{attrs:{role:"form"},on:{submit:function(e){return e.preventDefault(),function(){return!1}.apply(null,arguments)}}},[o("b-row",[o("b-col",[o("b-toast",{attrs:{visible:!0,variant:"warning",title:"Important",static:"","no-auto-hide":""}},[e._v("\n                  Changing a node's type would cause:\n                  "),o("ul",[o("li",[e._v("Removal of the node from any security groups")]),o("li",[e._v("Removal of the node from any integrations")])])])],1)],1),o("b-row",[o("b-col",[o("div",[o("base-input",{attrs:{label:"Node Type",name:"node type",rules:"required",vid:"node_type"}},[o("el-select",{attrs:{filterable:"",placeholder:"Node Type"},on:{change:e.nodeTypeChanged},model:{value:e.model.node_type,callback:function(t){e.$set(e.model,"node_type",t)},expression:"model.node_type"}},[o("el-option",{attrs:{disabled:!e.userCan("Add","Node Config")&&!e.userCan("Add","Soil Moisture"),label:"Soil Moisture",value:"Soil Moisture"}}),o("el-option",{attrs:{disabled:!e.userCan("Add","Node Config")&&!e.userCan("Add","Nutrients"),label:"Nutrients",value:"Nutrients"}}),o("el-option",{attrs:{disabled:!e.userCan("Add","Node Config")&&!e.userCan("Add","Well Controls"),label:"Well Controls",value:"Wells"}}),o("el-option",{attrs:{disabled:!e.userCan("Add","Node Config")&&!e.userCan("Add","Meters"),label:"Water Meter",value:"Water Meter"}})],1)],1)],1)])],1),o("b-row",[o("b-col",[o("div",[o("base-input",{attrs:{label:"Device Type",name:"device type",rules:"required",vid:"hardware_management_id"}},[o("el-select",{model:{value:e.model.hardware_management_id,callback:function(t){e.$set(e.model,"hardware_management_id",t)},expression:"model.hardware_management_id"}},e._l(e.device_types,(function(t){return o("el-option",{key:t.id,attrs:{label:t.device_make,value:t.id}},[o("span",{staticStyle:{float:"left"}},[e._v(e._s(t.device_make))]),o("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px","margin-right":"1em"}},[e._v(e._s(t.company_name))])])})),1)],1)],1)])],1)],1)])]}},{key:"modal-footer",fn:function(t){t.ok,t.cancel,t.hide;return[o("b-button",{staticClass:"ml-auto",attrs:{variant:"outline-primary"},on:{click:e.closeNodeTypeChangeModal}},[e._v("Cancel")]),o("b-button",{attrs:{variant:"primary"},on:{click:e.changeNodeType}},[e._v("Change Node Type")])]}}]),model:{value:e.showNodeTypeChangeModal,callback:function(t){e.showNodeTypeChangeModal=t},expression:"showNodeTypeChangeModal"}}),o("b-modal",{attrs:{centered:"","no-close-on-esc":"","no-close-on-backdrop":""},scopedSlots:e._u([{key:"modal-header",fn:function(t){t.close;return[o("h6",{staticClass:"modal-title",attrs:{slot:"header",id:"modal-title-default"},slot:"header"},[e._v("Change Node Address")])]}},{key:"default",fn:function(t){t.hide;return[o("validation-observer",{ref:"change_address_form",attrs:{slim:""}},[o("form",{attrs:{role:"form"},on:{submit:function(e){return e.preventDefault(),function(){return!1}.apply(null,arguments)}}},[o("b-row",[o("b-col",[o("div",[o("base-input",{attrs:{label:"Node Address",vid:"node_address",rules:"required",name:"node address",placeholder:"Node Address"},model:{value:e.node_address_edit,callback:function(t){e.node_address_edit=t},expression:"node_address_edit"}})],1)]),o("b-col",[o("div",[o("base-input",{attrs:{label:"Probe Address",vid:"probe_address",name:"probe_address",placeholder:"Probe Address"},model:{value:e.probe_address_edit,callback:function(t){e.probe_address_edit=t},expression:"probe_address_edit"}})],1)])],1)],1)])]}},{key:"modal-footer",fn:function(t){t.ok,t.cancel,t.hide;return[o("b-button",{staticClass:"ml-auto",attrs:{variant:"outline-primary"},on:{click:e.closeAddressChangeModal}},[e._v("Cancel")]),o("b-button",{attrs:{variant:"primary"},on:{click:e.changeNodeAddress}},[e._v("Change Address")])]}}]),model:{value:e.showAddressChangeModal,callback:function(t){e.showAddressChangeModal=t},expression:"showAddressChangeModal"}}),o("validation-observer",{ref:"form",attrs:{slim:""}},[o("div",{staticClass:"row"},[o("div",{staticClass:"col-md-12"},[o("card",{attrs:{"body-classes":"px-0 py-0"}},[o("template",{slot:"header"},["Soil Moisture"==e.model.node_type||"Nutrients"==e.model.node_type?o("base-button",{staticClass:"btn",attrs:{disabled:!e.userCan("Edit","Node Config")||e.loading,size:"sm",type:"primary",icon:""},nativeOn:{click:function(t){return e.openSetPerimeterModal.apply(null,arguments)}}},[e._v("\n                Set Perimeter & Zones\n              ")]):e._e()],1),o("div",{staticClass:"card-body"},[o("b-row",{attrs:{"align-v":"center"}},[o("b-col",{attrs:{md:""}},[o("div",[o("base-input",{attrs:{label:"Node Address"}},[o("b-input-group",[o("b-form-input",{attrs:{type:"text",placeholder:"Node Address",readonly:""},model:{value:e.model.node_address,callback:function(t){e.$set(e.model,"node_address",t)},expression:"model.node_address"}}),o("b-input-group-append",[o("b-button",{attrs:{disabled:!e.isDistributor()&&!e.isAdmin(),variant:"outline-primary"},on:{click:e.openAddressChangeModal}},[e._v("Change")])],1)],1)],1)],1)]),o("b-col",{attrs:{md:""}},[o("div",[o("base-input",{attrs:{label:"Node Type"}},[o("b-input-group",[o("b-form-input",{attrs:{type:"text",placeholder:"Node Type",readonly:""},model:{value:e.model.node_type,callback:function(t){e.$set(e.model,"node_type",t)},expression:"model.node_type"}}),o("b-input-group-append",[o("b-button",{attrs:{disabled:!e.isDistributor()&&!e.isAdmin(),variant:"outline-primary"},on:{click:e.openNodeTypeChangeModal}},[e._v("Change")])],1)],1)],1)],1)]),o("b-col",{attrs:{md:""}},[o("div",[o("base-input",{attrs:{label:"Commissioning Date",disabled:""},model:{value:e.model.commissioning_date,callback:function(t){e.$set(e.model,"commissioning_date",t)},expression:"model.commissioning_date"}})],1)])],1),o("b-row",{attrs:{"align-v":"center"}},[o("b-col",{attrs:{md:""}},[o("div",[o("base-input",{attrs:{name:"latitude",rules:{regex:/^-?\d+(\.\d{1,15})?$/},label:"Latitude",placeholder:"Latitude",vid:"latt"},on:{change:e.syncFields},model:{value:e.model.latt,callback:function(t){e.$set(e.model,"latt",t)},expression:"model.latt"}})],1)]),o("b-col",{attrs:{md:""}},[o("div",[o("base-input",{attrs:{name:"longitude",rules:{regex:/^-?\d+(\.\d{1,15})?$/},label:"Longitude",placeholder:"Longitude",vid:"lng"},on:{change:e.syncFields},model:{value:e.model.lng,callback:function(t){e.$set(e.model,"lng",t)},expression:"model.lng"}})],1)]),o("b-col",{attrs:{md:""}},[o("div",[o("base-input",{attrs:{label:" "}},[o("MapCoordsPicker",{attrs:{fullWidthBtn:!0,accessToken:e.$store.state.mapBoxAccessToken,modalTitle:"Pinpoint Coordinates",buttonTitle:"Set Coords Visually",additionalLayers:e.additional_layers,startPos:e.startPos},on:{setCoords:e.setCoords}})],1)],1)]),o("b-col",{attrs:{md:""}},[o("div",[o("base-input",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover.top",modifiers:{hover:!0,top:!0}}],attrs:{label:" ",title:"Locking the coordinates will prevent them from being overridden by device updates."}},[o("b-form-checkbox",{attrs:{size:"lg","unchecked-value":0,value:1},on:{change:e.syncFields},model:{value:e.model.coords_locked,callback:function(t){e.$set(e.model,"coords_locked",t)},expression:"model.coords_locked"}},[e._v("\n                        Lock Coordinates?\n                      ")])],1)],1)])],1),o("b-row",{attrs:{"align-v":"center"}},[o("b-col",{attrs:{md:""}},[o("div",[o("base-input",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover.top",modifiers:{hover:!0,top:!0}}],attrs:{name:"",label:"Node Serial Number",placeholder:"Node Serial",vid:"wl_station_name",title:"The node's serial number"},on:{change:e.syncFields},model:{value:e.model.node_serial_number,callback:function(t){e.$set(e.model,"node_serial_number",t)},expression:"model.node_serial_number"}})],1)]),o("b-col",{attrs:{md:""}},[o("div",[o("base-input",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover.top",modifiers:{hover:!0,top:!0}}],attrs:{name:"station name",label:"W.Station Name",placeholder:"W.Station Name",vid:"wl_station_name",title:"Optionally enter an associated weather station's name."},on:{change:e.syncFields},model:{value:e.model.wl_station_name,callback:function(t){e.$set(e.model,"wl_station_name",t)},expression:"model.wl_station_name"}})],1)]),o("b-col",{attrs:{md:""}},[o("div",[o("base-input",{attrs:{label:"Entity"}},[o("b-input-group",[o("b-form-input",{attrs:{type:"text",placeholder:"Entity",readonly:""},model:{value:e.node_company_name,callback:function(t){e.node_company_name=t},expression:"node_company_name"}}),o("b-input-group-append",[o("b-button",{attrs:{disabled:!e.isDistributor()&&!e.isAdmin(),variant:"outline-primary"},on:{click:e.openNodeEntityChangeModal}},[e._v("Change")])],1)],1)],1)],1)])],1),o("b-row",[o("b-col",{attrs:{cols:"6",md:"8"}},[o("div",[o("base-input",{attrs:{name:"field name",rules:"required",label:"Field Name",placeholder:"Field Name",vid:"field_name"},on:{change:e.syncFields},model:{value:e.model.field_name,callback:function(t){e.$set(e.model,"field_name",t)},expression:"model.field_name"}})],1)]),o("b-col",{attrs:{cols:"6",sm:"4"}},[o("div",[o("base-input",{attrs:{name:"field zone id",rules:"integer",label:"Field Zone ID",placeholder:"Field Zone ID",vid:"zone"},on:{change:e.syncFields},model:{value:e.model.zone,callback:function(t){e.$set(e.model,"zone",t)},expression:"model.zone"}})],1)])],1)],1)],2)],1),o("div",{staticClass:"col-md-12"},[o("card",{attrs:{"body-classes":"px-0 py-0"}},[o("template",{slot:"header"},[o("h3",{staticClass:"mb-0"},[e._v("Node Config - Advanced - "+e._s(e.model.node_type))])]),o("div",{staticClass:"card-body"},[o("b-row",{attrs:{"align-v":"center"}},[o("b-col",{attrs:{md:""}},[o("div",[o("base-input",{attrs:{label:"Sensor Type",name:"device type",rules:"required",vid:"hardware_management_id"}},[o("el-select",{on:{change:e.syncFields},model:{value:e.model.hardware_management_id,callback:function(t){e.$set(e.model,"hardware_management_id",t)},expression:"model.hardware_management_id"}},e._l(e.device_types,(function(t){return o("el-option",{key:t.id,attrs:{label:t.device_make,value:t.id}},[o("span",{staticStyle:{float:"left"}},[e._v(e._s(t.device_make))]),o("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px","margin-right":"1em"}},[e._v(e._s(t.company_name))])])})),1)],1)],1)]),o("b-col",{attrs:{md:""}},[o("div",[o("base-input",{attrs:{name:"device serial number",rules:"required",label:"Device Serial Number",placeholder:"Device Serial",vid:"device_serial_number"},on:{change:e.syncFields},model:{value:e.model.device_serial_number,callback:function(t){e.$set(e.model,"device_serial_number",t)},expression:"model.device_serial_number"}})],1)])],1)],1)],2)],1),e.model.integration_opts&&Object.keys(e.model.integration_opts).length&&e.userCan("Integrate","Entities")?o("div",{staticClass:"col-md-12"},[o("card",{attrs:{"body-classes":"px-0 py-0"}},[o("template",{slot:"header"},[o("h3",{staticClass:"mb-0"},[e._v("Node Config - Integration Options")])]),o("div",{staticClass:"card-body"},[e._l(e.model.integration_opts,(function(t,n){return[o("b-row",{key:n},[o("b-col",[o("h4",[e._v(e._s(n)+" Options")])])],1),o("b-row",e._l(t.hardware_config,(function(t,n){return o("b-col",{key:n,attrs:{sm:"4"}},["bool"==t.type?o("base-input",{attrs:{label:t.label}},[o("b-form-checkbox",{attrs:{value:"1","unchecked-value":"0"},on:{change:e.syncFields},model:{value:t.value,callback:function(o){e.$set(t,"value",o)},expression:"opt.value"}},[e._v("\n                        "+e._s(t.desc?t.desc:t.label)+"\n                      ")])],1):e._e()],1)})),1)]}))],2)],2)],1):e._e()])])],1)],1)},i=[],a=(o("96cf"),o("3b8d")),s=(o("6b54"),o("bd86")),l=(o("6611"),o("450d"),o("e772")),c=o.n(l),u=(o("7f7f"),o("1f1a"),o("4e4b")),d=o.n(u),p=o("c38f"),f=o.n(p),h=(o("0952"),o("3d20")),m=o.n(h),g=o("8fe0"),y=o("0392"),v=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"mappolydrawer"},[o("b-modal",{attrs:{title:e.modalTitle,centered:"",size:"xl"},scopedSlots:e._u([{key:"modal-footer",fn:function(t){var n=t.ok,r=t.cancel;t.hide;return[o("b-button",{attrs:{variant:"outline-primary"},on:{click:function(t){return e.cancelPolyDraw(r)}}},[e._v("Cancel")]),o("b-button",{attrs:{variant:"primary"},on:{click:function(t){return e.savePolyData(n)}}},[e._v("Save")])]}}]),model:{value:e.showModal,callback:function(t){e.showModal=t},expression:"showModal"}},[o("div",{staticClass:"mapcontainer"},[o("MglMap",{attrs:{repaint:!0,mapboxGl:e.mapboxObj,accessToken:e.accessToken,mapStyle:e.mapStyle,attributionControl:!1,center:e.startPos,logoPosition:"bottom-right"},on:{"update:mapStyle":function(t){e.mapStyle=t},"update:map-style":function(t){e.mapStyle=t},load:e.mapLoaded}},[o("MglNavigationControl",{attrs:{position:"top-right"}}),o("MglGeolocateControl",{attrs:{position:"top-right"}}),e.additionalLayers&&e.additionalLayers.length?e._l(e.additionalLayers,(function(e,t){return o("MglGeojsonLayer",{key:t,attrs:{sourceId:e.layer.id,layerId:e.layer.id,source:e.source,layer:e.layer,clearSource:!1}})})):e._e()],2)],1)]),o("b-button",{attrs:{variant:"outline-primary",block:e.fullWidthBtn},on:{click:function(t){e.showModal=!e.showModal}}},[e._v(e._s(e.buttonTitle))])],1)},b=[],_=(o("ac6a"),o("456d"),o("e192")),C=o.n(_),x=o("baf6"),S=o("cae8"),w=o.n(S),M=(o("bdd0"),o("5e6e")),k=o("6682"),E={name:"mappolydrawer",components:{MglMap:M["c"],MglGeojsonLayer:M["a"],MglNavigationControl:M["e"],MglGeolocateControl:M["b"]},props:{accessToken:{type:String,required:!0},modalTitle:{type:String,default:"Draw Outline"},buttonTitle:{type:String,default:"Set Outline"},navcontrols:{type:Boolean,default:!0},geocontrols:{type:Boolean,default:!0},fullWidthBtn:{type:Boolean,default:!1},startPos:{type:Object,default:{lat:0,lng:0}},polyData:{type:Object,default:{}},additionalLayers:{type:Array,default:[]}},data:function(){return{map:null,mapDraw:null,mapboxObj:null,mapStyle:null,mapActions:null,showModal:!1}},methods:{mapLoaded:function(e){e.map._isVue=!0,C.a._isVue=!0;var t=this.polyData&&0!==Object.keys(this.polyData).length;this.map=e.map,this.mapboxObj=C.a,this.map.resize(),this.mapActions=e.component.actions,this.mapDraw=new w.a({displayControlsDefault:!1,controls:{polygon:!0,trash:!0},defaultMode:t?"simple_select":"draw_polygon"}),this.map.addControl(this.mapDraw,"top-left"),t&&this.mapDraw.add(this.polyData),this.mapActions.flyTo({zoom:14,center:this.startPos,duration:3e3,animate:!0,easing:k["a"].easeInOutQuad,essential:!0})},savePolyData:function(e){e(),this.$emit("savePolyData",this.mapDraw.getAll())},cancelPolyDraw:function(e){e(),this.$emit("cancelPolyDraw")}},mounted:function(){this.mapStyle=x["a"]}},P=E,I=(o("313f"),o("2877")),L=Object(I["a"])(P,v,b,!1,null,"5a27c1ed",null),F=L.exports,T={mixins:[g["a"]],components:(n={MapCoordsPicker:y["a"],MapPolyDrawer:F,flatPicker:f.a},Object(s["a"])(n,d.a.name,d.a),Object(s["a"])(n,c.a.name,c.a),n),data:function(){return{loading:!1,model:{id:"",node_address:"",probe_address:"",node_type:"",commissioning_date:"",field_name:"",latt:"",lng:"",zone:"",coords_locked:0,node_make:null,hardware_management_id:"",node_serial_number:null,device_serial_number:null,wl_station_name:"",company_id:null,perimeter:null,integration_opts:null},additional_layers:null,upload_model:{type:"gis",format:"zip",filedata:"",log:"",progress:0,busy:!1,complete:!1,variant:"success"},field_id:null,companies:[],device_types:[],node_company_name:"",showUploadPerimeterModal:!1,showSetPerimeterModal:!1,showAddressChangeModal:!1,showNodeTypeChangeModal:!1,showNodeEntityChangeModal:!1,prev_company_id:null,prev_hardware_management_id:null,prev_node_type:null,node_address_edit:"",probe_address_edit:"",startPos:{lat:0,lng:0}}},methods:{loadHardware:function(){var e=this;this.loading=!0,this.$axios.get("/api/hardwareconfig/"+this.$route.params.node_address).then((function(t){if(e.loading=!1,"hardware_loaded"==t.data.message){e.model=t.data.hardware,e.field_id=t.data.field_id,e.model.perimeter&&(e.model.perimeter=JSON.parse(e.model.perimeter)),t.data.additional_layers&&(e.additional_layers=JSON.parse(t.data.additional_layers)),e.startPos={lat:e.model.latt,lng:e.model.lng};var o=e.model.node_address.substring(0,e.model.node_address.lastIndexOf("-")),n=e.model.node_address.substring(e.model.node_address.lastIndexOf("-")+1,e.model.node_address.length);o&&(e.node_address_edit=o),n&&(e.probe_address_edit=n),e.loadCompanies(),e.loadSensorTypes()}}))},syncFields:function(){var e=this;return this.$refs.form.validate().then((function(t){return t?(e.loading=!0,e.$axios.post("/api/hardwareconfigsave",e.model).then((function(t){return e.loading=!1,"success"==t.data.message&&e.$notify({title:"Saved",message:"Changes were saved",type:"success",verticalAlign:"top",horizontalAlign:"right"}),t})).catch((function(t){return e.loading=!1,t.response.data.errors&&e.$refs.form.setErrors(t.response.data.errors),t}))):(e.$notify({title:"Required",message:"Please fill in all fields",type:"danger",verticalAlign:"top",horizontalAlign:"right",duration:1e3,clean:!0}),!1)}))},loadCompanies:function(){var e=this,t=this.convertNodeTypeToSubsystem(this.model.node_type);t&&(this.userCan("Edit","Node Config")?this.$axios.post("/api/companies_list",{context:[{verb:"Edit",module:"Node Config"},{verb:"Edit",module:t}]}).then((function(t){e.companies=t.data.companies,e.node_company_name=e.companies['"'+e.model.company_id.toString()+'"'].company_name})):this.userCan("Edit",t)&&this.$axios.post("/api/companies_list",{context:[{verb:"Edit",module:t}]}).then((function(t){e.companies=t.data.companies,e.node_company_name=e.companies['"'+e.model.company_id.toString()+'"'].company_name})))},loadSensorTypes:function(){var e=this;this.$axios.post("/api/hardwaremanagementlist",{device_type:this.model.node_type,company_id:this.model.company_id}).then((function(t){e.device_types=t.data.hardware}))},companyChanged:function(){this.prepSensorChange()},nodeTypeChanged:function(){this.prepSensorChange()},prepSensorChange:function(){this.model.hardware_management_id="",this.loadSensorTypes()},openUploadPerimeterModal:function(){this.showUploadPerimeterModal=!0},closeUploadPerimeterModal:function(){this.resetUploadModel(),this.closeSetPerimeterModal(),this.showUploadPerimeterModal=!1},cancelUpload:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.upload_model.busy=!1,this.upload_model.complete=!1,this.upload_model.progress=0,e&&this.importLog("Canceling Upload")},fileSelectionChange:function(e){e(),this.upload_model.busy=!1,this.upload_model.complete=!1,this.upload_model.progress=0,this.importLog("New file selected",!0)},importLog:function(e){var t=this,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];o?this.upload_model.log=e+"\n":this.upload_model.log+=e+"\n",this.$nextTick((function(){t.$refs.importlog&&(t.$refs.importlog.$el.scrollTop=t.$refs.importlog.$el.scrollHeight)}))},openSetPerimeterModal:function(){this.showSetPerimeterModal=!0},closeSetPerimeterModal:function(){this.showSetPerimeterModal=!1},openAddressChangeModal:function(){this.showAddressChangeModal=!0},closeAddressChangeModal:function(){this.showAddressChangeModal=!1},openNodeTypeChangeModal:function(){this.showNodeTypeChangeModal=!0,this.prev_node_type=this.model.node_type,this.prev_hardware_management_id=this.model.hardware_management_id},openNodeEntityChangeModal:function(){this.showNodeEntityChangeModal=!0,this.prev_company_id=this.model.company_id,this.prev_hardware_management_id=this.model.hardware_management_id},closeNodeTypeChangeModal:function(){this.showNodeTypeChangeModal=!1,this.model.node_type=this.prev_node_type,this.model.hardware_management_id=this.prev_hardware_management_id,this.loadSensorTypes()},closeNodeEntityChangeModal:function(){this.showNodeEntityChangeModal=!1,this.model.company_id=this.prev_company_id,this.model.hardware_management_id=this.prev_hardware_management_id,this.loadSensorTypes()},resetUploadModel:function(){this.upload_model={filedata:"",log:"",progress:0,busy:!1,complete:!1,variant:"success"}},uploadPerimeterFiles:function(){var e=this;this.$refs.uploadform.validate().then((function(t){if(t){e.loading=!0,e.upload_model.busy=!0,e.importLog("STARTING UPLOAD"),e.importLog("Uploading file.."),e.upload_model.progress=10;var o=new FormData;o.set("type",e.upload_model.type),o.set("format",e.upload_model.format),o.append("filedata",e.upload_model.filedata),e.$axios.post("/api/dataImport",o,{headers:{"Content-Type":"multipart/form-data"}}).then(function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(o){var n,r,i,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.loading=!1,n=o.data,"file_uploaded"!=n.status){t.next=6;break}e.importLog("File uploaded"),t.next=39;break;case 6:if("unsupported_file"!=n.status){t.next=12;break}return e.importLog("Unsupported File Uploaded"),e.cancelUpload(!1),t.abrupt("return");case 12:if("upload_error"!=n.status){t.next=18;break}return e.importLog("File upload error, aborting.."),e.cancelUpload(!1),t.abrupt("return");case 18:if("file_extraction_error"!=n.status&&"invalid_or_missing_file"!=n.status){t.next=24;break}return e.importLog("Invalid/corrupt Zip file, aborting.."),e.cancelUpload(!1),t.abrupt("return");case 24:if("file_multiple"!=n.status){t.next=30;break}return e.importLog("More than one "+n.file+" present, aborting.."),e.cancelUpload(!1),t.abrupt("return");case 30:if("file_missing"!=n.status){t.next=36;break}return e.importLog(n.file+" file missing from archive, aborting.."),e.cancelUpload(!1),t.abrupt("return");case 36:return e.importLog("Server-side error occurred, aborting.."),e.cancelUpload(!1),t.abrupt("return");case 39:if(e.upload_model.progress=40,!n.type||"gis"!=n.type){t.next=54;break}if(!n.format||"zip"!=n.format){t.next=54;break}r=!0;case 43:if(!r){t.next=54;break}return e.loading=!0,t.next=47,e.$axios.post("/api/dataImport",{ticket:n.ticket,type:n.type,format:n.format,field_id:e.field_id});case 47:i=t.sent,e.loading=!1,a=i.data,"general_error"==a.status&&(e.importLog("Server-side error occurred, aborting.."),a.output&&e.importLog(a.output),e.upload_model.progress=0,e.upload_model.busy=!1,r=!1),"processing_complete"==a.status&&(e.upload_model.progress=100,e.importLog("PROCESSING COMPLETED"),a.output&&e.importLog(a.output),r=!1,e.upload_model.busy=!1,e.upload_model.complete=!0),t.next=43;break;case 54:e.loading=!1;case 55:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}})).catch((function(t){e.upload_model.progress=0,e.upload_model.busy=!1,e.importLog("Server-side error occurred.")}))},setCoords:function(e){this.model.latt=e.lat,this.model.lng=e.lng,this.syncFields()},savePerimeter:function(e){this.closeSetPerimeterModal(),e&&"undefined"!==typeof e.type&&"FeatureCollection"==e.type&&(this.model.perimeter=e,this.syncFields())},changeNodeAddress:function(){var e=this;this.$refs.change_address_form.validate().then((function(t){t?(e.loading=!0,e.$axios.post("/api/hardwareconfigaddrchange",{old_address:e.model.node_address,node_address:e.node_address_edit,probe_address:e.probe_address_edit}).then((function(t){e.loading=!1,"success"==t.data.message&&(e.model.node_address=e.node_address_edit+"-"+e.probe_address_edit,e.model.probe_address=e.probe_address_edit,e.closeAddressChangeModal(),e.$notify({title:"Success",message:"Node address changed. "+t.data.count+" row(s) updated.",type:"success",verticalAlign:"top",horizontalAlign:"right"}))})).catch((function(t){e.loading=!1,t.response.data.errors&&e.$refs.change_address_form.setErrors(t.response.data.errors)}))):e.$notify({title:"Required",message:"Please fill in all fields",type:"danger",verticalAlign:"top",horizontalAlign:"right",duration:1e3,clean:!0})}))},changeNodeType:function(){var e=this;this.$refs.change_node_type_form.validate().then((function(t){t?e.syncFields().then((function(){e.$notify({title:"Success",message:"Node type changed.",type:"success",verticalAlign:"top",horizontalAlign:"right"}),e.showNodeTypeChangeModal=!1})):e.$notify({title:"Required",message:"Please fill in all fields",type:"danger",verticalAlign:"top",horizontalAlign:"right",duration:1e3,clean:!0})}))},changeNodeEntity:function(){var e=this;this.$refs.entity_change_form.validate().then((function(t){if(!t)return e.$notify({title:"Required",message:"Please fill in all fields",type:"danger",verticalAlign:"top",horizontalAlign:"right",duration:1e3,clean:!0}),!1;e.syncFields().then((function(){e.$notify({title:"Success",message:"Node entity changed.",type:"success",verticalAlign:"top",horizontalAlign:"right"}),e.showNodeEntityChangeModal=!1})).catch((function(t){e.$notify({title:"Failure",message:"Node entity change failed.",type:"warning",verticalAlign:"top",horizontalAlign:"right"}),e.showNodeEntityChangeModal=!1}))}))},confirmPerimeterClearance:function(){var e=this;m.a.fire({title:"Clear Perimeter",text:"Please confirm field perimeter clearance",type:"warning",showCancelButton:!0,confirmButtonText:"Clear",buttonsStyling:!1,customClass:{cancelButton:"btn btn-outline-primary",confirmButton:"btn btn-primary"}}).then((function(t){t.value&&e.clearFieldPerimeter(e.field_id)}))},clearFieldPerimeter:function(e){var t=this;e?(this.loading=!0,this.$axios.post("/api/clearfieldperimeter",{field_id:e}).then((function(e){t.loading=!1,"success"==e.data.message&&t.$notify({title:"Success",message:"Field Perimeter cleared.",type:"success",verticalAlign:"top",horizontalAlign:"right"})})).catch((function(e){t.loading=!1,e.response.data.errors&&console.log(e.response.data.errors)}))):console.log("Error! missing field_id")},confirmFieldZonesClearance:function(){var e=this;m.a.fire({title:"Clear Zones",text:"Please confirm field zones clearance",type:"warning",showCancelButton:!0,confirmButtonText:"Clear",buttonsStyling:!1,customClass:{cancelButton:"btn btn-outline-primary",confirmButton:"btn btn-primary"}}).then((function(t){t.value&&e.clearFieldZones(e.field_id)}))},clearFieldZones:function(e){var t=this;e?(this.loading=!0,this.$axios.post("/api/clearfieldzones",{field_id:e}).then((function(e){t.loading=!1,"success"==e.data.message&&t.$notify({title:"Success",message:"Field Zones cleared.",type:"success",verticalAlign:"top",horizontalAlign:"right"})})).catch((function(e){t.loading=!1,e.response.data.errors&&console.log(e.response.data.errors)}))):console.log("Error! missing field_id")}},mounted:function(){this.loadHardware()}},N=T,A=Object(I["a"])(N,r,i,!1,null,null,null);t["default"]=A.exports},"8a9b":function(e,t,o){},bdd0:function(e,t,o){},cae8:function(e,t,o){(function(t){!function(t,o){e.exports=o()}(0,(function(){"use strict";var e=function(e,t){var o={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},n={on:function(e,t,n){if(void 0===o[e])throw new Error("Invalid event type: "+e);o[e].push({selector:t,fn:n})},render:function(e){t.store.featureChanged(e)}},r=function(e,r){for(var i=o[e],a=i.length;a--;){var s=i[a];if(s.selector(r)){s.fn.call(n,r)||t.store.render(),t.ui.updateMapClasses();break}}};return e.start.call(n),{render:e.render,stop:function(){e.stop&&e.stop()},trash:function(){e.trash&&(e.trash(),t.store.render())},combineFeatures:function(){e.combineFeatures&&e.combineFeatures()},uncombineFeatures:function(){e.uncombineFeatures&&e.uncombineFeatures()},drag:function(e){r("drag",e)},click:function(e){r("click",e)},mousemove:function(e){r("mousemove",e)},mousedown:function(e){r("mousedown",e)},mouseup:function(e){r("mouseup",e)},mouseout:function(e){r("mouseout",e)},keydown:function(e){r("keydown",e)},keyup:function(e){r("keyup",e)},touchstart:function(e){r("touchstart",e)},touchmove:function(e){r("touchmove",e)},touchend:function(e){r("touchend",e)},tap:function(e){r("tap",e)}}},o=6378137;function n(e){var t=0;if(e&&e.length>0){t+=Math.abs(r(e[0]));for(var o=1;o<e.length;o++)t-=Math.abs(r(e[o]))}return t}function r(e){var t,n,r,a,s,l,c=0,u=e.length;if(u>2){for(l=0;l<u;l++)l===u-2?(r=u-2,a=u-1,s=0):l===u-1?(r=u-1,a=0,s=1):(r=l,a=l+1,s=l+2),t=e[r],n=e[a],c+=(i(e[s][0])-i(t[0]))*Math.sin(i(n[1]));c=c*o*o/2}return c}function i(e){return e*Math.PI/180}var a={geometry:function e(t){var o,r=0;switch(t.type){case"Polygon":return n(t.coordinates);case"MultiPolygon":for(o=0;o<t.coordinates.length;o++)r+=n(t.coordinates[o]);return r;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(o=0;o<t.geometries.length;o++)r+=e(t.geometries[o]);return r}},ring:r},s="mapboxgl-ctrl",l="mapbox-gl-draw_ctrl-draw-btn",c="mapbox-gl-draw_line",u="mapbox-gl-draw_polygon",d="mapbox-gl-draw_point",p="mapbox-gl-draw_trash",f="mapbox-gl-draw_combine",h="mapbox-gl-draw_uncombine",m="mapboxgl-ctrl-group",g="active",y="mapbox-gl-draw_boxselect",v="mapbox-gl-draw-hot",b="mapbox-gl-draw-cold",_="add",C="move",x="drag",S="pointer",w="none",M={POLYGON:"polygon",LINE:"line_string",POINT:"point"},k="Feature",E="Polygon",P="LineString",I="Point",L="FeatureCollection",F="Multi",T="MultiPoint",N="MultiLineString",A="MultiPolygon",O={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},D="draw.create",j="draw.delete",$="draw.update",U="draw.selectionchange",R="draw.modechange",B="draw.actionable",z="draw.render",V="draw.combine",G="draw.uncombine",J="move",q="change_coordinates",W="feature",Z="midpoint",Y="vertex",K="true",H="false",Q=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],X={Point:0,LineString:1,Polygon:2};function ee(e,t){var o=X[e.geometry.type]-X[t.geometry.type];return 0===o&&e.geometry.type===E?e.area-t.area:o}function te(e){if(this._items={},this._nums={},this._length=e?e.length:0,e)for(var t=0,o=e.length;t<o;t++)this.add(e[t]),void 0!==e[t]&&("string"==typeof e[t]?this._items[e[t]]=t:this._nums[e[t]]=t)}te.prototype.add=function(e){return this.has(e)||(this._length++,"string"==typeof e?this._items[e]=this._length:this._nums[e]=this._length),this},te.prototype.delete=function(e){return!1===this.has(e)||(this._length--,delete this._items[e],delete this._nums[e]),this},te.prototype.has=function(e){return("string"==typeof e||"number"==typeof e)&&(void 0!==this._items[e]||void 0!==this._nums[e])},te.prototype.values=function(){var e=this,t=[];return Object.keys(this._items).forEach((function(o){t.push({k:o,v:e._items[o]})})),Object.keys(this._nums).forEach((function(o){t.push({k:JSON.parse(o),v:e._nums[o]})})),t.sort((function(e,t){return e.v-t.v})).map((function(e){return e.k}))},te.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var oe=[W,Z,Y],ne={click:function(e,t,o){return re(e,t,o,o.options.clickBuffer)},touch:function(e,t,o){return re(e,t,o,o.options.touchBuffer)}};function re(e,t,o,n){if(null===o.map)return[];var r=e?function(e,t){return void 0===t&&(t=0),[[e.point.x-t,e.point.y-t],[e.point.x+t,e.point.y+t]]}(e,n):t,i={};o.options.styles&&(i.layers=o.options.styles.map((function(e){return e.id})));var s=o.map.queryRenderedFeatures(r,i).filter((function(e){return-1!==oe.indexOf(e.properties.meta)})),l=new te,c=[];return s.forEach((function(e){var t=e.properties.id;l.has(t)||(l.add(t),c.push(e))})),function(e){return e.map((function(e){return e.geometry.type===E&&(e.area=a.geometry({type:k,property:{},geometry:e.geometry})),e})).sort(ee).map((function(e){return delete e.area,e}))}(c)}function ie(e,t){var o=ne.click(e,null,t),n={mouse:w};return o[0]&&(n.mouse=o[0].properties.active===K?C:S,n.feature=o[0].properties.meta),-1!==t.events.currentModeName().indexOf("draw")&&(n.mouse=_),t.ui.queueMapClasses(n),t.ui.updateMapClasses(),o[0]}function ae(e,t){var o=e.x-t.x,n=e.y-t.y;return Math.sqrt(o*o+n*n)}function se(e,t,o){void 0===o&&(o={});var n=null!=o.fineTolerance?o.fineTolerance:4,r=null!=o.grossTolerance?o.grossTolerance:12,i=null!=o.interval?o.interval:500;e.point=e.point||t.point,e.time=e.time||t.time;var a=ae(e.point,t.point);return a<n||a<r&&t.time-e.time<i}function le(e,t,o){void 0===o&&(o={});var n=null!=o.tolerance?o.tolerance:25,r=null!=o.interval?o.interval:250;return e.point=e.point||t.point,e.time=e.time||t.time,ae(e.point,t.point)<n&&t.time-e.time<r}function ce(e,t){return e(t={exports:{}},t.exports),t.exports}var ue=ce((function(e){var t=e.exports=function(e,o){if(o||(o=16),void 0===e&&(e=128),e<=0)return"0";for(var n=Math.log(Math.pow(2,e))/Math.log(o),r=2;n===1/0;r*=2)n=Math.log(Math.pow(2,e/r))/Math.log(o)*r;var i=n-Math.floor(n),a="";for(r=0;r<Math.floor(n);r++)a=Math.floor(Math.random()*o).toString(o)+a;if(i){var s=Math.pow(o,i);a=Math.floor(Math.random()*s).toString(o)+a}var l=parseInt(a,o);return l!==1/0&&l>=Math.pow(2,e)?t(e,o):a};t.rack=function(e,o,n){var r=function(r){var a=0;do{if(a++>10){if(!n)throw new Error("too many ID collisions, use more bits");e+=n}var s=t(e,o)}while(Object.hasOwnProperty.call(i,s));return i[s]=r,s},i=r.hats={};return r.get=function(e){return r.hats[e]},r.set=function(e,t){return r.hats[e]=t,r},r.bits=e||128,r.base=o||16,r}})),de=function(e,t){this.ctx=e,this.properties=t.properties||{},this.coordinates=t.geometry.coordinates,this.id=t.id||ue(),this.type=t.geometry.type};de.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},de.prototype.incomingCoords=function(e){this.setCoordinates(e)},de.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()},de.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},de.prototype.setProperty=function(e,t){this.properties[e]=t},de.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:k,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},de.prototype.internal=function(e){var t={id:this.id,meta:W,"meta:type":this.type,active:H,mode:e};if(this.ctx.options.userProperties)for(var o in this.properties)t["user_"+o]=this.properties[o];return{type:k,properties:t,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var pe=function(e,t){de.call(this,e,t)};(pe.prototype=Object.create(de.prototype)).isValid=function(){return"number"==typeof this.coordinates[0]&&"number"==typeof this.coordinates[1]},pe.prototype.updateCoordinate=function(e,t,o){this.coordinates=3===arguments.length?[t,o]:[e,t],this.changed()},pe.prototype.getCoordinate=function(){return this.getCoordinates()};var fe=function(e,t){de.call(this,e,t)};(fe.prototype=Object.create(de.prototype)).isValid=function(){return this.coordinates.length>1},fe.prototype.addCoordinate=function(e,t,o){this.changed();var n=parseInt(e,10);this.coordinates.splice(n,0,[t,o])},fe.prototype.getCoordinate=function(e){var t=parseInt(e,10);return JSON.parse(JSON.stringify(this.coordinates[t]))},fe.prototype.removeCoordinate=function(e){this.changed(),this.coordinates.splice(parseInt(e,10),1)},fe.prototype.updateCoordinate=function(e,t,o){var n=parseInt(e,10);this.coordinates[n]=[t,o],this.changed()};var he=function(e,t){de.call(this,e,t),this.coordinates=this.coordinates.map((function(e){return e.slice(0,-1)}))};(he.prototype=Object.create(de.prototype)).isValid=function(){return 0!==this.coordinates.length&&this.coordinates.every((function(e){return e.length>2}))},he.prototype.incomingCoords=function(e){this.coordinates=e.map((function(e){return e.slice(0,-1)})),this.changed()},he.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()},he.prototype.addCoordinate=function(e,t,o){this.changed();var n=e.split(".").map((function(e){return parseInt(e,10)}));this.coordinates[n[0]].splice(n[1],0,[t,o])},he.prototype.removeCoordinate=function(e){this.changed();var t=e.split(".").map((function(e){return parseInt(e,10)})),o=this.coordinates[t[0]];o&&(o.splice(t[1],1),o.length<3&&this.coordinates.splice(t[0],1))},he.prototype.getCoordinate=function(e){var t=e.split(".").map((function(e){return parseInt(e,10)})),o=this.coordinates[t[0]];return JSON.parse(JSON.stringify(o[t[1]]))},he.prototype.getCoordinates=function(){return this.coordinates.map((function(e){return e.concat([e[0]])}))},he.prototype.updateCoordinate=function(e,t,o){this.changed();var n=e.split("."),r=parseInt(n[0],10),i=parseInt(n[1],10);void 0===this.coordinates[r]&&(this.coordinates[r]=[]),this.coordinates[r][i]=[t,o]};var me={MultiPoint:pe,MultiLineString:fe,MultiPolygon:he},ge=function(e,t,o,n,r){var i=o.split("."),a=parseInt(i[0],10),s=i[1]?i.slice(1).join("."):null;return e[a][t](s,n,r)},ye=function(e,t){if(de.call(this,e,t),delete this.coordinates,this.model=me[t.geometry.type],void 0===this.model)throw new TypeError(t.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(t.geometry.coordinates)};function ve(e){this.map=e.map,this.drawConfig=JSON.parse(JSON.stringify(e.options||{})),this._ctx=e}(ye.prototype=Object.create(de.prototype))._coordinatesToFeatures=function(e){var t=this,o=this.model.bind(this);return e.map((function(e){return new o(t.ctx,{id:ue(),type:k,properties:{},geometry:{coordinates:e,type:t.type.replace("Multi","")}})}))},ye.prototype.isValid=function(){return this.features.every((function(e){return e.isValid()}))},ye.prototype.setCoordinates=function(e){this.features=this._coordinatesToFeatures(e),this.changed()},ye.prototype.getCoordinate=function(e){return ge(this.features,"getCoordinate",e)},ye.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map((function(e){return e.type===E?e.getCoordinates():e.coordinates}))))},ye.prototype.updateCoordinate=function(e,t,o){ge(this.features,"updateCoordinate",e,t,o),this.changed()},ye.prototype.addCoordinate=function(e,t,o){ge(this.features,"addCoordinate",e,t,o),this.changed()},ye.prototype.removeCoordinate=function(e){ge(this.features,"removeCoordinate",e),this.changed()},ye.prototype.getFeatures=function(){return this.features},ve.prototype.setSelected=function(e){return this._ctx.store.setSelected(e)},ve.prototype.setSelectedCoordinates=function(e){var t=this;this._ctx.store.setSelectedCoordinates(e),e.reduce((function(e,o){return void 0===e[o.feature_id]&&(e[o.feature_id]=!0,t._ctx.store.get(o.feature_id).changed()),e}),{})},ve.prototype.getSelected=function(){return this._ctx.store.getSelected()},ve.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},ve.prototype.isSelected=function(e){return this._ctx.store.isSelected(e)},ve.prototype.getFeature=function(e){return this._ctx.store.get(e)},ve.prototype.select=function(e){return this._ctx.store.select(e)},ve.prototype.deselect=function(e){return this._ctx.store.deselect(e)},ve.prototype.deleteFeature=function(e,t){return void 0===t&&(t={}),this._ctx.store.delete(e,t)},ve.prototype.addFeature=function(e){return this._ctx.store.add(e)},ve.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},ve.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},ve.prototype.setActionableState=function(e){void 0===e&&(e={});var t={trash:e.trash||!1,combineFeatures:e.combineFeatures||!1,uncombineFeatures:e.uncombineFeatures||!1};return this._ctx.events.actionable(t)},ve.prototype.changeMode=function(e,t,o){return void 0===t&&(t={}),void 0===o&&(o={}),this._ctx.events.changeMode(e,t,o)},ve.prototype.updateUIClasses=function(e){return this._ctx.ui.queueMapClasses(e)},ve.prototype.activateUIButton=function(e){return this._ctx.ui.setActiveButton(e)},ve.prototype.featuresAt=function(e,t,o){if(void 0===o&&(o="click"),"click"!==o&&"touch"!==o)throw new Error("invalid buffer type");return ne[o](e,t,this._ctx)},ve.prototype.newFeature=function(e){var t=e.geometry.type;return t===I?new pe(this._ctx,e):t===P?new fe(this._ctx,e):t===E?new he(this._ctx,e):new ye(this._ctx,e)},ve.prototype.isInstanceOf=function(e,t){if(e===I)return t instanceof pe;if(e===P)return t instanceof fe;if(e===E)return t instanceof he;if("MultiFeature"===e)return t instanceof ye;throw new Error("Unknown feature class: "+e)},ve.prototype.doRender=function(e){return this._ctx.store.featureChanged(e)},ve.prototype.onSetup=function(){},ve.prototype.onDrag=function(){},ve.prototype.onClick=function(){},ve.prototype.onMouseMove=function(){},ve.prototype.onMouseDown=function(){},ve.prototype.onMouseUp=function(){},ve.prototype.onMouseOut=function(){},ve.prototype.onKeyUp=function(){},ve.prototype.onKeyDown=function(){},ve.prototype.onTouchStart=function(){},ve.prototype.onTouchMove=function(){},ve.prototype.onTouchEnd=function(){},ve.prototype.onTap=function(){},ve.prototype.onStop=function(){},ve.prototype.onTrash=function(){},ve.prototype.onCombineFeature=function(){},ve.prototype.onUncombineFeature=function(){},ve.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var be={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},_e=Object.keys(be);function Ce(e){var t=Object.keys(e);return function(o,n){void 0===n&&(n={});var r={},i=t.reduce((function(t,o){return t[o]=e[o],t}),new ve(o));return{start:function(){var t=this;r=i.onSetup(n),_e.forEach((function(o){var n,a=be[o],s=function(){return!1};e[a]&&(s=function(){return!0}),t.on(o,s,(n=a,function(e){return i[n](r,e)}))}))},stop:function(){i.onStop(r)},trash:function(){i.onTrash(r)},combineFeatures:function(){i.onCombineFeatures(r)},uncombineFeatures:function(){i.onUncombineFeatures(r)},render:function(e,t){i.toDisplayFeatures(r,e,t)}}}}function xe(e){return[].concat(e).filter((function(e){return void 0!==e}))}function Se(){var e=this;if(!e.ctx.map||void 0===e.ctx.map.getSource(v))return l();var t=e.ctx.events.currentModeName();e.ctx.ui.queueMapClasses({mode:t});var o=[],n=[];e.isDirty?n=e.getAllIds():(o=e.getChangedIds().filter((function(t){return void 0!==e.get(t)})),n=e.sources.hot.filter((function(t){return t.properties.id&&-1===o.indexOf(t.properties.id)&&void 0!==e.get(t.properties.id)})).map((function(e){return e.properties.id}))),e.sources.hot=[];var r=e.sources.cold.length;e.sources.cold=e.isDirty?[]:e.sources.cold.filter((function(e){var t=e.properties.id||e.properties.parent;return-1===o.indexOf(t)}));var i=r!==e.sources.cold.length||n.length>0;function a(o,n){var r=e.get(o).internal(t);e.ctx.events.currentModeRender(r,(function(t){e.sources[n].push(t)}))}if(o.forEach((function(e){return a(e,"hot")})),n.forEach((function(e){return a(e,"cold")})),i&&e.ctx.map.getSource(b).setData({type:L,features:e.sources.cold}),e.ctx.map.getSource(v).setData({type:L,features:e.sources.hot}),e._emitSelectionChange&&(e.ctx.map.fire(U,{features:e.getSelected().map((function(e){return e.toGeoJSON()})),points:e.getSelectedCoordinates().map((function(e){return{type:k,properties:{},geometry:{type:I,coordinates:e.coordinates}}}))}),e._emitSelectionChange=!1),e._deletedFeaturesToEmit.length){var s=e._deletedFeaturesToEmit.map((function(e){return e.toGeoJSON()}));e._deletedFeaturesToEmit=[],e.ctx.map.fire(j,{features:s})}function l(){e.isDirty=!1,e.clearChangedIds()}l(),e.ctx.map.fire(z,{})}function we(e){var t,o=this;this._features={},this._featureIds=new te,this._selectedFeatureIds=new te,this._selectedCoordinates=[],this._changedFeatureIds=new te,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=e,this.sources={hot:[],cold:[]},this.render=function(){t||(t=requestAnimationFrame((function(){t=null,Se.call(o)})))},this.isDirty=!1}function Me(e,t){var o=e._selectedCoordinates.filter((function(t){return e._selectedFeatureIds.has(t.feature_id)}));e._selectedCoordinates.length===o.length||t.silent||(e._emitSelectionChange=!0),e._selectedCoordinates=o}we.prototype.createRenderBatch=function(){var e=this,t=this.render,o=0;return this.render=function(){o++},function(){e.render=t,o>0&&e.render()}},we.prototype.setDirty=function(){return this.isDirty=!0,this},we.prototype.featureChanged=function(e){return this._changedFeatureIds.add(e),this},we.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},we.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},we.prototype.getAllIds=function(){return this._featureIds.values()},we.prototype.add=function(e){return this.featureChanged(e.id),this._features[e.id]=e,this._featureIds.add(e.id),this},we.prototype.delete=function(e,t){var o=this;return void 0===t&&(t={}),xe(e).forEach((function(e){o._featureIds.has(e)&&(o._featureIds.delete(e),o._selectedFeatureIds.delete(e),t.silent||-1===o._deletedFeaturesToEmit.indexOf(o._features[e])&&o._deletedFeaturesToEmit.push(o._features[e]),delete o._features[e],o.isDirty=!0)})),Me(this,t),this},we.prototype.get=function(e){return this._features[e]},we.prototype.getAll=function(){var e=this;return Object.keys(this._features).map((function(t){return e._features[t]}))},we.prototype.select=function(e,t){var o=this;return void 0===t&&(t={}),xe(e).forEach((function(e){o._selectedFeatureIds.has(e)||(o._selectedFeatureIds.add(e),o._changedFeatureIds.add(e),t.silent||(o._emitSelectionChange=!0))})),this},we.prototype.deselect=function(e,t){var o=this;return void 0===t&&(t={}),xe(e).forEach((function(e){o._selectedFeatureIds.has(e)&&(o._selectedFeatureIds.delete(e),o._changedFeatureIds.add(e),t.silent||(o._emitSelectionChange=!0))})),Me(this,t),this},we.prototype.clearSelected=function(e){return void 0===e&&(e={}),this.deselect(this._selectedFeatureIds.values(),{silent:e.silent}),this},we.prototype.setSelected=function(e,t){var o=this;return void 0===t&&(t={}),e=xe(e),this.deselect(this._selectedFeatureIds.values().filter((function(t){return-1===e.indexOf(t)})),{silent:t.silent}),this.select(e.filter((function(e){return!o._selectedFeatureIds.has(e)})),{silent:t.silent}),this},we.prototype.setSelectedCoordinates=function(e){return this._selectedCoordinates=e,this._emitSelectionChange=!0,this},we.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},we.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},we.prototype.getSelected=function(){var e=this;return this._selectedFeatureIds.values().map((function(t){return e.get(t)}))},we.prototype.getSelectedCoordinates=function(){var e=this;return this._selectedCoordinates.map((function(t){return{coordinates:e.get(t.feature_id).getCoordinate(t.coord_path)}}))},we.prototype.isSelected=function(e){return this._selectedFeatureIds.has(e)},we.prototype.setFeatureProperty=function(e,t,o){this.get(e).setProperty(t,o),this.featureChanged(e)},we.prototype.storeMapConfig=function(){var e=this;Q.forEach((function(t){e.ctx.map[t]&&(e._mapInitialConfig[t]=e.ctx.map[t].isEnabled())}))},we.prototype.restoreMapConfig=function(){var e=this;Object.keys(this._mapInitialConfig).forEach((function(t){e._mapInitialConfig[t]?e.ctx.map[t].enable():e.ctx.map[t].disable()}))},we.prototype.getInitialConfigValue=function(e){return void 0===this._mapInitialConfig[e]||this._mapInitialConfig[e]};var ke=function(){for(var e=arguments,t={},o=0;o<arguments.length;o++){var n=e[o];for(var r in n)Ee.call(n,r)&&(t[r]=n[r])}return t},Ee=Object.prototype.hasOwnProperty,Pe=["mode","feature","mouse"];function Ie(t){var o=null,n=null,r={onRemove:function(){return t.map.off("load",r.connect),clearInterval(n),r.removeLayers(),t.store.restoreMapConfig(),t.ui.removeButtons(),t.events.removeEventListeners(),t.ui.clearMapClasses(),t.map=null,t.container=null,t.store=null,o&&o.parentNode&&o.parentNode.removeChild(o),o=null,this},connect:function(){t.map.off("load",r.connect),clearInterval(n),r.addLayers(),t.store.storeMapConfig(),t.events.addEventListeners()},onAdd:function(i){var a=i.fire;return i.fire=function(e,t){var o=arguments;return 1===a.length&&1!==arguments.length&&(o=[ke({},{type:e},t)]),a.apply(i,o)},t.map=i,t.events=function(t){var o=Object.keys(t.options.modes).reduce((function(e,o){return e[o]=Ce(t.options.modes[o]),e}),{}),n={},r={},i={},a=null,s=null;i.drag=function(e,o){o({point:e.point,time:(new Date).getTime()})?(t.ui.queueMapClasses({mouse:x}),s.drag(e)):e.originalEvent.stopPropagation()},i.mousedrag=function(e){i.drag(e,(function(e){return!se(n,e)}))},i.touchdrag=function(e){i.drag(e,(function(e){return!le(r,e)}))},i.mousemove=function(e){if(1===(void 0!==e.originalEvent.buttons?e.originalEvent.buttons:e.originalEvent.which))return i.mousedrag(e);var o=ie(e,t);e.featureTarget=o,s.mousemove(e)},i.mousedown=function(e){n={time:(new Date).getTime(),point:e.point};var o=ie(e,t);e.featureTarget=o,s.mousedown(e)},i.mouseup=function(e){var o=ie(e,t);e.featureTarget=o,se(n,{point:e.point,time:(new Date).getTime()})?s.click(e):s.mouseup(e)},i.mouseout=function(e){s.mouseout(e)},i.touchstart=function(e){if(e.originalEvent.preventDefault(),t.options.touchEnabled){r={time:(new Date).getTime(),point:e.point};var o=ne.touch(e,null,t)[0];e.featureTarget=o,s.touchstart(e)}},i.touchmove=function(e){if(e.originalEvent.preventDefault(),t.options.touchEnabled)return s.touchmove(e),i.touchdrag(e)},i.touchend=function(e){if(e.originalEvent.preventDefault(),t.options.touchEnabled){var o=ne.touch(e,null,t)[0];e.featureTarget=o,le(r,{time:(new Date).getTime(),point:e.point})?s.tap(e):s.touchend(e)}};var l=function(e){return!(8===e||46===e||e>=48&&e<=57)};function c(n,r,i){void 0===i&&(i={}),s.stop();var l=o[n];if(void 0===l)throw new Error(n+" is not valid");a=n;var c=l(t,r);s=e(c,t),i.silent||t.map.fire(R,{mode:n}),t.store.setDirty(),t.store.render()}i.keydown=function(e){"mapboxgl-canvas"===(e.srcElement||e.target).classList[0]&&(8!==e.keyCode&&46!==e.keyCode||!t.options.controls.trash?l(e.keyCode)?s.keydown(e):49===e.keyCode&&t.options.controls.point?c(O.DRAW_POINT):50===e.keyCode&&t.options.controls.line_string?c(O.DRAW_LINE_STRING):51===e.keyCode&&t.options.controls.polygon&&c(O.DRAW_POLYGON):(e.preventDefault(),s.trash()))},i.keyup=function(e){l(e.keyCode)&&s.keyup(e)},i.zoomend=function(){t.store.changeZoom()},i.data=function(e){if("style"===e.dataType){var o=t.setup,n=t.map,r=t.options,i=t.store;r.styles.some((function(e){return n.getLayer(e.id)}))||(o.addLayers(),i.setDirty(),i.render())}};var u={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){a=t.options.defaultMode,s=e(o[a](t),t)},changeMode:c,actionable:function(e){var o=!1;Object.keys(e).forEach((function(t){if(void 0===u[t])throw new Error("Invalid action type");u[t]!==e[t]&&(o=!0),u[t]=e[t]})),o&&t.map.fire(B,{actions:u})},currentModeName:function(){return a},currentModeRender:function(e,t){return s.render(e,t)},fire:function(e,t){i[e]&&i[e](t)},addEventListeners:function(){t.map.on("mousemove",i.mousemove),t.map.on("mousedown",i.mousedown),t.map.on("mouseup",i.mouseup),t.map.on("data",i.data),t.map.on("touchmove",i.touchmove),t.map.on("touchstart",i.touchstart),t.map.on("touchend",i.touchend),t.container.addEventListener("mouseout",i.mouseout),t.options.keybindings&&(t.container.addEventListener("keydown",i.keydown),t.container.addEventListener("keyup",i.keyup))},removeEventListeners:function(){t.map.off("mousemove",i.mousemove),t.map.off("mousedown",i.mousedown),t.map.off("mouseup",i.mouseup),t.map.off("data",i.data),t.map.off("touchmove",i.touchmove),t.map.off("touchstart",i.touchstart),t.map.off("touchend",i.touchend),t.container.removeEventListener("mouseout",i.mouseout),t.options.keybindings&&(t.container.removeEventListener("keydown",i.keydown),t.container.removeEventListener("keyup",i.keyup))},trash:function(e){s.trash(e)},combineFeatures:function(){s.combineFeatures()},uncombineFeatures:function(){s.uncombineFeatures()},getMode:function(){return a}}}(t),t.ui=function(e){var t={},o=null,n={mode:null,feature:null,mouse:null},r={mode:null,feature:null,mouse:null};function i(e){r=ke(r,e)}function a(){var t,o;if(e.container){var i=[],a=[];Pe.forEach((function(e){r[e]!==n[e]&&(i.push(e+"-"+n[e]),null!==r[e]&&a.push(e+"-"+r[e]))})),i.length>0&&(t=e.container.classList).remove.apply(t,i),a.length>0&&(o=e.container.classList).add.apply(o,a),n=ke(n,r)}}function y(e,t){void 0===t&&(t={});var n=document.createElement("button");return n.className=l+" "+t.className,n.setAttribute("title",t.title),t.container.appendChild(n),n.addEventListener("click",(function(n){if(n.preventDefault(),n.stopPropagation(),n.target===o)return v(),void t.onDeactivate();b(e),t.onActivate()}),!0),n}function v(){o&&(o.classList.remove(g),o=null)}function b(e){v();var n=t[e];n&&n&&"trash"!==e&&(n.classList.add(g),o=n)}return{setActiveButton:b,queueMapClasses:i,updateMapClasses:a,clearMapClasses:function(){i({mode:null,feature:null,mouse:null}),a()},addButtons:function(){var o=e.options.controls,n=document.createElement("div");return n.className=m+" "+s,o?(o[M.LINE]&&(t[M.LINE]=y(M.LINE,{container:n,className:c,title:"LineString tool "+(e.options.keybindings?"(l)":""),onActivate:function(){return e.events.changeMode(O.DRAW_LINE_STRING)},onDeactivate:function(){return e.events.trash()}})),o[M.POLYGON]&&(t[M.POLYGON]=y(M.POLYGON,{container:n,className:u,title:"Polygon tool "+(e.options.keybindings?"(p)":""),onActivate:function(){return e.events.changeMode(O.DRAW_POLYGON)},onDeactivate:function(){return e.events.trash()}})),o[M.POINT]&&(t[M.POINT]=y(M.POINT,{container:n,className:d,title:"Marker tool "+(e.options.keybindings?"(m)":""),onActivate:function(){return e.events.changeMode(O.DRAW_POINT)},onDeactivate:function(){return e.events.trash()}})),o.trash&&(t.trash=y("trash",{container:n,className:p,title:"Delete",onActivate:function(){e.events.trash()}})),o.combine_features&&(t.combine_features=y("combineFeatures",{container:n,className:f,title:"Combine",onActivate:function(){e.events.combineFeatures()}})),o.uncombine_features&&(t.uncombine_features=y("uncombineFeatures",{container:n,className:h,title:"Uncombine",onActivate:function(){e.events.uncombineFeatures()}})),n):n},removeButtons:function(){Object.keys(t).forEach((function(e){var o=t[e];o.parentNode&&o.parentNode.removeChild(o),delete t[e]}))}}}(t),t.container=i.getContainer(),t.store=new we(t),o=t.ui.addButtons(),t.options.boxSelect&&(i.boxZoom.disable(),i.dragPan.disable(),i.dragPan.enable()),i.loaded()?r.connect():(i.on("load",r.connect),n=setInterval((function(){i.loaded()&&r.connect()}),16)),t.events.start(),o},addLayers:function(){t.map.addSource(b,{data:{type:L,features:[]},type:"geojson"}),t.map.addSource(v,{data:{type:L,features:[]},type:"geojson"}),t.options.styles.forEach((function(e){t.map.addLayer(e)})),t.store.setDirty(!0),t.store.render()},removeLayers:function(){t.options.styles.forEach((function(e){t.map.getLayer(e.id)&&t.map.removeLayer(e.id)})),t.map.getSource(b)&&t.map.removeSource(b),t.map.getSource(v)&&t.map.removeSource(v)}};return t.setup=r,r}function Le(e){return function(t){var o=t.featureTarget;return!!o&&!!o.properties&&o.properties.meta===e}}function Fe(e){return!!e.featureTarget&&!!e.featureTarget.properties&&e.featureTarget.properties.active===K&&e.featureTarget.properties.meta===W}function Te(e){return!!e.featureTarget&&!!e.featureTarget.properties&&e.featureTarget.properties.active===H&&e.featureTarget.properties.meta===W}function Ne(e){return void 0===e.featureTarget}function Ae(e){var t=e.featureTarget;return!!t&&!!t.properties&&t.properties.meta===Y}function Oe(e){return!!e.originalEvent&&!0===e.originalEvent.shiftKey}function De(e){return 27===e.keyCode}function je(e){return 13===e.keyCode}var $e=Ue;function Ue(e,t){this.x=e,this.y=t}function Re(e,t){var o=t.getBoundingClientRect();return new $e(e.clientX-o.left-(t.clientLeft||0),e.clientY-o.top-(t.clientTop||0))}function Be(e,t,o,n){return{type:k,properties:{meta:Y,parent:e,coord_path:o,active:n?K:H},geometry:{type:I,coordinates:t}}}function ze(e,t,o){void 0===t&&(t={}),void 0===o&&(o=null);var n,r=e.geometry,i=r.type,a=r.coordinates,s=e.properties&&e.properties.id,l=[];function c(e,o){var n="",r=null;e.forEach((function(e,i){var a=null!=o?o+"."+i:String(i),c=Be(s,e,a,u(a));if(t.midpoints&&r){var d=function(e,t,o){var n=t.geometry.coordinates,r=o.geometry.coordinates;if(n[1]>85||n[1]<-85||r[1]>85||r[1]<-85)return null;var i={lng:(n[0]+r[0])/2,lat:(n[1]+r[1])/2};return{type:k,properties:{meta:Z,parent:e,lng:i.lng,lat:i.lat,coord_path:o.properties.coord_path},geometry:{type:I,coordinates:[i.lng,i.lat]}}}(s,r,c);d&&l.push(d)}r=c;var p=JSON.stringify(e);n!==p&&l.push(c),0===i&&(n=p)}))}function u(e){return!!t.selectedPaths&&-1!==t.selectedPaths.indexOf(e)}return i===I?l.push(Be(s,a,o,u(o))):i===E?a.forEach((function(e,t){c(e,null!==o?o+"."+t:String(t))})):i===P?c(a,o):0===i.indexOf(F)&&(n=i.replace(F,""),a.forEach((function(o,r){var i={type:k,properties:e.properties,geometry:{type:n,coordinates:o}};l=l.concat(ze(i,t,r))}))),l}Ue.prototype={clone:function(){return new Ue(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,o=e.y-this.y;return t*t+o*o},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[0]*this.x+e[1]*this.y,o=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=o,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),o=Math.sin(e),n=t*this.x-o*this.y,r=o*this.x+t*this.y;return this.x=n,this.y=r,this},_rotateAround:function(e,t){var o=Math.cos(e),n=Math.sin(e),r=t.x+o*(this.x-t.x)-n*(this.y-t.y),i=t.y+n*(this.x-t.x)+o*(this.y-t.y);return this.x=r,this.y=i,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ue.convert=function(e){return e instanceof Ue?e:Array.isArray(e)?new Ue(e[0],e[1]):e};var Ve=function(e){setTimeout((function(){e.map&&e.map.doubleClickZoom&&e._ctx&&e._ctx.store&&e._ctx.store.getInitialConfigValue&&e._ctx.store.getInitialConfigValue("doubleClickZoom")&&e.map.doubleClickZoom.enable()}),0)},Ge=function(e){setTimeout((function(){e.map&&e.map.doubleClickZoom&&e.map.doubleClickZoom.disable()}),0)},Je=function(e){if(!e||!e.type)return null;var t=qe[e.type];return t?"geometry"===t?{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:e}]}:"feature"===t?{type:"FeatureCollection",features:[e]}:"featurecollection"===t?e:void 0:null},qe={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"};function We(e){switch(e&&e.type||null){case"FeatureCollection":return e.features=e.features.reduce((function(e,t){return e.concat(We(t))}),[]),e;case"Feature":return e.geometry?We(e.geometry).map((function(t){var o={type:"Feature",properties:JSON.parse(JSON.stringify(e.properties)),geometry:t};return void 0!==e.id&&(o.id=e.id),o})):[e];case"MultiPoint":return e.coordinates.map((function(e){return{type:"Point",coordinates:e}}));case"MultiPolygon":return e.coordinates.map((function(e){return{type:"Polygon",coordinates:e}}));case"MultiLineString":return e.coordinates.map((function(e){return{type:"LineString",coordinates:e}}));case"GeometryCollection":return e.geometries.map(We).reduce((function(e,t){return e.concat(t)}),[]);case"Point":case"Polygon":case"LineString":return[e]}}var Ze=function(e){if(!e)return[];var t=We(Je(e)),o=[];return t.features.forEach((function(e){e.geometry&&(o=o.concat(function e(t){return Array.isArray(t)&&t.length&&"number"==typeof t[0]?[t]:t.reduce((function(t,o){return Array.isArray(o)&&Array.isArray(o[0])?t.concat(e(o)):(t.push(o),t)}),[])}(e.geometry.coordinates)))})),o},Ye=ce((function(e){var t=e.exports=function(e){return new o(e)};function o(e){this.value=e}function n(e,t,o){var n=[],a=[],u=!0;return function e(d){var p=o?r(d):d,f={},h=!0,m={node:p,node_:d,path:[].concat(n),parent:a[a.length-1],parents:a,key:n.slice(-1)[0],isRoot:0===n.length,level:n.length,circular:null,update:function(e,t){m.isRoot||(m.parent.node[m.key]=e),m.node=e,t&&(h=!1)},delete:function(e){delete m.parent.node[m.key],e&&(h=!1)},remove:function(e){s(m.parent.node)?m.parent.node.splice(m.key,1):delete m.parent.node[m.key],e&&(h=!1)},keys:null,before:function(e){f.before=e},after:function(e){f.after=e},pre:function(e){f.pre=e},post:function(e){f.post=e},stop:function(){u=!1},block:function(){h=!1}};if(!u)return m;function g(){if("object"==typeof m.node&&null!==m.node){m.keys&&m.node_===m.node||(m.keys=i(m.node)),m.isLeaf=0==m.keys.length;for(var e=0;e<a.length;e++)if(a[e].node_===d){m.circular=a[e];break}}else m.isLeaf=!0,m.keys=null;m.notLeaf=!m.isLeaf,m.notRoot=!m.isRoot}g();var y=t.call(m,m.node);return void 0!==y&&m.update&&m.update(y),f.before&&f.before.call(m,m.node),h?("object"!=typeof m.node||null===m.node||m.circular||(a.push(m),g(),l(m.keys,(function(t,r){n.push(t),f.pre&&f.pre.call(m,m.node[t],t);var i=e(m.node[t]);o&&c.call(m.node,t)&&(m.node[t]=i.node),i.isLast=r==m.keys.length-1,i.isFirst=0==r,f.post&&f.post.call(m,i),n.pop()})),a.pop()),f.after&&f.after.call(m,m.node),m):m}(e).node}function r(e){if("object"==typeof e&&null!==e){var t;if(s(e))t=[];else if("[object Date]"===a(e))t=new Date(e.getTime?e.getTime():e);else if(function(e){return"[object RegExp]"===a(e)}(e))t=new RegExp(e);else if(function(e){return"[object Error]"===a(e)}(e))t={message:e.message};else if(function(e){return"[object Boolean]"===a(e)}(e))t=new Boolean(e);else if(function(e){return"[object Number]"===a(e)}(e))t=new Number(e);else if(function(e){return"[object String]"===a(e)}(e))t=new String(e);else if(Object.create&&Object.getPrototypeOf)t=Object.create(Object.getPrototypeOf(e));else if(e.constructor===Object)t={};else{var o=e.constructor&&e.constructor.prototype||e.__proto__||{},n=function(){};n.prototype=o,t=new n}return l(i(e),(function(o){t[o]=e[o]})),t}return e}o.prototype.get=function(e){for(var t=this.value,o=0;o<e.length;o++){var n=e[o];if(!t||!c.call(t,n)){t=void 0;break}t=t[n]}return t},o.prototype.has=function(e){for(var t=this.value,o=0;o<e.length;o++){var n=e[o];if(!t||!c.call(t,n))return!1;t=t[n]}return!0},o.prototype.set=function(e,t){for(var o=this.value,n=0;n<e.length-1;n++){var r=e[n];c.call(o,r)||(o[r]={}),o=o[r]}return o[e[n]]=t,t},o.prototype.map=function(e){return n(this.value,e,!0)},o.prototype.forEach=function(e){return this.value=n(this.value,e,!1),this.value},o.prototype.reduce=function(e,t){var o=1===arguments.length,n=o?this.value:t;return this.forEach((function(t){this.isRoot&&o||(n=e.call(this,n,t))})),n},o.prototype.paths=function(){var e=[];return this.forEach((function(t){e.push(this.path)})),e},o.prototype.nodes=function(){var e=[];return this.forEach((function(t){e.push(this.node)})),e},o.prototype.clone=function(){var e=[],t=[];return function o(n){for(var a=0;a<e.length;a++)if(e[a]===n)return t[a];if("object"==typeof n&&null!==n){var s=r(n);return e.push(n),t.push(s),l(i(n),(function(e){s[e]=o(n[e])})),e.pop(),t.pop(),s}return n}(this.value)};var i=Object.keys||function(e){var t=[];for(var o in e)t.push(o);return t};function a(e){return Object.prototype.toString.call(e)}var s=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},l=function(e,t){if(e.forEach)return e.forEach(t);for(var o=0;o<e.length;o++)t(e[o],o,e)};l(i(o.prototype),(function(e){t[e]=function(t){var n=[].slice.call(arguments,1),r=new o(t);return r[e].apply(r,n)}}));var c=Object.hasOwnProperty||function(e,t){return t in e}})),Ke=He;function He(e){if(!(this instanceof He))return new He(e);this._bbox=e||[1/0,1/0,-1/0,-1/0],this._valid=!!e}He.prototype.include=function(e){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],e[0]),this._bbox[1]=Math.min(this._bbox[1],e[1]),this._bbox[2]=Math.max(this._bbox[2],e[0]),this._bbox[3]=Math.max(this._bbox[3],e[1]),this},He.prototype.equals=function(e){var t;return t=e instanceof He?e.bbox():e,this._bbox[0]==t[0]&&this._bbox[1]==t[1]&&this._bbox[2]==t[2]&&this._bbox[3]==t[3]},He.prototype.center=function(e){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},He.prototype.union=function(e){var t;return this._valid=!0,t=e instanceof He?e.bbox():e,this._bbox[0]=Math.min(this._bbox[0],t[0]),this._bbox[1]=Math.min(this._bbox[1],t[1]),this._bbox[2]=Math.max(this._bbox[2],t[2]),this._bbox[3]=Math.max(this._bbox[3],t[3]),this},He.prototype.bbox=function(){return this._valid?this._bbox:null},He.prototype.contains=function(e){if(!e)return this._fastContains();if(!this._valid)return null;var t=e[0],o=e[1];return this._bbox[0]<=t&&this._bbox[1]<=o&&this._bbox[2]>=t&&this._bbox[3]>=o},He.prototype.intersect=function(e){return this._valid?(t=e instanceof He?e.bbox():e,!(this._bbox[0]>t[2]||this._bbox[2]<t[0]||this._bbox[3]<t[1]||this._bbox[1]>t[3])):null;var t},He.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var e="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",e)},He.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var Qe={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},Xe=Object.keys(Qe),et=function(e){return tt(e).bbox()};function tt(e){for(var t=Ke(),o=Ze(e),n=0;n<o.length;n++)t.include(o[n]);return t}function ot(e,t){var o=-90,n=90,r=-90,i=90,a=270,s=-270;e.forEach((function(e){var t=et(e),l=t[1],c=t[3],u=t[0],d=t[2];l>o&&(o=l),c<n&&(n=c),c>r&&(r=c),l<i&&(i=l),u<a&&(a=u),d>s&&(s=d)}));var l=t;return o+l.lat>85&&(l.lat=85-o),r+l.lat>90&&(l.lat=90-r),n+l.lat<-85&&(l.lat=-85-n),i+l.lat<-90&&(l.lat=-90-i),a+l.lng<=-270&&(l.lng+=360*Math.ceil(Math.abs(l.lng)/360)),s+l.lng>=270&&(l.lng-=360*Math.ceil(Math.abs(l.lng)/360)),l}function nt(e,t){var o=ot(e.map((function(e){return e.toGeoJSON()})),t);e.forEach((function(e){var t,n=e.getCoordinates(),r=function(e){var t={lng:e[0]+o.lng,lat:e[1]+o.lat};return[t.lng,t.lat]},i=function(e){return e.map((function(e){return r(e)}))};e.type===I?t=r(n):e.type===P||e.type===T?t=n.map(r):e.type===E||e.type===N?t=n.map(i):e.type===A&&(t=n.map((function(e){return e.map((function(e){return i(e)}))}))),e.incomingCoords(t)}))}et.polygon=function(e){return tt(e).polygon()},et.bboxify=function(e){return Ye(e).map((function(e){e&&Xe.some((function(t){return!!e[t]&&-1!==Qe[t].indexOf(e.type)}))&&(e.bbox=tt(e).bbox(),this.update(e))}))};var rt={onSetup:function(e){var t=this,o={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:e.featureIds||[]};return this.setSelected(o.initiallySelectedFeatureIds.filter((function(e){return void 0!==t.getFeature(e)}))),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),o},fireUpdate:function(){this.map.fire($,{action:J,features:this.getSelected().map((function(e){return e.toGeoJSON()}))})},fireActionable:function(){var e=this,t=this.getSelected(),o=t.filter((function(t){return e.isInstanceOf("MultiFeature",t)})),n=!1;if(t.length>1){n=!0;var r=t[0].type.replace("Multi","");t.forEach((function(e){e.type.replace("Multi","")!==r&&(n=!1)}))}var i=o.length>0,a=t.length>0;this.setActionableState({combineFeatures:n,uncombineFeatures:i,trash:a})},getUniqueIds:function(e){return e.length?e.map((function(e){return e.properties.id})).filter((function(e){return void 0!==e})).reduce((function(e,t){return e.add(t),e}),new te).values():[]},stopExtendedInteractions:function(e){e.boxSelectElement&&(e.boxSelectElement.parentNode&&e.boxSelectElement.parentNode.removeChild(e.boxSelectElement),e.boxSelectElement=null),this.map.dragPan.enable(),e.boxSelecting=!1,e.canBoxSelect=!1,e.dragMoving=!1,e.canDragMove=!1},onStop:function(){Ve(this)},onMouseMove:function(e){return this.stopExtendedInteractions(e),!0},onMouseOut:function(e){return!e.dragMoving||this.fireUpdate()}};rt.onTap=rt.onClick=function(e,t){return Ne(t)?this.clickAnywhere(e,t):Le(Y)(t)?this.clickOnVertex(e,t):function(e){return!!e.featureTarget&&!!e.featureTarget.properties&&e.featureTarget.properties.meta===W}(t)?this.clickOnFeature(e,t):void 0},rt.clickAnywhere=function(e){var t=this,o=this.getSelectedIds();o.length&&(this.clearSelectedFeatures(),o.forEach((function(e){return t.doRender(e)}))),Ve(this),this.stopExtendedInteractions(e)},rt.clickOnVertex=function(e,t){this.changeMode(O.DIRECT_SELECT,{featureId:t.featureTarget.properties.parent,coordPath:t.featureTarget.properties.coord_path,startPos:t.lngLat}),this.updateUIClasses({mouse:C})},rt.startOnActiveFeature=function(e,t){this.stopExtendedInteractions(e),this.map.dragPan.disable(),this.doRender(t.featureTarget.properties.id),e.canDragMove=!0,e.dragMoveLocation=t.lngLat},rt.clickOnFeature=function(e,t){var o=this;Ge(this),this.stopExtendedInteractions(e);var n=Oe(t),r=this.getSelectedIds(),i=t.featureTarget.properties.id,a=this.isSelected(i);if(!n&&a&&this.getFeature(i).type!==I)return this.changeMode(O.DIRECT_SELECT,{featureId:i});a&&n?(this.deselect(i),this.updateUIClasses({mouse:S}),1===r.length&&Ve(this)):!a&&n?(this.select(i),this.updateUIClasses({mouse:C})):a||n||(r.forEach((function(e){return o.doRender(e)})),this.setSelected(i),this.updateUIClasses({mouse:C})),this.doRender(i)},rt.onMouseDown=function(e,t){return Fe(t)?this.startOnActiveFeature(e,t):this.drawConfig.boxSelect&&function(e){return!!e.originalEvent&&!!e.originalEvent.shiftKey&&0===e.originalEvent.button}(t)?this.startBoxSelect(e,t):void 0},rt.startBoxSelect=function(e,t){this.stopExtendedInteractions(e),this.map.dragPan.disable(),e.boxSelectStartLocation=Re(t.originalEvent,this.map.getContainer()),e.canBoxSelect=!0},rt.onTouchStart=function(e,t){if(Fe(t))return this.startOnActiveFeature(e,t)},rt.onDrag=function(e,t){return e.canDragMove?this.dragMove(e,t):this.drawConfig.boxSelect&&e.canBoxSelect?this.whileBoxSelect(e,t):void 0},rt.whileBoxSelect=function(e,t){e.boxSelecting=!0,this.updateUIClasses({mouse:_}),e.boxSelectElement||(e.boxSelectElement=document.createElement("div"),e.boxSelectElement.classList.add(y),this.map.getContainer().appendChild(e.boxSelectElement));var o=Re(t.originalEvent,this.map.getContainer()),n=Math.min(e.boxSelectStartLocation.x,o.x),r=Math.max(e.boxSelectStartLocation.x,o.x),i=Math.min(e.boxSelectStartLocation.y,o.y),a=Math.max(e.boxSelectStartLocation.y,o.y),s="translate("+n+"px, "+i+"px)";e.boxSelectElement.style.transform=s,e.boxSelectElement.style.WebkitTransform=s,e.boxSelectElement.style.width=r-n+"px",e.boxSelectElement.style.height=a-i+"px"},rt.dragMove=function(e,t){e.dragMoving=!0,t.originalEvent.stopPropagation();var o={lng:t.lngLat.lng-e.dragMoveLocation.lng,lat:t.lngLat.lat-e.dragMoveLocation.lat};nt(this.getSelected(),o),e.dragMoveLocation=t.lngLat},rt.onMouseUp=function(e,t){var o=this;if(e.dragMoving)this.fireUpdate();else if(e.boxSelecting){var n=[e.boxSelectStartLocation,Re(t.originalEvent,this.map.getContainer())],r=this.featuresAt(null,n,"click"),i=this.getUniqueIds(r).filter((function(e){return!o.isSelected(e)}));i.length&&(this.select(i),i.forEach((function(e){return o.doRender(e)})),this.updateUIClasses({mouse:C}))}this.stopExtendedInteractions(e)},rt.toDisplayFeatures=function(e,t,o){t.properties.active=this.isSelected(t.properties.id)?K:H,o(t),this.fireActionable(),t.properties.active===K&&t.geometry.type!==I&&ze(t).forEach(o)},rt.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},rt.onCombineFeatures=function(){var e=this.getSelected();if(!(0===e.length||e.length<2)){for(var t=[],o=[],n=e[0].type.replace("Multi",""),r=0;r<e.length;r++){var i=e[r];if(i.type.replace("Multi","")!==n)return;i.type.includes("Multi")?i.getCoordinates().forEach((function(e){t.push(e)})):t.push(i.getCoordinates()),o.push(i.toGeoJSON())}if(o.length>1){var a=this.newFeature({type:k,properties:o[0].properties,geometry:{type:"Multi"+n,coordinates:t}});this.addFeature(a),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([a.id]),this.map.fire(V,{createdFeatures:[a.toGeoJSON()],deletedFeatures:o})}this.fireActionable()}},rt.onUncombineFeatures=function(){var e=this,t=this.getSelected();if(0!==t.length){for(var o=[],n=[],r=function(r){var i=t[r];e.isInstanceOf("MultiFeature",i)&&(i.getFeatures().forEach((function(t){e.addFeature(t),t.properties=i.properties,o.push(t.toGeoJSON()),e.select([t.id])})),e.deleteFeature(i.id,{silent:!0}),n.push(i.toGeoJSON()))},i=0;i<t.length;i++)r(i);o.length>1&&this.map.fire(G,{createdFeatures:o,deletedFeatures:n}),this.fireActionable()}};var it=Le(Y),at=Le(Z),st={fireUpdate:function(){this.map.fire($,{action:q,features:this.getSelected().map((function(e){return e.toGeoJSON()}))})},fireActionable:function(e){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:e.selectedCoordPaths.length>0})},startDragging:function(e,t){this.map.dragPan.disable(),e.canDragMove=!0,e.dragMoveLocation=t.lngLat},stopDragging:function(e){this.map.dragPan.enable(),e.dragMoving=!1,e.canDragMove=!1,e.dragMoveLocation=null},onVertex:function(e,t){this.startDragging(e,t);var o=t.featureTarget.properties,n=e.selectedCoordPaths.indexOf(o.coord_path);Oe(t)||-1!==n?Oe(t)&&-1===n&&e.selectedCoordPaths.push(o.coord_path):e.selectedCoordPaths=[o.coord_path];var r=this.pathsToCoordinates(e.featureId,e.selectedCoordPaths);this.setSelectedCoordinates(r)},onMidpoint:function(e,t){this.startDragging(e,t);var o=t.featureTarget.properties;e.feature.addCoordinate(o.coord_path,o.lng,o.lat),this.fireUpdate(),e.selectedCoordPaths=[o.coord_path]},pathsToCoordinates:function(e,t){return t.map((function(t){return{feature_id:e,coord_path:t}}))},onFeature:function(e,t){0===e.selectedCoordPaths.length?this.startDragging(e,t):this.stopDragging(e)},dragFeature:function(e,t,o){nt(this.getSelected(),o),e.dragMoveLocation=t.lngLat},dragVertex:function(e,t,o){for(var n=e.selectedCoordPaths.map((function(t){return e.feature.getCoordinate(t)})),r=ot(n.map((function(e){return{type:k,properties:{},geometry:{type:I,coordinates:e}}})),o),i=0;i<n.length;i++){var a=n[i];e.feature.updateCoordinate(e.selectedCoordPaths[i],a[0]+r.lng,a[1]+r.lat)}},clickNoTarget:function(){this.changeMode(O.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(O.SIMPLE_SELECT)},clickActiveFeature:function(e){e.selectedCoordPaths=[],this.clearSelectedCoordinates(),e.feature.changed()},onSetup:function(e){var t=e.featureId,o=this.getFeature(t);if(!o)throw new Error("You must provide a featureId to enter direct_select mode");if(o.type===I)throw new TypeError("direct_select mode doesn't handle point features");var n={featureId:t,feature:o,dragMoveLocation:e.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:e.coordPath?[e.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(t,n.selectedCoordPaths)),this.setSelected(t),Ge(this),this.setActionableState({trash:!0}),n},onStop:function(){Ve(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(e,t,o){e.featureId===t.properties.id?(t.properties.active=K,o(t),ze(t,{map:this.map,midpoints:!0,selectedPaths:e.selectedCoordPaths}).forEach(o)):(t.properties.active=H,o(t)),this.fireActionable(e)},onTrash:function(e){e.selectedCoordPaths.sort((function(e,t){return t.localeCompare(e,"en",{numeric:!0})})).forEach((function(t){return e.feature.removeCoordinate(t)})),this.fireUpdate(),e.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(e),!1===e.feature.isValid()&&(this.deleteFeature([e.featureId]),this.changeMode(O.SIMPLE_SELECT,{}))},onMouseMove:function(e,t){var o=Fe(t),n=it(t),r=0===e.selectedCoordPaths.length;return o&&r||n&&!r?this.updateUIClasses({mouse:C}):this.updateUIClasses({mouse:w}),this.stopDragging(e),!0},onMouseOut:function(e){return e.dragMoving&&this.fireUpdate(),!0}};st.onTouchStart=st.onMouseDown=function(e,t){return it(t)?this.onVertex(e,t):Fe(t)?this.onFeature(e,t):at(t)?this.onMidpoint(e,t):void 0},st.onDrag=function(e,t){if(!0===e.canDragMove){e.dragMoving=!0,t.originalEvent.stopPropagation();var o={lng:t.lngLat.lng-e.dragMoveLocation.lng,lat:t.lngLat.lat-e.dragMoveLocation.lat};e.selectedCoordPaths.length>0?this.dragVertex(e,t,o):this.dragFeature(e,t,o),e.dragMoveLocation=t.lngLat}},st.onClick=function(e,t){return Ne(t)?this.clickNoTarget(e,t):Fe(t)?this.clickActiveFeature(e,t):Te(t)?this.clickInactive(e,t):void this.stopDragging(e)},st.onTap=function(e,t){return Ne(t)?this.clickNoTarget(e,t):Fe(t)?this.clickActiveFeature(e,t):Te(t)?this.clickInactive(e,t):void 0},st.onTouchEnd=st.onMouseUp=function(e){e.dragMoving&&this.fireUpdate(),this.stopDragging(e)};var lt={};function ct(e,t){return!!e.lngLat&&e.lngLat.lng===t[0]&&e.lngLat.lat===t[1]}lt.onSetup=function(){var e=this.newFeature({type:k,properties:{},geometry:{type:I,coordinates:[]}});return this.addFeature(e),this.clearSelectedFeatures(),this.updateUIClasses({mouse:_}),this.activateUIButton(M.POINT),this.setActionableState({trash:!0}),{point:e}},lt.stopDrawingAndRemove=function(e){this.deleteFeature([e.point.id],{silent:!0}),this.changeMode(O.SIMPLE_SELECT)},lt.onTap=lt.onClick=function(e,t){this.updateUIClasses({mouse:C}),e.point.updateCoordinate("",t.lngLat.lng,t.lngLat.lat),this.map.fire(D,{features:[e.point.toGeoJSON()]}),this.changeMode(O.SIMPLE_SELECT,{featureIds:[e.point.id]})},lt.onStop=function(e){this.activateUIButton(),e.point.getCoordinate().length||this.deleteFeature([e.point.id],{silent:!0})},lt.toDisplayFeatures=function(e,t,o){var n=t.properties.id===e.point.id;if(t.properties.active=n?K:H,!n)return o(t)},lt.onTrash=lt.stopDrawingAndRemove,lt.onKeyUp=function(e,t){if(De(t)||je(t))return this.stopDrawingAndRemove(e,t)};var ut={onSetup:function(){var e=this.newFeature({type:k,properties:{},geometry:{type:E,coordinates:[[]]}});return this.addFeature(e),this.clearSelectedFeatures(),Ge(this),this.updateUIClasses({mouse:_}),this.activateUIButton(M.POLYGON),this.setActionableState({trash:!0}),{polygon:e,currentVertexPosition:0}},clickAnywhere:function(e,t){if(e.currentVertexPosition>0&&ct(t,e.polygon.coordinates[0][e.currentVertexPosition-1]))return this.changeMode(O.SIMPLE_SELECT,{featureIds:[e.polygon.id]});this.updateUIClasses({mouse:_}),e.polygon.updateCoordinate("0."+e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),e.currentVertexPosition++,e.polygon.updateCoordinate("0."+e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat)},clickOnVertex:function(e){return this.changeMode(O.SIMPLE_SELECT,{featureIds:[e.polygon.id]})},onMouseMove:function(e,t){e.polygon.updateCoordinate("0."+e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),Ae(t)&&this.updateUIClasses({mouse:S})}};ut.onTap=ut.onClick=function(e,t){return Ae(t)?this.clickOnVertex(e,t):this.clickAnywhere(e,t)},ut.onKeyUp=function(e,t){De(t)?(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(O.SIMPLE_SELECT)):je(t)&&this.changeMode(O.SIMPLE_SELECT,{featureIds:[e.polygon.id]})},ut.onStop=function(e){this.updateUIClasses({mouse:w}),Ve(this),this.activateUIButton(),void 0!==this.getFeature(e.polygon.id)&&(e.polygon.removeCoordinate("0."+e.currentVertexPosition),e.polygon.isValid()?this.map.fire(D,{features:[e.polygon.toGeoJSON()]}):(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(O.SIMPLE_SELECT,{},{silent:!0})))},ut.toDisplayFeatures=function(e,t,o){var n=t.properties.id===e.polygon.id;if(t.properties.active=n?K:H,!n)return o(t);if(0!==t.geometry.coordinates.length){var r=t.geometry.coordinates[0].length;if(!(r<3)){if(t.properties.meta=W,o(Be(e.polygon.id,t.geometry.coordinates[0][0],"0.0",!1)),r>3){var i=t.geometry.coordinates[0].length-3;o(Be(e.polygon.id,t.geometry.coordinates[0][i],"0."+i,!1))}if(r<=4){var a=[[t.geometry.coordinates[0][0][0],t.geometry.coordinates[0][0][1]],[t.geometry.coordinates[0][1][0],t.geometry.coordinates[0][1][1]]];if(o({type:k,properties:t.properties,geometry:{coordinates:a,type:P}}),3===r)return}return o(t)}}},ut.onTrash=function(e){this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(O.SIMPLE_SELECT)};var dt={onSetup:function(e){var t,o,n=(e=e||{}).featureId,r="forward";if(n){if(!(t=this.getFeature(n)))throw new Error("Could not find a feature with the provided featureId");var i=e.from;if(i&&"Feature"===i.type&&i.geometry&&"Point"===i.geometry.type&&(i=i.geometry),i&&"Point"===i.type&&i.coordinates&&2===i.coordinates.length&&(i=i.coordinates),!i||!Array.isArray(i))throw new Error("Please use the `from` property to indicate which point to continue the line from");var a=t.coordinates.length-1;if(t.coordinates[a][0]===i[0]&&t.coordinates[a][1]===i[1])o=a+1,t.addCoordinate.apply(t,[o].concat(t.coordinates[a]));else{if(t.coordinates[0][0]!==i[0]||t.coordinates[0][1]!==i[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");r="backwards",o=0,t.addCoordinate.apply(t,[o].concat(t.coordinates[0]))}}else t=this.newFeature({type:k,properties:{},geometry:{type:P,coordinates:[]}}),o=0,this.addFeature(t);return this.clearSelectedFeatures(),Ge(this),this.updateUIClasses({mouse:_}),this.activateUIButton(M.LINE),this.setActionableState({trash:!0}),{line:t,currentVertexPosition:o,direction:r}},clickAnywhere:function(e,t){if(e.currentVertexPosition>0&&ct(t,e.line.coordinates[e.currentVertexPosition-1])||"backwards"===e.direction&&ct(t,e.line.coordinates[e.currentVertexPosition+1]))return this.changeMode(O.SIMPLE_SELECT,{featureIds:[e.line.id]});this.updateUIClasses({mouse:_}),e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),"forward"===e.direction?(e.currentVertexPosition++,e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat)):e.line.addCoordinate(0,t.lngLat.lng,t.lngLat.lat)},clickOnVertex:function(e){return this.changeMode(O.SIMPLE_SELECT,{featureIds:[e.line.id]})},onMouseMove:function(e,t){e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),Ae(t)&&this.updateUIClasses({mouse:S})}};dt.onTap=dt.onClick=function(e,t){if(Ae(t))return this.clickOnVertex(e,t);this.clickAnywhere(e,t)},dt.onKeyUp=function(e,t){je(t)?this.changeMode(O.SIMPLE_SELECT,{featureIds:[e.line.id]}):De(t)&&(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(O.SIMPLE_SELECT))},dt.onStop=function(e){Ve(this),this.activateUIButton(),void 0!==this.getFeature(e.line.id)&&(e.line.removeCoordinate(""+e.currentVertexPosition),e.line.isValid()?this.map.fire(D,{features:[e.line.toGeoJSON()]}):(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(O.SIMPLE_SELECT,{},{silent:!0})))},dt.onTrash=function(e){this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(O.SIMPLE_SELECT)},dt.toDisplayFeatures=function(e,t,o){var n=t.properties.id===e.line.id;if(t.properties.active=n?K:H,!n)return o(t);t.geometry.coordinates.length<2||(t.properties.meta=W,o(Be(e.line.id,t.geometry.coordinates["forward"===e.direction?t.geometry.coordinates.length-2:1],""+("forward"===e.direction?t.geometry.coordinates.length-2:1),!1)),o(t))};var pt={simple_select:rt,direct_select:st,draw_point:lt,draw_polygon:ut,draw_line_string:dt},ft={defaultMode:O.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}],modes:pt,controls:{},userProperties:!1},ht={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},mt={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function gt(e,t){return e.map((function(e){return e.source?e:ke(e,{id:e.id+"."+t,source:"hot"===t?v:b})}))}var yt=ce((function(e,o){var n="[object Arguments]",r="[object Map]",i="[object Object]",a="[object Set]",s=/^\[object .+?Constructor\]$/,l=/^(?:0|[1-9]\d*)$/,c={};c["[object Float32Array]"]=c["[object Float64Array]"]=c["[object Int8Array]"]=c["[object Int16Array]"]=c["[object Int32Array]"]=c["[object Uint8Array]"]=c["[object Uint8ClampedArray]"]=c["[object Uint16Array]"]=c["[object Uint32Array]"]=!0,c[n]=c["[object Array]"]=c["[object ArrayBuffer]"]=c["[object Boolean]"]=c["[object DataView]"]=c["[object Date]"]=c["[object Error]"]=c["[object Function]"]=c[r]=c["[object Number]"]=c[i]=c["[object RegExp]"]=c[a]=c["[object String]"]=c["[object WeakMap]"]=!1;var u="object"==typeof t&&t&&t.Object===Object&&t,d="object"==typeof self&&self&&self.Object===Object&&self,p=u||d||Function("return this")(),f=o&&!o.nodeType&&o,h=f&&e&&!e.nodeType&&e,m=h&&h.exports===f,g=m&&u.process,y=function(){try{return g&&g.binding&&g.binding("util")}catch(e){}}(),v=y&&y.isTypedArray;function b(e,t){for(var o=-1,n=null==e?0:e.length;++o<n;)if(t(e[o],o,e))return!0;return!1}function _(e){var t=-1,o=Array(e.size);return e.forEach((function(e,n){o[++t]=[n,e]})),o}function C(e){var t=-1,o=Array(e.size);return e.forEach((function(e){o[++t]=e})),o}var x,S,w,M=Array.prototype,k=Function.prototype,E=Object.prototype,P=p["__core-js_shared__"],I=k.toString,L=E.hasOwnProperty,F=(x=/[^.]+$/.exec(P&&P.keys&&P.keys.IE_PROTO||""))?"Symbol(src)_1."+x:"",T=E.toString,N=RegExp("^"+I.call(L).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),A=m?p.Buffer:void 0,O=p.Symbol,D=p.Uint8Array,j=E.propertyIsEnumerable,$=M.splice,U=O?O.toStringTag:void 0,R=Object.getOwnPropertySymbols,B=A?A.isBuffer:void 0,z=(S=Object.keys,w=Object,function(e){return S(w(e))}),V=ye(p,"DataView"),G=ye(p,"Map"),J=ye(p,"Promise"),q=ye(p,"Set"),W=ye(p,"WeakMap"),Z=ye(Object,"create"),Y=Ce(V),K=Ce(G),H=Ce(J),Q=Ce(q),X=Ce(W),ee=O?O.prototype:void 0,te=ee?ee.valueOf:void 0;function oe(e){var t=-1,o=null==e?0:e.length;for(this.clear();++t<o;){var n=e[t];this.set(n[0],n[1])}}function ne(e){var t=-1,o=null==e?0:e.length;for(this.clear();++t<o;){var n=e[t];this.set(n[0],n[1])}}function re(e){var t=-1,o=null==e?0:e.length;for(this.clear();++t<o;){var n=e[t];this.set(n[0],n[1])}}function ie(e){var t=-1,o=null==e?0:e.length;for(this.__data__=new re;++t<o;)this.add(e[t])}function ae(e){var t=this.__data__=new ne(e);this.size=t.size}function se(e,t){var o=we(e),n=!o&&Se(e),r=!o&&!n&&Me(e),i=!o&&!n&&!r&&Le(e),a=o||n||r||i,s=a?function(e,t){for(var o=-1,n=Array(e);++o<e;)n[o]=t(o);return n}(e.length,String):[],l=s.length;for(var c in e)!t&&!L.call(e,c)||a&&("length"==c||r&&("offset"==c||"parent"==c)||i&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||_e(c,l))||s.push(c);return s}function le(e,t){for(var o=e.length;o--;)if(xe(e[o][0],t))return o;return-1}function ce(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":U&&U in Object(e)?function(e){var t=L.call(e,U),o=e[U];try{e[U]=void 0;var n=!0}catch(e){}var r=T.call(e);return n&&(t?e[U]=o:delete e[U]),r}(e):function(e){return T.call(e)}(e)}function ue(e){return Ie(e)&&ce(e)==n}function de(e,t,o,s,l){return e===t||(null==e||null==t||!Ie(e)&&!Ie(t)?e!=e&&t!=t:function(e,t,o,s,l,c){var u=we(e),d=we(t),p=u?"[object Array]":be(e),f=d?"[object Array]":be(t),h=(p=p==n?i:p)==i,m=(f=f==n?i:f)==i,g=p==f;if(g&&Me(e)){if(!Me(t))return!1;u=!0,h=!1}if(g&&!h)return c||(c=new ae),u||Le(e)?he(e,t,o,s,l,c):function(e,t,o,n,i,s,l){switch(o){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!s(new D(e),new D(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return xe(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case r:var c=_;case a:var u=1&n;if(c||(c=C),e.size!=t.size&&!u)return!1;var d=l.get(e);if(d)return d==t;n|=2,l.set(e,t);var p=he(c(e),c(t),n,i,s,l);return l.delete(e),p;case"[object Symbol]":if(te)return te.call(e)==te.call(t)}return!1}(e,t,p,o,s,l,c);if(!(1&o)){var y=h&&L.call(e,"__wrapped__"),v=m&&L.call(t,"__wrapped__");if(y||v){var b=y?e.value():e,x=v?t.value():t;return c||(c=new ae),l(b,x,o,s,c)}}return!!g&&(c||(c=new ae),function(e,t,o,n,r,i){var a=1&o,s=me(e),l=s.length,c=me(t).length;if(l!=c&&!a)return!1;for(var u=l;u--;){var d=s[u];if(!(a?d in t:L.call(t,d)))return!1}var p=i.get(e);if(p&&i.get(t))return p==t;var f=!0;i.set(e,t),i.set(t,e);for(var h=a;++u<l;){d=s[u];var m=e[d],g=t[d];if(n)var y=a?n(g,m,d,t,e,i):n(m,g,d,e,t,i);if(!(void 0===y?m===g||r(m,g,o,n,i):y)){f=!1;break}h||(h="constructor"==d)}if(f&&!h){var v=e.constructor,b=t.constructor;v==b||!("constructor"in e)||!("constructor"in t)||"function"==typeof v&&v instanceof v&&"function"==typeof b&&b instanceof b||(f=!1)}return i.delete(e),i.delete(t),f}(e,t,o,s,l,c))}(e,t,o,s,de,l))}function pe(e){return!(!Pe(e)||function(e){return!!F&&F in e}(e))&&(ke(e)?N:s).test(Ce(e))}function fe(e){if(o=(t=e)&&t.constructor,n="function"==typeof o&&o.prototype||E,t!==n)return z(e);var t,o,n,r=[];for(var i in Object(e))L.call(e,i)&&"constructor"!=i&&r.push(i);return r}function he(e,t,o,n,r,i){var a=1&o,s=e.length,l=t.length;if(s!=l&&!(a&&l>s))return!1;var c=i.get(e);if(c&&i.get(t))return c==t;var u=-1,d=!0,p=2&o?new ie:void 0;for(i.set(e,t),i.set(t,e);++u<s;){var f=e[u],h=t[u];if(n)var m=a?n(h,f,u,t,e,i):n(f,h,u,e,t,i);if(void 0!==m){if(m)continue;d=!1;break}if(p){if(!b(t,(function(e,t){if(a=t,!p.has(a)&&(f===e||r(f,e,o,n,i)))return p.push(t);var a}))){d=!1;break}}else if(f!==h&&!r(f,h,o,n,i)){d=!1;break}}return i.delete(e),i.delete(t),d}function me(e){return function(e,t,o){var n=t(e);return we(e)?n:function(e,t){for(var o=-1,n=t.length,r=e.length;++o<n;)e[r+o]=t[o];return e}(n,o(e))}(e,Fe,ve)}function ge(e,t){var o,n,r=e.__data__;return("string"==(n=typeof(o=t))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==o:null===o)?r["string"==typeof t?"string":"hash"]:r.map}function ye(e,t){var o=function(e,t){return null==e?void 0:e[t]}(e,t);return pe(o)?o:void 0}oe.prototype.clear=function(){this.__data__=Z?Z(null):{},this.size=0},oe.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},oe.prototype.get=function(e){var t=this.__data__;if(Z){var o=t[e];return"__lodash_hash_undefined__"===o?void 0:o}return L.call(t,e)?t[e]:void 0},oe.prototype.has=function(e){var t=this.__data__;return Z?void 0!==t[e]:L.call(t,e)},oe.prototype.set=function(e,t){var o=this.__data__;return this.size+=this.has(e)?0:1,o[e]=Z&&void 0===t?"__lodash_hash_undefined__":t,this},ne.prototype.clear=function(){this.__data__=[],this.size=0},ne.prototype.delete=function(e){var t=this.__data__,o=le(t,e);return!(o<0)&&(o==t.length-1?t.pop():$.call(t,o,1),--this.size,!0)},ne.prototype.get=function(e){var t=this.__data__,o=le(t,e);return o<0?void 0:t[o][1]},ne.prototype.has=function(e){return le(this.__data__,e)>-1},ne.prototype.set=function(e,t){var o=this.__data__,n=le(o,e);return n<0?(++this.size,o.push([e,t])):o[n][1]=t,this},re.prototype.clear=function(){this.size=0,this.__data__={hash:new oe,map:new(G||ne),string:new oe}},re.prototype.delete=function(e){var t=ge(this,e).delete(e);return this.size-=t?1:0,t},re.prototype.get=function(e){return ge(this,e).get(e)},re.prototype.has=function(e){return ge(this,e).has(e)},re.prototype.set=function(e,t){var o=ge(this,e),n=o.size;return o.set(e,t),this.size+=o.size==n?0:1,this},ie.prototype.add=ie.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},ie.prototype.has=function(e){return this.__data__.has(e)},ae.prototype.clear=function(){this.__data__=new ne,this.size=0},ae.prototype.delete=function(e){var t=this.__data__,o=t.delete(e);return this.size=t.size,o},ae.prototype.get=function(e){return this.__data__.get(e)},ae.prototype.has=function(e){return this.__data__.has(e)},ae.prototype.set=function(e,t){var o=this.__data__;if(o instanceof ne){var n=o.__data__;if(!G||n.length<199)return n.push([e,t]),this.size=++o.size,this;o=this.__data__=new re(n)}return o.set(e,t),this.size=o.size,this};var ve=R?function(e){return null==e?[]:(e=Object(e),function(e,t){for(var o=-1,n=null==e?0:e.length,r=0,i=[];++o<n;){var a=e[o];t(a,o,e)&&(i[r++]=a)}return i}(R(e),(function(t){return j.call(e,t)})))}:function(){return[]},be=ce;function _e(e,t){return!!(t=null==t?9007199254740991:t)&&("number"==typeof e||l.test(e))&&e>-1&&e%1==0&&e<t}function Ce(e){if(null!=e){try{return I.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function xe(e,t){return e===t||e!=e&&t!=t}(V&&"[object DataView]"!=be(new V(new ArrayBuffer(1)))||G&&be(new G)!=r||J&&"[object Promise]"!=be(J.resolve())||q&&be(new q)!=a||W&&"[object WeakMap]"!=be(new W))&&(be=function(e){var t=ce(e),o=t==i?e.constructor:void 0,n=o?Ce(o):"";if(n)switch(n){case Y:return"[object DataView]";case K:return r;case H:return"[object Promise]";case Q:return a;case X:return"[object WeakMap]"}return t});var Se=ue(function(){return arguments}())?ue:function(e){return Ie(e)&&L.call(e,"callee")&&!j.call(e,"callee")},we=Array.isArray,Me=B||function(){return!1};function ke(e){if(!Pe(e))return!1;var t=ce(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}function Ee(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}function Pe(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function Ie(e){return null!=e&&"object"==typeof e}var Le=v?function(e){return function(t){return e(t)}}(v):function(e){return Ie(e)&&Ee(e.length)&&!!c[ce(e)]};function Fe(e){return null!=(t=e)&&Ee(t.length)&&!ke(t)?se(e):fe(e);var t}e.exports=function(e,t){return de(e,t)}})),vt={Polygon:he,LineString:fe,Point:pe,MultiPolygon:ye,MultiLineString:ye,MultiPoint:ye};function bt(e,t){return t.modes=O,t.getFeatureIdsAt=function(t){return ne.click({point:t},null,e).map((function(e){return e.properties.id}))},t.getSelectedIds=function(){return e.store.getSelectedIds()},t.getSelected=function(){return{type:L,features:e.store.getSelectedIds().map((function(t){return e.store.get(t)})).map((function(e){return e.toGeoJSON()}))}},t.getSelectedPoints=function(){return{type:L,features:e.store.getSelectedCoordinates().map((function(e){return{type:k,properties:{},geometry:{type:I,coordinates:e.coordinates}}}))}},t.set=function(o){if(void 0===o.type||o.type!==L||!Array.isArray(o.features))throw new Error("Invalid FeatureCollection");var n=e.store.createRenderBatch(),r=e.store.getAllIds().slice(),i=t.add(o),a=new te(i);return(r=r.filter((function(e){return!a.has(e)}))).length&&t.delete(r),n(),i},t.add=function(t){var o=JSON.parse(JSON.stringify(Je(t))).features.map((function(t){if(t.id=t.id||ue(),null===t.geometry)throw new Error("Invalid geometry: null");if(void 0===e.store.get(t.id)||e.store.get(t.id).type!==t.geometry.type){var o=vt[t.geometry.type];if(void 0===o)throw new Error("Invalid geometry type: "+t.geometry.type+".");var n=new o(e,t);e.store.add(n)}else{var r=e.store.get(t.id);r.properties=t.properties,yt(r.getCoordinates(),t.geometry.coordinates)||r.incomingCoords(t.geometry.coordinates)}return t.id}));return e.store.render(),o},t.get=function(t){var o=e.store.get(t);if(o)return o.toGeoJSON()},t.getAll=function(){return{type:L,features:e.store.getAll().map((function(e){return e.toGeoJSON()}))}},t.delete=function(o){return e.store.delete(o,{silent:!0}),t.getMode()!==O.DIRECT_SELECT||e.store.getSelectedIds().length?e.store.render():e.events.changeMode(O.SIMPLE_SELECT,void 0,{silent:!0}),t},t.deleteAll=function(){return e.store.delete(e.store.getAllIds(),{silent:!0}),t.getMode()===O.DIRECT_SELECT?e.events.changeMode(O.SIMPLE_SELECT,void 0,{silent:!0}):e.store.render(),t},t.changeMode=function(o,n){return void 0===n&&(n={}),o===O.SIMPLE_SELECT&&t.getMode()===O.SIMPLE_SELECT?(r=n.featureIds||[],i=e.store.getSelectedIds(),r.length===i.length&&JSON.stringify(r.map((function(e){return e})).sort())===JSON.stringify(i.map((function(e){return e})).sort())||(e.store.setSelected(n.featureIds,{silent:!0}),e.store.render()),t):(o===O.DIRECT_SELECT&&t.getMode()===O.DIRECT_SELECT&&n.featureId===e.store.getSelectedIds()[0]||e.events.changeMode(o,n,{silent:!0}),t);var r,i},t.getMode=function(){return e.events.getMode()},t.trash=function(){return e.events.trash({silent:!0}),t},t.combineFeatures=function(){return e.events.combineFeatures({silent:!0}),t},t.uncombineFeatures=function(){return e.events.uncombineFeatures({silent:!0}),t},t.setFeatureProperty=function(o,n,r){return e.store.setFeatureProperty(o,n,r),t},t}var _t=function(e,t){var o={options:e=function(e){void 0===e&&(e={});var t=ke(e);return e.controls||(t.controls={}),!1===e.displayControlsDefault?t.controls=ke(mt,e.controls):t.controls=ke(ht,e.controls),(t=ke(ft,t)).styles=gt(t.styles,"cold").concat(gt(t.styles,"hot")),t}(e)};t=bt(o,t),o.api=t;var n=Ie(o);return t.onAdd=n.onAdd,t.onRemove=n.onRemove,t.types=M,t.options=e,t};function Ct(e){_t(e,this)}return Ct.modes=pt,Ct}))}).call(this,o("c8ba"))}}]);
//# sourceMappingURL=chunk-8f0ac8fc.aeaf250f.js.map