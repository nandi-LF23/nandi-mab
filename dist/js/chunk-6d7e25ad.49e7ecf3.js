(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6d7e25ad"],{"0d1d":function(t,e,a){"use strict";a.r(e);var s,i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"content"},[a("base-header",{staticClass:"pb-6",attrs:{type:"soilmoisture"}},[a("b-row",{staticClass:"py-4",attrs:{"align-v":"center"}},[a("b-col",[a("h6",{staticClass:"h2 text-white d-inline-block mb-0 mr-5"},[t._v("Soil Moisture - "+t._s(t.field_name)+" ( "+t._s(t.current_node)+" ) -\n          Graph")]),a("div",{directives:[{name:"show",rawName:"v-show",value:t.loading,expression:"loading"}],staticClass:"mab_spinner light right"})])],1)],1),a("div",{staticClass:"container-fluid mt--6"},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-md-12"},[a("card",{attrs:{"body-classes":"px-0 py-0"}},[a("template",{slot:"header"},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-md-12"},[a("base-button",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover.top",modifiers:{hover:!0,top:!0}}],staticClass:"btn",attrs:{disabled:!t.node_id||!t.userCan("Export","Soil Moisture",t.node_id,"O")||t.loading,size:"sm",type:"primary",title:"Export device data to a CSV file.",icon:""},nativeOn:{click:function(e){return t.exportGraphCSV()}}},[t._v("\n                  Export CSV\n                ")]),a("base-button",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover.top",modifiers:{hover:!0,top:!0}}],staticClass:"btn",attrs:{disabled:!t.node_id||!t.userCan("Edit","Soil Moisture",t.node_id,"O")||t.loading,size:"sm",type:"primary",title:"Navigate to the soil moisture node's management screen",icon:""},nativeOn:{click:function(e){return t.goToManage()}}},[t._v("\n                  Manage SM\n                ")])],1)])]),a("div",{staticClass:"card-body"},[a("b-row",[t.related_nodes.length>1?a("b-col",{attrs:{sm:""}},[a("base-input",{attrs:{label:"Current Node"}},[a("el-select",{attrs:{disabled:t.loading},model:{value:t.current_node,callback:function(e){t.current_node=e},expression:"current_node"}},[t._l(t.related_nodes,(function(e,s){return[a("el-option",{key:s,attrs:{label:e,value:e,selected:t.$route.params.node_address}})]}))],2)],1)],1):t._e(),a("b-col",{attrs:{sm:""}},[a("base-input",{attrs:{label:"Graph Type"}},[a("el-select",{attrs:{disabled:t.loading},model:{value:t.graph_type,callback:function(e){t.graph_type=e},expression:"graph_type"}},[a("el-option",{attrs:{label:"Separate Levels",value:"sm",selected:""}}),a("el-option",{attrs:{label:"Stacked Graph",value:"stack"}}),a("el-option",{attrs:{label:"Sum",value:"sum"}}),a("el-option",{attrs:{label:"Average",value:"ave"}}),a("el-option",{attrs:{label:"Temperature",value:"temp"}}),a("el-option",{attrs:{label:"Technical",value:"tech"}})],1)],1)],1),a("b-col",{attrs:{sm:""}},[a("base-input",{attrs:{label:"Range"}},[a("el-select",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover.top",modifiers:{hover:!0,top:!0}}],attrs:{disabled:t.loading,title:"Choose the time range of data to view."},model:{value:t.sub_days,callback:function(e){t.sub_days=e},expression:"sub_days"}},[a("el-option",{attrs:{label:"Last 24 Hours",value:"1"}}),a("el-option",{attrs:{label:"Last Week",value:"7"}}),a("el-option",{attrs:{label:"Last Two Weeks",value:"14"}}),a("el-option",{attrs:{label:"Last Month",value:"31"}}),a("el-option",{attrs:{label:"Last Year",value:"365"}}),a("el-option",{attrs:{label:"Custom",value:"custom"}})],1)],1)],1),a("b-col",{attrs:{sm:""}},[a("base-input",{directives:[{name:"show",rawName:"v-show",value:"custom"==t.sub_days,expression:"sub_days=='custom'"}],attrs:{label:"Start Date"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.focus,i=e.blur;return a("flat-picker",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover.top",modifiers:{hover:!0,top:!0}}],staticClass:"form-control datepicker",attrs:{config:{maxDate:t.date_now},placeholder:"Custom Date",title:"A custom start date allows a custom range of data to be viewed."},on:{"on-open":s,"on-close":i},model:{value:t.graph_start_date,callback:function(e){t.graph_start_date=e},expression:"graph_start_date"}})}}])})],1),a("b-col",{attrs:{sm:""}})],1),a("highcharts",{ref:"hchart",staticClass:"hc",attrs:{options:t.chartOptions,"update-args":t.chartUpdateArgs}}),a("b-row",[a("b-col",{staticClass:"text-center"},[a("div",{staticClass:"d-flex flow-row justify-content-center"},[a("div",{staticClass:"m-1"},["sm"==t.graph_type?a("b-form-checkbox",{attrs:{size:"lg",switch:""},on:{change:t.toggleSeriesDragDrop},model:{value:t.zoomOrDrag,callback:function(e){t.zoomOrDrag=e},expression:"zoomOrDrag"}},[t._v("Mode: "+t._s(t.zoomOrDrag?"Drag":"Zoom")+"\n                    ")]):t._e()],1),"stack"==t.graph_type?a("b-form-checkbox",{attrs:{size:"lg",switch:""},on:{change:t.toggleSeriesDragDrop},model:{value:t.zoomOrDrag,callback:function(e){t.zoomOrDrag=e},expression:"zoomOrDrag"}},[t._v("Mode: "+t._s(t.zoomOrDrag?"Drag":"Zoom")+"\n                  ")]):t._e()],1)])],1)],1)],2)],1)])])],1)},r=[],o=(a("f576"),a("ac6a"),a("a481"),a("bd86")),n=(a("6611"),a("450d"),a("e772")),l=a.n(n),d=(a("7f7f"),a("1f1a"),a("4e4b")),h=a.n(d),c=a("c38f"),p=a.n(c),u=(a("0952"),a("ea7f")),g=a.n(u),m=a("8fe0"),b=a("3d20"),f=a.n(b);g.a.Pointer.prototype.reset=function(){};var _={mixins:[m["a"]],components:(s={},Object(o["a"])(s,h.a.name,h.a),Object(o["a"])(s,l.a.name,l.a),Object(o["a"])(s,"flatPicker",p.a),s),data:function(){var t=this;return{loading:!1,in_progress:!0,current_node:this.$route.params.node_address,node_id:null,field_name:null,data_grouping:!1,graph_start_date:"",graph_type:"",sub_days:"",bInitialQuery:!0,bNotified:!1,related_nodes:[],labelsEnabled:!0,reversed:!1,date_now:"",series:[],chartUpdateArgs:[!0,!0,{duration:1e3}],seriesAdjusted:!1,zoomOrDrag:!1,stacking:"normal",lastDate:null,exportFileName:"",initial_start_date:null,initial_end_date:null,selection_start:null,selection_end:null,yMaxBackup:0,yMinBackup:0,yMin:null,yMax:null,xMin:1e3,xMax:0,lastTimestamp:null,full:0,refill:0,plotOptions:{series:{dataGrouping:{enabled:this.data_grouping},lineWidth:3,states:{inactive:{opacity:1}}}},chartTitle:{text:"Loading..",widthAdjust:-300},plotLines:[],resetButton:{text:"Reset",enabled:!0,onclick:function(e){t.resetSeriesData()}}}},computed:{chartOptions:function(){return{credits:{enabled:!1},chart:{type:"line",zoomType:0==this.zoomOrDrag&&"x",panning:!0,panKey:"shift",height:600,resetZoomButton:{position:{x:0,y:-50}}},exporting:{buttons:{contextButton:{enabled:!1},exportButton:{text:"Export",menuItems:["downloadPNG","downloadJPEG","downloadPDF","downloadSVG"]},printButton:{text:"Print",onclick:function(){this.print()}},resetButton:this.resetButton},filename:this.exportFileName},colors:["#93a9d0","#aa4644","#89a54e","#71588f","#4298af","#db843d","#a99bbe","#d09392","#bacd96","#a99bbe"],series:this.series,xAxis:{min:this.xMin,max:this.xMax,type:"datetime",dateTimeLabelFormats:{millisecond:"%H:%M:%S.%L",second:"%H:%M:%S",minute:"%H:%M",hour:"%H:%M",day:'<span style="fill: #00A04C; font-weight:600">%e %b</span>',week:"%e %b",month:"%b %Y",year:"%Y"},tickPosition:"inside",labels:{rotation:-45},crosshair:!0,events:{setExtremes:function(t){var e=this;setTimeout((function(){"undefined"==typeof t.min&&"undefined"==typeof t.max?e.chart.yAxis[0].setExtremes(e.chart.yAxis[0].min,e.chart.yAxis[0].max):e.chart.yAxis[0].setExtremes()}),1)},afterSetExtremes:this.afterSetExtremes}},yAxis:{tickInterval:1,max:this.yMax,min:this.yMin,minPadding:0,maxPadding:0,title:{text:""},plotLines:this.plotLines,reversed:this.reversed,labels:{enabled:this.labelsEnabled}},legend:{layout:"horizontal",align:"center",verticalAlign:"bottom"},tooltip:{shared:!0},plotOptions:this.plotOptions,title:this.chartTitle}}},watch:{title:function(t){this.chartOptions.title=t},plotOptions:{handler:function(t){t.length&&(this.chartOptions.plotOptions=t)},deep:!0},series:{handler:function(t){t.length&&(this.chartOptions.series=t)},deep:!0},graph_start_date:function(t){this.changeDateRange()},graph_type:function(t){this.maybeReloadGraphData()},sub_days:function(t){("custom"!=t||this.graph_start_date)&&("custom"!=t&&(this.graph_start_date=""),this.initial_start_date=null,this.initial_end_date=null,this.maybeReloadGraphData())},current_node:function(t){this.bNotified=!1,this.maybeReloadGraphData()}},methods:{loadGraphData:function(){var t=this;return this.loading=!0,this.in_progress=!0,this.$refs.hchart.chart.showLoading(this.bInitialQuery?"Loading...":"Refreshing..."),this.$axios.post("/api/Graph",{node_address:this.current_node,graph_type:this.graph_type,graph_start_date:this.graph_start_date,sub_days:this.sub_days,is_initial:this.bInitialQuery,selection_start:this.selection_start,selection_end:this.selection_end}).then((function(e){if(t.loading=!1,t.in_progress=!0,t.$refs.hchart.chart.hideLoading(),e.data){if(e.data.message&&"no_data"==e.data.message)return f.a.fire({title:"No data found",text:"This node currently has no data to plot.",showCancelButton:!1,confirmButtonText:"OK",buttonsStyling:!1,customClass:{cancelButton:"btn btn-outline-primary",confirmButton:"btn btn-primary"}}),t.chartTitle.text="No data found",void setTimeout((function(){t.in_progress=!1}),1);!t.bNotified&&e.data.not_current&&e.data.last_date&&(f.a.fire({title:"No recent data found",text:"Last readings up to "+e.data.last_date+" could be displayed.",showCancelButton:!1,confirmButtonText:"OK",buttonsStyling:!1,customClass:{cancelButton:"btn btn-outline-primary",confirmButton:"btn btn-primary"}}),t.bNotified=!0),t.selection_start=null,t.selection_end=null,t.node_id=e.data.node_id,t.field_name=e.data.field_name,t.bInitialQuery&&(t.graph_start_date=e.data.graph_start_date,t.graph_type=e.data.graph_type,t.sub_days=e.data.sub_days),t.xMax=e.data.x_max,t.xMin=e.data.x_min,"ave"==t.graph_type?(t.yMax=e.data.y_max,t.yMin=e.data.y_min):(t.yMax=null,t.yMin=null),"stack"==t.graph_type&&(t.reversed=!1),t.yMaxBackup=e.data.y_max,t.yMinBackup=e.data.y_min,t.full=e.data.full,t.refill=e.data.refill,t.lastDate=e.data.last_date.replace(":","-"),t.exportFileName=e.data.graph.field_name+"-"+t.graph_type+"-"+t.$route.params.node_address+"-"+t.lastDate,t.plotOptions=e.data.graph.plotOptions,t.chartTitle=e.data.graph.title,t.series=e.data.graph.series.filter((function(t){return!!t.data&&t.data.length>0})),t.lastTimestamp=e.data.x_max,("sm"==t.graph_type||"stack"==t.graph_type)&&t.zoomOrDrag?t.enableSeriesDragDrop():t.disableSeriesDragDrop(),"ave"==t.graph_type?(t.showPlotLines(),t.setupCustomTooltip()):(t.hidePlotLines(),t.removeCustomTooltip()),t.related_nodes=e.data.related_nodes,t.$refs.hchart.chart.reflow()}return setTimeout((function(){t.in_progress=!1,t.bInitialQuery=!1}),1),e}))},maybeReloadGraphData:function(){1!=this.in_progress&&this.loadGraphData()},changeDateRange:function(){1!=this.in_progress&&""!=this.graph_start_date&&this.loadGraphData()},enableSeriesDragDrop:function(){var t=this;this.series&&this.series.length&&(console.log("Enabling Series Drag and Drop"),console.log(this.series),"stack"==this.graph_type?this.labelsEnabled=!1:this.labelsEnabled=!0,this.chartOptions.tooltip={shared:!0},this.resetButton.enabled=!0,this.series.forEach((function(e,a){t.series[a].custom={moved:!1},t.series[a].pointStart=Date.UTC(2004,3,1),t.series[a].pointInterval=36e5,t.series[a].dragDrop={draggableX:!1,draggableY:!0,dragMinY:0,dragMaxY:100,groupBy:"grp"},t.series[a].dragDrop.draggableX=!1,t.series[a].dragDrop.draggableY=!0,"Average"!=t.series[a].name?t.series[a].dragDrop.groupBy="grp"+(a+1):t.series[a].dragDrop.groupBy="grpavg",t.series[a].point={events:{dragStart:function(){this.series.options.custom.moved=!0}}},t.series[a].tooltip={pointFormatter:function(){return'<span style="color:'+this.series.color+';">●</span> '+this.series.name+": <b>"+(this.series.options.custom.moved?"":g.a.numberFormat(this.y,2))+"</b><br/>"}}})),"ave"!=this.graph_type&&(console.log(this.$refs.hchart),this.yMax=this.$refs.hchart.chart.yAxis[0].max,this.yMin=this.$refs.hchart.chart.yAxis[0].min),this.chartTriggerChange())},disableSeriesDragDrop:function(){var t=this;this.series&&this.series.length&&(console.log("Disabling series DnD"),this.series.forEach((function(e,a){t.series[a].dragDrop={draggableX:!1,draggableY:!1,groupBy:"Average"==t.series[a].name?"grpavg":"grp"+(a+1)},t.series[a].pointStart=Date.UTC(2004,3,1),t.series[a].pointInterval=36e5})),this.labelsEnabled=!0,this.chartOptions.tooltip={shared:!1},this.resetButton.enabled=!1,"ave"!=this.graph_type&&(this.yMax=null,this.yMin=null),this.chartTriggerChange())},toggleSeriesDragDrop:function(){this.zoomOrDrag?this.enableSeriesDragDrop():this.disableSeriesDragDrop()},showPlotLines:function(){var t=this;this.plotLines=[{value:this.full,color:"#00F",width:2,label:{x:0,align:"right",formatter:function(){return"Full: "+t.full}}},{value:this.refill,color:"#D26761",width:2,label:{x:0,align:"right",formatter:function(){return"Refill: "+t.refill}}}]},hidePlotLines:function(){this.plotLines=[]},chartTriggerChange:function(){this.series.push({type:"line",name:"Faux",data:[]}),this.series.pop()},exportGraphCSV:function(){var t=this;this.zoomOrDrag=!1;var e=this.$refs.hchart.chart.series;try{for(var a=0;a<e.length;a++)if("undefined"!==typeof e[a].options.custom.moved&&1==e[a].options.custom.moved){this.seriesAdjusted=!0;break}}catch(s){}this.seriesAdjusted?this.resetSeriesData().then((function(e){t.$refs.hchart.chart.downloadCSV()})):this.$refs.hchart.chart.downloadCSV()},resetSeriesData:function(){return this.seriesAdjusted=!1,this.loadGraphData()},setupCustomTooltip:function(){for(var t=0;t<this.series.length;t++)"Average"==this.series[t].name&&(this.series[t].tooltip={pointFormatter:function(){var t='<span style="color:'+this.series.color+';">●</span> '+this.series.name+": <b>"+this.y+"</b><br>";return"Average"==this.series.name&&this.status&&(t+='<span style="color:black;">●</span> Status: <strong>'+this.status+"%</strong><br>"),t}})},removeCustomTooltip:function(){for(var t=0;t<this.series.length;t++)this.series[t].tooltip&&this.series[t].tooltip.pointFormatter&&delete this.series[t].tooltip.pointFormatter},goToManage:function(){this.$router.push({name:"soil_moisture_edit",params:{node_address:this.current_node}})},afterSetExtremes:function(t){null==t.trigger?this.bInitialQuery&&(this.initial_start_date=this.xMin,this.initial_end_date=this.xMax,this.bInitialQuery=!1):(t.target.chart.resetZoomButton?(this.selection_start=t.min,this.selection_end=t.max):(this.selection_start=this.initial_start_date,this.selection_end=this.initial_end_date),this.maybeReloadGraphData())}},created:function(){var t=new Date,e=String(t.getDate()).padStart(2,"0"),a=String(t.getMonth()+1).padStart(2,"0"),s=t.getFullYear();this.date_now=t=s+"-"+a+"-"+e},mounted:function(){this.loadGraphData()}},v=_,y=a("2877"),x=Object(y["a"])(v,i,r,!1,null,null,null);e["default"]=x.exports},"2e08":function(t,e,a){var s=a("9def"),i=a("9744"),r=a("be13");t.exports=function(t,e,a,o){var n=String(r(t)),l=n.length,d=void 0===a?" ":String(a),h=s(e);if(h<=l||""==d)return n;var c=h-l,p=i.call(d,Math.ceil(c/d.length));return p.length>c&&(p=p.slice(0,c)),o?p+n:n+p}},9744:function(t,e,a){"use strict";var s=a("4588"),i=a("be13");t.exports=function(t){var e=String(i(this)),a="",r=s(t);if(r<0||r==1/0)throw RangeError("Count can't be negative");for(;r>0;(r>>>=1)&&(e+=e))1&r&&(a+=e);return a}},f576:function(t,e,a){"use strict";var s=a("5ca1"),i=a("2e08"),r=a("a25f"),o=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(r);s(s.P+s.F*o,"String",{padStart:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0,!0)}})}}]);
//# sourceMappingURL=chunk-6d7e25ad.49e7ecf3.js.map